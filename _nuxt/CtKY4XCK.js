import{I as x}from"./Cov751Ou.js";import{e as le,f as oe,o as i,c as m,t as k,g as B,a as s,r as M,h as j,_ as ne,i as se,T as Ae,j as _e,b as c,k as t,F as D,l as z,w as R,m as be,d as H,n as ge,p as Ve,q as ae,v as Ie,s as Ue,x as Pe,y as Be,z as Se,A as ce,B as Fe,C as De,D as Re,E as Ee,G as xe,H as Le,I as Ne}from"./Cuem3LDA.js";import{B as q}from"./Bl7VwagC.js";import{C as te}from"./DzKUzsOz.js";import{T as C,a as Oe}from"./DaiyHpTh.js";import{P as je}from"./3RHYZAmY.js";import{M as qe,a as Te}from"./DZ5XcXCl.js";import{t as Ce}from"./DnknCDuH.js";import{u as He}from"./CUyT3NOH.js";import{u as ve}from"./CJvSuGTU.js";import{M as We}from"./C-xuITp_.js";import"./DG6ESaol.js";const ze={class:"color-input"},Ge=["for"],Ke={class:"color-input__row"},Je=["id","value"],Ye=["id","value","placeholder"],Ze={key:1,class:"color-input__error"},Qe=le({__name:"ColorInput",props:{modelValue:{},label:{},placeholder:{default:"#000000"}},emits:["update:modelValue"],setup(_,{emit:y}){const p=_,S=y,o=M(null),U=M(null),F=j(()=>`color-hex-${Math.random().toString(36).slice(2)}`),r=j(()=>`color-swatch-${Math.random().toString(36).slice(2)}`);function V(f){const h=String(f).trim().replace(/^#/,"");if(h.length===0)return"";if(/^[0-9a-fA-F]{3}$/.test(h)){const I=h[0]+h[0],$=h[1]+h[1],v=h[2]+h[2];return`#${I}${$}${v}`}return/^[0-9a-fA-F]{6}$/.test(h)?`#${h}`:""}const T=j(()=>{const f=p.modelValue??"";return f.length===0||V(f)?"":"Invalid hex (use #RGB or #RRGGBB)"}),P=j(()=>{const f=p.modelValue??"";return f.length===0?f:V(f)||f}),N=j(()=>V(p.modelValue??"")||"#000000");function O(f){const h=V(f);S("update:modelValue",h||f)}function L(f){const h=f.target.value;O(h)}function w(f){const h=f.target.value,I=V(h);I?(S("update:modelValue",I),o.value?.setAttribute?.("value",I)):S("update:modelValue",h)}return oe(()=>p.modelValue,f=>{const h=V(f??"");h&&U.value&&U.value.value!==h&&(U.value.value=h)}),(f,h)=>(i(),m("div",ze,[_.label?(i(),m("label",{key:0,for:F.value,class:"color-input__label"},k(_.label),9,Ge)):B("",!0),s("div",Ke,[s("input",{id:r.value,ref_key:"swatchRef",ref:o,type:"color",value:N.value,class:"color-input__swatch",onInput:L},null,40,Je),s("input",{id:F.value,ref_key:"hexRef",ref:U,type:"text",value:P.value,placeholder:_.placeholder,class:"color-input__hex",onInput:w},null,40,Ye)]),T.value?(i(),m("p",Ze,k(T.value),1)):B("",!0)]))}}),K=ne(Qe,[["__scopeId","data-v-3b6f4976"]]),Xe={class:"admin-collection-modal__panel"},et={class:"admin-collection-modal__header"},tt={class:"admin-collection-modal__title"},st={class:"admin-collection-modal__body"},lt={key:0,class:"admin-collection-modal__stored"},nt={class:"admin-collection-modal__stored-grid"},at={key:0,class:"admin-collection-modal__thumb-wrap"},ot=["src","alt"],it={class:"admin-collection-modal__stored-fields"},rt={class:"admin-collection-modal__field"},dt={class:"admin-collection-modal__mint"},ct=["href"],ut={key:0,class:"admin-collection-modal__field"},mt={key:1,class:"admin-collection-modal__field"},_t={key:2,class:"admin-collection-modal__field"},pt={key:1,class:"admin-collection-modal__traits"},gt={class:"admin-collection-modal__trait-pills"},vt={class:"admin-collection-modal__nfts"},yt={key:0,class:"admin-collection-modal__loading"},ht={key:1,class:"admin-collection-modal__empty"},ft={key:2,class:"admin-collection-modal__grid"},bt={class:"admin-collection-modal__card-media"},kt=["src","alt"],$t={key:1,class:"admin-collection-modal__card-placeholder"},Vt={class:"admin-collection-modal__card-info"},St={class:"admin-collection-modal__card-name"},wt=["title"],Mt={key:0,class:"admin-collection-modal__card-traits"},Tt=le({__name:"AdminCollectionDetailModal",props:{modelValue:{type:Boolean},slug:{},collection:{}},emits:["update:modelValue"],setup(_){const y=_,p=M(null);oe(()=>y.collection?.mint??null,F=>{p.value=F},{immediate:!0});const S=j(()=>y.slug),{assets:o,loading:U}=He({slug:S,collection:p,limit:500});return(F,r)=>(i(),se(Ae,{to:"body"},[_.modelValue?(i(),m("div",{key:0,class:"admin-collection-modal",onClick:r[1]||(r[1]=_e(V=>F.$emit("update:modelValue",!1),["self"]))},[s("div",Xe,[s("div",et,[s("h3",tt,k(_.collection.name||"Collection"),1),s("button",{type:"button",class:"admin-collection-modal__close","aria-label":"Close",onClick:r[0]||(r[0]=V=>F.$emit("update:modelValue",!1))},[c(t(x),{icon:"mdi:close"})])]),s("div",st,[_.collection?(i(),m("section",lt,[r[6]||(r[6]=s("h4",{class:"admin-collection-modal__section-title"},"Stored in config",-1)),s("div",nt,[_.collection.image?(i(),m("div",at,[s("img",{src:_.collection.image,alt:_.collection.name??_.collection.mint,class:"admin-collection-modal__thumb"},null,8,ot)])):B("",!0),s("div",it,[s("p",rt,[r[2]||(r[2]=s("span",{class:"admin-collection-modal__label"},"Mint",-1)),s("code",dt,k(_.collection.mint),1),s("a",{href:`https://solscan.io/token/${_.collection.mint}`,target:"_blank",rel:"noopener",class:"admin-collection-modal__link"},"Solscan",8,ct)]),_.collection.name?(i(),m("p",ut,[r[3]||(r[3]=s("span",{class:"admin-collection-modal__label"},"Name",-1)),s("span",null,k(_.collection.name),1)])):B("",!0),_.collection.sellerFeeBasisPoints!=null?(i(),m("p",mt,[r[4]||(r[4]=s("span",{class:"admin-collection-modal__label"},"Seller fee",-1)),s("span",null,k(_.collection.sellerFeeBasisPoints)+" bps",1)])):B("",!0),_.collection.groupPath?.length?(i(),m("p",_t,[r[5]||(r[5]=s("span",{class:"admin-collection-modal__label"},"Group path",-1)),s("span",null,k(_.collection.groupPath.join(" / ")),1)])):B("",!0)])])])):B("",!0),_.collection&&(_.collection.traitTypes?.length??0)>0?(i(),m("section",pt,[r[7]||(r[7]=s("h4",{class:"admin-collection-modal__section-title"},"Unique traits in collection",-1)),s("div",gt,[(i(!0),m(D,null,z(_.collection.traitTypes,V=>(i(),m("span",{key:V,class:"admin-collection-modal__trait-pill"},k(V),1))),128))])])):B("",!0),s("section",vt,[r[10]||(r[10]=s("h4",{class:"admin-collection-modal__section-title"},"Member NFTs",-1)),t(U)?(i(),m("div",yt,[c(t(x),{icon:"mdi:loading",class:"admin-collection-modal__spinner"}),r[8]||(r[8]=s("span",null,"Loading NFTs...",-1))])):t(o).length===0?(i(),m("div",ht,[...r[9]||(r[9]=[s("p",null,"No NFTs in scope. Run scope expand or add the collection and save.",-1)])])):(i(),m("div",ft,[(i(!0),m(D,null,z(t(o),V=>(i(),m("div",{key:V.mint,class:"admin-collection-modal__card"},[s("div",bt,[V.metadata?.image?(i(),m("img",{key:0,src:V.metadata.image,alt:V.metadata.name??V.mint},null,8,kt)):(i(),m("div",$t,[c(t(x),{icon:"mdi:image-off"})]))]),s("div",Vt,[s("p",St,k(V.metadata?.name??t(Ce)(V.mint)),1),s("p",{class:"admin-collection-modal__card-mint",title:V.mint},k(t(Ce)(V.mint,6,6)),9,wt),(V.metadata?.traits?.length??0)>0?(i(),m("div",Mt,[(i(!0),m(D,null,z((V.metadata?.traits??[]).slice(0,2),(T,P)=>(i(),m("span",{key:P,class:"admin-collection-modal__trait-tag"},k(T.trait_type)+": "+k(T.value),1))),128))])):B("",!0)])]))),128))]))])])])])):B("",!0)]))}}),Ct=Object.assign(ne(Tt,[["__scopeId","data-v-92cc1fa5"]]),{__name:"AdminCollectionDetailModal"}),Ft={class:"marketplace-settings"},At={class:"marketplace-settings__add-mint"},It={key:0,class:"marketplace-settings__mint-list"},Ut=["disabled","onClick"],Pt={class:"marketplace-settings__mint-thumb"},Bt=["src","alt"],Dt={key:1,class:"marketplace-settings__mint-thumb-placeholder"},Rt={class:"marketplace-settings__mint-detail"},Et={class:"marketplace-settings__mint-name"},xt={class:"marketplace-settings__mint-name"},Lt={class:"marketplace-settings__mint-error"},Nt={class:"marketplace-settings__mint-name"},Ot={class:"marketplace-settings__mint-address"},jt={class:"marketplace-settings__mint-meta"},qt={key:0},Ht={key:1,class:"marketplace-settings__traits-hint"},Wt={key:1,class:"marketplace-settings__empty"},zt={class:"marketplace-settings__add-mint"},Gt={key:0,class:"marketplace-settings__mint-list"},Kt={class:"marketplace-settings__mint-row marketplace-settings__mint-row--plain"},Jt={class:"marketplace-settings__mint-thumb"},Yt=["src","alt"],Zt={key:1,class:"marketplace-settings__mint-thumb-placeholder"},Qt={class:"marketplace-settings__mint-detail"},Xt={class:"marketplace-settings__mint-name"},es={class:"marketplace-settings__mint-name"},ts={class:"marketplace-settings__mint-error"},ss={class:"marketplace-settings__mint-name"},ls={class:"marketplace-settings__mint-address"},ns={class:"marketplace-settings__mint-meta"},as={key:1,class:"marketplace-settings__empty"},os={class:"marketplace-settings__base-toggles"},is=["checked","onChange"],rs={class:"marketplace-settings__custom"},ds={class:"marketplace-settings__add-mint"},cs={key:0,class:"marketplace-settings__mint-list"},us={class:"marketplace-settings__mint-row marketplace-settings__mint-row--plain"},ms={class:"marketplace-settings__mint-thumb"},_s=["src","alt"],ps={key:1,class:"marketplace-settings__mint-thumb-placeholder"},gs={class:"marketplace-settings__mint-detail"},vs={class:"marketplace-settings__mint-name"},ys={class:"marketplace-settings__mint-name"},hs={class:"marketplace-settings__mint-error"},fs={class:"marketplace-settings__mint-name"},bs={class:"marketplace-settings__mint-address"},ks={class:"marketplace-settings__mint-meta"},$s={class:"marketplace-settings__fee-row"},Vs={class:"marketplace-settings__fee-row"},Ss={class:"marketplace-settings__actions"},ws={key:0,class:"marketplace-settings__success"},Ms={key:1,class:"marketplace-settings__error"},Ts=le({__name:"AdminMarketplaceSettings",props:{slug:{},settings:{}},emits:["saved"],setup(_,{emit:y}){const p=[{mint:"So11111111111111111111111111111111111111112",name:"Wrapped SOL",symbol:"SOL"},{mint:"3NZ9JMVBmGAqocybic2c7LQCJScmgsAZ6vQqTDzcqmJh",name:"Wrapped Bitcoin (Portal)",symbol:"WBTC"},{mint:"EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v",name:"USD Coin",symbol:"USDC"},{mint:"Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB",name:"Tether USD",symbol:"USDT"}],S={programId:"whi5uDPWK4rAE9Sus6hdxdHwsG1hjDBn6kXM6pyqwTn",account:""},o=_,U=y,F=ve(),r=ge({collectionMints:[],splAssetMints:[],currencyMints:[],shopFee:{wallet:"",makerFlatFee:0,takerFlatFee:0,makerPercentFee:0,takerPercentFee:0},whitelist:{...S}}),V=j(()=>{const g=new Set(p.map(n=>n.mint));return r.currencyMints.filter(n=>!g.has(n.mint))}),T=j(()=>{const g=r.collectionMints.some(l=>l._loading),n=r.splAssetMints.some(l=>l._loading),e=V.value.some(l=>l._loading);return g||n||e}),P=j(()=>{const g=r.collectionMints.some(l=>l._error),n=r.splAssetMints.some(l=>l._error),e=V.value.some(l=>l._error);return g||n||e}),N=j(()=>!T.value&&!P.value),O=M(""),L=M(""),w=M(""),f=M(""),h=M(""),I=M(""),$=M(!1),v=M(null),a=M(!1),u=M(null),E=M(!1);function G(g){g._loading||g._error||(u.value=g,E.value=!0)}oe(()=>o.settings,g=>{if(!g)return;const n=g.collectionMints??[];r.collectionMints=n.map(A=>({mint:A.mint??"",name:A.name,image:A.image,sellerFeeBasisPoints:A.sellerFeeBasisPoints,groupPath:A.groupPath,collectionSize:A.collectionSize,uniqueTraitCount:A.uniqueTraitCount,traitTypes:A.traitTypes}));const e=g.splAssetMints??[];r.splAssetMints=e.map(A=>({mint:A.mint??"",name:A.name,symbol:A.symbol,image:A.image,decimals:A.decimals,sellerFeeBasisPoints:A.sellerFeeBasisPoints}));const l=g.currencyMints??[];r.currencyMints=l.length>0?l.map(A=>({...A,_loading:!1,_error:void 0})):[...p];const d=g.shopFee;d&&(r.shopFee.wallet=d.wallet??"",r.shopFee.makerFlatFee=Number(d.makerFlatFee)||0,r.shopFee.takerFlatFee=Number(d.takerFlatFee)||0,r.shopFee.makerPercentFee=Number(d.makerPercentFee)||0,r.shopFee.takerPercentFee=Number(d.takerPercentFee)||0);const b=g.whitelist??{};r.whitelist.programId=b.programId||S.programId,r.whitelist.account=b.account??"",Ve(()=>Y())},{immediate:!0});async function Y(){for(let g=0;g<r.collectionMints.length;g++){const n=r.collectionMints[g];if(!(n._loading||n._error||n.collectionSize!=null&&n.collectionSize>0))try{const e=await fetch(`${F.value}/api/v1/marketplace/asset-preview/collection/${encodeURIComponent(n.mint)}`);if(!e.ok)continue;const l=await e.json(),d=r.collectionMints[g];d&&d.mint===n.mint&&(d.collectionSize=l.collectionSize??0,d.uniqueTraitCount=l.uniqueTraitCount??0,d.traitTypes=l.traitTypes??[])}catch{}}}function ue(g,n){const e=p.find(l=>l.symbol===g);e&&(n?r.currencyMints.some(l=>l.mint===e.mint)||(r.currencyMints=[...r.currencyMints,e]):r.currencyMints=r.currencyMints.filter(l=>l.mint!==e.mint))}async function ee(){const g=O.value.trim();if(!g||g.length<32){L.value="Invalid mint address";return}if(r.collectionMints.some(l=>l.mint===g)){L.value="Collection already added";return}if(r.collectionMints.length>=250){L.value="Maximum 250 collections";return}L.value="";const n={mint:g,_loading:!0};r.collectionMints.push(n),O.value="";const e=r.collectionMints.length-1;try{const l=await fetch(`${F.value}/api/v1/marketplace/asset-preview/collection/${encodeURIComponent(g)}`);if(!l.ok){const b=await l.json().catch(()=>({}));throw new Error(b.message??`HTTP ${l.status}`)}const d=await l.json();r.collectionMints[e]={mint:g,name:d.name??void 0,image:d.image??void 0,sellerFeeBasisPoints:d.sellerFeeBasisPoints??void 0,collectionSize:d.collectionSize??0,uniqueTraitCount:d.uniqueTraitCount??0,traitTypes:d.traitTypes??[]}}catch(l){r.collectionMints[e]={...n,_loading:!1,_error:l instanceof Error?l.message:"Failed to load"}}}function Q(g){r.collectionMints.splice(g,1)}async function J(){const g=w.value.trim();if(!g||g.length<32){f.value="Invalid mint address";return}if(r.splAssetMints.some(l=>l.mint===g)){f.value="Mint already added";return}if(r.splAssetMints.length>=250){f.value="Maximum 250 SPL assets";return}f.value="";const n={mint:g,_loading:!0};r.splAssetMints.push(n),w.value="";const e=r.splAssetMints.length-1;try{const l=await fetch(`${F.value}/api/v1/marketplace/asset-preview/spl/${encodeURIComponent(g)}`);if(!l.ok){const b=await l.json().catch(()=>({}));throw new Error(b.message??`HTTP ${l.status}`)}const d=await l.json();r.splAssetMints[e]={mint:g,name:d.name??void 0,symbol:d.symbol??void 0,image:d.image??void 0,decimals:d.decimals??void 0,sellerFeeBasisPoints:d.sellerFeeBasisPoints??void 0}}catch(l){r.splAssetMints[e]={...n,_loading:!1,_error:l instanceof Error?l.message:"Failed to load"}}}function me(g){r.splAssetMints.splice(g,1)}async function ie(){const g=h.value.trim();if(!g||g.length<32){I.value="Invalid mint address";return}if(new Set(p.map(d=>d.mint)).has(g)){I.value="Already in base currencies";return}if(r.currencyMints.some(d=>d.mint===g)){I.value="Currency already added";return}I.value="";const e={mint:g,name:"",symbol:"",_loading:!0};r.currencyMints.push(e),h.value="";const l=r.currencyMints.length-1;try{const d=await fetch(`${F.value}/api/v1/marketplace/asset-preview/spl/${encodeURIComponent(g)}`);if(!d.ok){const A=await d.json().catch(()=>({}));throw new Error(A.message??A.error??`HTTP ${d.status}`)}const b=await d.json();r.currencyMints[l]={mint:g,name:b.name??"",symbol:b.symbol??"",image:b.image??void 0,decimals:b.decimals??void 0,sellerFeeBasisPoints:b.sellerFeeBasisPoints??void 0}}catch(d){r.currencyMints[l]={...e,_loading:!1,_error:d instanceof Error?d.message:"Failed to load"}}}function ye(g){const n=new Set(p.map(d=>d.mint)),l=r.currencyMints.filter(d=>!n.has(d.mint))[g];if(l){const d=r.currencyMints.indexOf(l);d>=0&&r.currencyMints.splice(d,1)}}function he(){return{collectionMints:r.collectionMints.filter(g=>!g._error).map(g=>({mint:g.mint,name:g.name,image:g.image,sellerFeeBasisPoints:g.sellerFeeBasisPoints,groupPath:g.groupPath,collectionSize:g.collectionSize,uniqueTraitCount:g.uniqueTraitCount,traitTypes:g.traitTypes})),splAssetMints:r.splAssetMints.filter(g=>!g._error).map(g=>({mint:g.mint,name:g.name,symbol:g.symbol,decimals:g.decimals,image:g.image,sellerFeeBasisPoints:g.sellerFeeBasisPoints})),currencyMints:r.currencyMints.filter(g=>!("_error"in g&&g._error)).map(g=>({mint:g.mint,name:g.name??"",symbol:g.symbol??"",decimals:g.decimals,image:g.image,sellerFeeBasisPoints:g.sellerFeeBasisPoints})),shopFee:r.shopFee,whitelist:r.whitelist}}async function fe(){if(!(!o.slug||!N.value)){$.value=!0,v.value=null,a.value=!1;try{const g=await fetch(`${F.value}/api/v1/tenant/${o.slug}/marketplace-settings`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(he())});if(!g.ok){let l=(await g.json().catch(()=>({}))).error??"Failed to save";throw g.status===401&&(l="Sign in with your wallet to save. Session may have expired."),g.status===403&&(l="Admin access required."),new Error(l)}const n=await g.json();a.value=!0,setTimeout(()=>{a.value=!1},3e3),U("saved",n.settings??{})}catch(g){v.value=g instanceof Error?g.message:"Failed to save"}finally{$.value=!1}}}return(g,n)=>(i(),m("div",Ft,[c(t(te),null,{default:R(()=>[n[13]||(n[13]=s("h3",null,"NFT collections",-1)),n[14]||(n[14]=s("p",{class:"marketplace-settings__hint"},"Collection mint addresses. Each collection is expanded via DAS into individual NFTs.",-1)),s("div",At,[c(t(C),{modelValue:O.value,"onUpdate:modelValue":n[0]||(n[0]=e=>O.value=e),placeholder:"Collection mint (e.g. CL2m6...)",error:L.value,onKeydown:be(_e(ee,["prevent"]),["enter"])},null,8,["modelValue","error","onKeydown"]),c(t(q),{variant:"secondary",disabled:!O.value.trim()||$.value,onClick:ee},{default:R(()=>[...n[11]||(n[11]=[H(" Add ",-1)])]),_:1},8,["disabled"])]),r.collectionMints.length?(i(),m("ul",It,[(i(!0),m(D,null,z(r.collectionMints,(e,l)=>(i(),m("li",{key:e.mint,class:"marketplace-settings__mint-item marketplace-settings__mint-item--clickable"},[s("button",{type:"button",class:"marketplace-settings__mint-row",disabled:!!e._loading||!!e._error,onClick:d=>G(e)},[s("div",Pt,[e.image?(i(),m("img",{key:0,src:e.image,alt:e.name??e.mint},null,8,Bt)):(i(),m("span",Dt,[c(t(x),{icon:"mdi:image-off"})]))]),s("div",Rt,[e._loading?(i(),m(D,{key:0},[c(t(x),{icon:"mdi:loading",class:"marketplace-settings__spinner"}),s("span",Et,k(e.mint.slice(0,8)+"..."+e.mint.slice(-4)),1),n[12]||(n[12]=s("span",{class:"marketplace-settings__mint-status"},"Loading...",-1))],64)):e._error?(i(),m(D,{key:1},[s("span",xt,k(e.mint.slice(0,8)+"..."),1),s("span",Lt,k(e._error),1)],64)):(i(),m(D,{key:2},[s("span",Nt,k(e.name||e.mint.slice(0,8)+"..."),1),s("code",Ot,k(e.mint.slice(0,8))+"..."+k(e.mint.slice(-6)),1),s("span",jt,[H(k(e.collectionSize??0)+" NFTs, "+k(e.uniqueTraitCount??0)+" trait types ",1),e.sellerFeeBasisPoints!=null?(i(),m("span",qt," · "+k(e.sellerFeeBasisPoints)+" bps",1)):B("",!0),(e.traitTypes?.length??0)>0?(i(),m("span",Ht," ("+k(e.traitTypes.slice(0,3).join(", "))+k((e.traitTypes.length??0)>3?"...":"")+") ",1)):B("",!0)])],64))])],8,Ut),c(t(q),{variant:"ghost",disabled:!!e._loading,onClick:_e(d=>Q(l),["stop"])},{default:R(()=>[c(t(x),{icon:"mdi:close"})]),_:1},8,["disabled","onClick"])]))),128))])):(i(),m("p",Wt,"No NFT collections. Add a collection mint above."))]),_:1}),c(t(te),null,{default:R(()=>[n[17]||(n[17]=s("h3",null,"SPL assets",-1)),n[18]||(n[18]=s("p",{class:"marketplace-settings__hint"},"Individual SPL token mints (one mint = one asset).",-1)),s("div",zt,[c(t(C),{modelValue:w.value,"onUpdate:modelValue":n[1]||(n[1]=e=>w.value=e),placeholder:"Mint address",error:f.value,onKeydown:be(_e(J,["prevent"]),["enter"])},null,8,["modelValue","error","onKeydown"]),c(t(q),{variant:"secondary",disabled:!w.value.trim()||$.value,onClick:J},{default:R(()=>[...n[15]||(n[15]=[H(" Add ",-1)])]),_:1},8,["disabled"])]),r.splAssetMints.length?(i(),m("ul",Gt,[(i(!0),m(D,null,z(r.splAssetMints,(e,l)=>(i(),m("li",{key:e.mint,class:"marketplace-settings__mint-item"},[s("div",Kt,[s("div",Jt,[e.image?(i(),m("img",{key:0,src:e.image,alt:e.name??e.symbol??e.mint},null,8,Yt)):(i(),m("span",Zt,[c(t(x),{icon:"mdi:token"})]))]),s("div",Qt,[e._loading?(i(),m(D,{key:0},[c(t(x),{icon:"mdi:loading",class:"marketplace-settings__spinner"}),s("span",Xt,k(e.mint.slice(0,8)+"..."+e.mint.slice(-4)),1),n[16]||(n[16]=s("span",{class:"marketplace-settings__mint-status"},"Loading...",-1))],64)):e._error?(i(),m(D,{key:1},[s("span",es,k(e.mint.slice(0,8)+"..."+e.mint.slice(-4)),1),s("span",ts,k(e._error),1)],64)):(i(),m(D,{key:2},[s("span",ss,k(e.symbol||e.name||e.mint.slice(0,8)+"..."),1),s("code",ls,k(e.mint.slice(0,8))+"..."+k(e.mint.slice(-6)),1),s("span",ns,k(e.name||"")+" "+k(e.decimals!=null?`· ${e.decimals} dec`:"")+" "+k(e.sellerFeeBasisPoints!=null?`· ${e.sellerFeeBasisPoints} bps`:""),1)],64))])]),c(t(q),{variant:"ghost",disabled:!!e._loading,onClick:d=>me(l)},{default:R(()=>[c(t(x),{icon:"mdi:close"})]),_:1},8,["disabled","onClick"])]))),128))])):(i(),m("p",as,"No SPL assets. Add a mint above."))]),_:1}),c(t(te),null,{default:R(()=>[n[22]||(n[22]=s("h3",null,"Currencies",-1)),n[23]||(n[23]=s("p",{class:"marketplace-settings__hint"},"Base: SOL, WBTC, USDC, USDT. Add custom by mint.",-1)),s("div",os,[(i(),m(D,null,z(p,e=>s("label",{key:e.symbol,class:"marketplace-settings__checkbox"},[s("input",{checked:r.currencyMints.some(l=>l.mint===e.mint),type:"checkbox",onChange:l=>ue(e.symbol,l.target.checked)},null,40,is),s("span",null,k(e.symbol),1)])),64))]),s("div",rs,[n[21]||(n[21]=s("p",{class:"marketplace-settings__hint"},"Custom currencies",-1)),s("div",ds,[c(t(C),{modelValue:h.value,"onUpdate:modelValue":n[2]||(n[2]=e=>h.value=e),placeholder:"Mint address",error:I.value,onKeydown:be(_e(ie,["prevent"]),["enter"])},null,8,["modelValue","error","onKeydown"]),c(t(q),{variant:"secondary",disabled:!h.value.trim()||$.value,onClick:ie},{default:R(()=>[...n[19]||(n[19]=[H(" Add ",-1)])]),_:1},8,["disabled"])]),V.value.length?(i(),m("ul",cs,[(i(!0),m(D,null,z(V.value,(e,l)=>(i(),m("li",{key:e.mint,class:"marketplace-settings__mint-item"},[s("div",us,[s("div",ms,[e.image?(i(),m("img",{key:0,src:e.image,alt:e.name??e.symbol??e.mint},null,8,_s)):(i(),m("span",ps,[c(t(x),{icon:"mdi:cash-multiple"})]))]),s("div",gs,[e._loading?(i(),m(D,{key:0},[c(t(x),{icon:"mdi:loading",class:"marketplace-settings__spinner"}),s("span",vs,k(e.mint.slice(0,8)+"..."+e.mint.slice(-4)),1),n[20]||(n[20]=s("span",{class:"marketplace-settings__mint-status"},"Loading...",-1))],64)):e._error?(i(),m(D,{key:1},[s("span",ys,k(e.mint.slice(0,8)+"..."+e.mint.slice(-4)),1),s("span",hs,k(e._error),1)],64)):(i(),m(D,{key:2},[s("span",fs,k(e.symbol||e.name||e.mint.slice(0,8)+"..."),1),s("code",bs,k(e.mint.slice(0,8))+"..."+k(e.mint.slice(-6)),1),s("span",ks,k(e.name||"")+" "+k(e.decimals!=null?`· ${e.decimals} dec`:"")+" "+k(e.sellerFeeBasisPoints!=null?`· ${e.sellerFeeBasisPoints} bps`:""),1)],64))])]),c(t(q),{variant:"ghost",disabled:!!e._loading,onClick:d=>ye(l)},{default:R(()=>[c(t(x),{icon:"mdi:close"})]),_:1},8,["disabled","onClick"])]))),128))])):B("",!0)])]),_:1}),c(t(te),null,{default:R(()=>[n[24]||(n[24]=s("h3",null,"Fees",-1)),c(t(C),{modelValue:r.shopFee.wallet,"onUpdate:modelValue":n[3]||(n[3]=e=>r.shopFee.wallet=e),label:"Fee recipient wallet",placeholder:"Wallet address"},null,8,["modelValue"]),s("div",$s,[c(t(C),{modelValue:r.shopFee.makerFlatFee,"onUpdate:modelValue":n[4]||(n[4]=e=>r.shopFee.makerFlatFee=e),modelModifiers:{number:!0},type:"number",label:"Maker flat fee (SOL)",placeholder:"0"},null,8,["modelValue"]),c(t(C),{modelValue:r.shopFee.takerFlatFee,"onUpdate:modelValue":n[5]||(n[5]=e=>r.shopFee.takerFlatFee=e),modelModifiers:{number:!0},type:"number",label:"Taker flat fee (SOL)",placeholder:"0"},null,8,["modelValue"])]),s("div",Vs,[c(t(C),{modelValue:r.shopFee.makerPercentFee,"onUpdate:modelValue":n[6]||(n[6]=e=>r.shopFee.makerPercentFee=e),modelModifiers:{number:!0},type:"number",label:"Maker % (basis points)",placeholder:"0"},null,8,["modelValue"]),c(t(C),{modelValue:r.shopFee.takerPercentFee,"onUpdate:modelValue":n[7]||(n[7]=e=>r.shopFee.takerPercentFee=e),modelModifiers:{number:!0},type:"number",label:"Taker % (basis points)",placeholder:"0"},null,8,["modelValue"])])]),_:1}),c(t(te),null,{default:R(()=>[n[25]||(n[25]=s("h3",null,"Whitelist",-1)),n[26]||(n[26]=s("p",{class:"marketplace-settings__hint"},"Escrow program uses these for whitelist-protected trades. Empty account = no whitelist.",-1)),c(t(C),{modelValue:r.whitelist.programId,"onUpdate:modelValue":n[8]||(n[8]=e=>r.whitelist.programId=e),label:"Whitelist program ID",placeholder:"whi5uDPWK4rAE9Sus6hdxdHwsG1hjDBn6kXM6pyqwTn"},null,8,["modelValue"]),c(t(C),{modelValue:r.whitelist.account,"onUpdate:modelValue":n[9]||(n[9]=e=>r.whitelist.account=e),label:"Whitelist account (optional)",placeholder:"Leave empty for public escrows"},null,8,["modelValue"])]),_:1}),s("div",Ss,[c(t(q),{variant:"primary",disabled:$.value||!N.value,onClick:fe},{default:R(()=>[H(k($.value?"Saving...":a.value?"Saved":N.value?"Save Marketplace Settings":"Complete loading before saving"),1)]),_:1},8,["disabled"]),a.value?(i(),m("p",ws,"Settings saved.")):v.value?(i(),m("p",Ms,k(v.value),1)):B("",!0)]),c(Ct,{modelValue:E.value,"onUpdate:modelValue":n[10]||(n[10]=e=>E.value=e),collection:u.value,slug:_.slug},null,8,["modelValue","collection","slug"])]))}}),Cs=Object.assign(ne(Ts,[["__scopeId","data-v-884994fa"]]),{__name:"AdminMarketplaceSettings"}),Fs={class:"onboarding"},As={class:"onboarding__benefits"},Is={class:"onboarding__benefit"},Us={class:"onboarding__benefit"},Ps={class:"onboarding__benefit"},Bs={class:"onboarding__benefit"},Ds={class:"onboarding__benefit"},Rs={class:"onboarding__actions"},Es=le({__name:"AdminMarketplaceOnboardingModal",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(_){return(y,p)=>(i(),se(t(We),{"model-value":_.modelValue,title:"Your Marketplace. Your Brand. Your Rules.","onUpdate:modelValue":p[1]||(p[1]=S=>y.$emit("update:modelValue",S))},{default:R(()=>[s("div",Fs,[p[8]||(p[8]=s("p",{class:"onboarding__intro"}," Launch a fully branded Solana marketplace. Set your fees, choose your currencies, and start earning from every trade. ",-1)),s("div",As,[s("div",Is,[c(t(x),{icon:"mdi:shield-lock-outline",class:"onboarding__icon"}),p[2]||(p[2]=s("span",null,"Self-custody: users keep control of their assets",-1))]),s("div",Us,[c(t(x),{icon:"mdi:palette",class:"onboarding__icon"}),p[3]||(p[3]=s("span",null,"Full branding: your storefront, your look",-1))]),s("div",Ps,[c(t(x),{icon:"mdi:wallet",class:"onboarding__icon"}),p[4]||(p[4]=s("span",null,"Multi-currency: SOL, USDC, custom tokens",-1))]),s("div",Bs,[c(t(x),{icon:"mdi:currency-usd",class:"onboarding__icon"}),p[5]||(p[5]=s("span",null,"Set your fees: monetize every transaction",-1))]),s("div",Ds,[c(t(x),{icon:"mdi:shield-check",class:"onboarding__icon"}),p[6]||(p[6]=s("span",null,"Royalties protected",-1))])]),p[9]||(p[9]=s("p",{class:"onboarding__bullets"}," Trade NFTs and tokens, up to 250 mints per collection. Configure custom fees and standard or custom currencies. ",-1)),s("div",Rs,[c(t(q),{variant:"primary",onClick:p[0]||(p[0]=S=>y.$emit("update:modelValue",!1))},{default:R(()=>[...p[7]||(p[7]=[H(" Got it ",-1)])]),_:1})])])]),_:1},8,["model-value"]))}}),xs=Object.assign(ne(Es,[["__scopeId","data-v-932ad3e4"]]),{__name:"AdminMarketplaceOnboardingModal"});function pe(_){const y=String(_).trim().replace(/^#/,"");return y.length===6&&/^[0-9a-fA-F]{6}$/.test(y)?{r:parseInt(y.slice(0,2),16),g:parseInt(y.slice(2,4),16),b:parseInt(y.slice(4,6),16)}:y.length===3&&/^[0-9a-fA-F]{3}$/.test(y)?{r:parseInt(y[0]+y[0],16),g:parseInt(y[1]+y[1],16),b:parseInt(y[2]+y[2],16)}:null}function we(_,y,p){const S=o=>Math.round(Math.max(0,Math.min(255,o)));return"#"+[_,y,p].map(S).map(o=>o.toString(16).padStart(2,"0")).join("")}function Z(_,y){const p=pe(_);if(!p)return _;const{r:S,g:o,b:U}=p,F=255;return we(S+(F-S)*y,o+(F-o)*y,U+(F-U)*y)}function X(_,y){const p=pe(_);if(!p)return _;const{r:S,g:o,b:U}=p;return we(S*(1-y),o*(1-y),U*(1-y))}function Ls(_,y,p){const S=pe(_),o=pe(y);return!S||!o?y:we(S.r+(o.r-S.r)*p,S.g+(o.g-S.g)*p,S.b+(o.b-S.b)*p)}const $e=[{sm:"0",md:"0",lg:"0",xl:"0",full:"0"},{sm:"0.2rem",md:"0.3rem",lg:"0.4rem",xl:"0.5rem",full:"9999px"},{sm:"0.375rem",md:"0.5rem",lg:"0.75rem",xl:"1rem",full:"9999px"},{sm:"0.5rem",md:"0.75rem",lg:"1rem",xl:"1.25rem",full:"9999px"},{sm:"0.75rem",md:"1rem",lg:"1.25rem",xl:"1.5rem",full:"9999px"}];function Ns(_){const y=_.borderRadius?.md??"";for(let p=0;p<$e.length;p++)if($e[p].md===y)return p;return 2}function ke(_){const y=String(_).trim(),p=y.match(/^([\d.]+)\s*rem$/);if(p)return Number(p[1]);const S=parseFloat(y);return Number.isFinite(S)?S:1}const Os={class:"theme-settings"},js={class:"theme-settings__form"},qs={class:"theme-settings__section"},Hs={class:"theme-settings__section",open:""},Ws={class:"theme-settings__grid theme-settings__grid--two"},zs={class:"theme-settings__group"},Gs={class:"theme-settings__group"},Ks={class:"theme-settings__group"},Js={class:"theme-settings__group"},Ys={class:"theme-settings__section"},Zs={class:"theme-settings__group"},Qs={class:"theme-settings__typography-row"},Xs={class:"theme-settings__section"},el={class:"theme-settings__slider-row"},tl={class:"theme-settings__slider-value"},sl={class:"theme-settings__section"},ll={class:"theme-settings__grid theme-settings__grid--small"},nl={class:"theme-settings__grid theme-settings__grid--small"},al=le({__name:"AdminThemeSettings",props:{branding:{}},setup(_){const y=_,p=`radius-slider-${Math.random().toString(36).slice(2)}`,S=["None","Slight","Medium","Rounded","Full"],o=ge({primary:"",secondary:"",accent:"",backgroundPage:"",textPrimary:"",textMuted:"",border:"",statusSuccess:"",statusError:"",statusWarning:"",statusInfo:"",tradeBuy:"",tradeSell:"",tradeTrade:""}),U=M("0.875"),F=M("1"),r=M("1.25"),V=M(2);function T(v){return/^#?[0-9a-fA-F]{3}$/.test(v.trim())||/^#?[0-9a-fA-F]{6}$/.test(v.trim())}function P(v){const a=String(v).trim().replace(/^#/,"");return a.length===3?"#"+a.split("").map(u=>u+u).join(""):a.length===6?"#"+a:v}function N(){const v=y.branding.theme,a=v.colors??{};o.primary=a.primary?.main??"",o.secondary=a.secondary?.main??"",o.accent=a.accent?.main??"",o.backgroundPage=a.background?.primary??"",o.textPrimary=a.text?.primary??"",o.textMuted=a.text?.muted??"",o.border=a.border?.default??"",o.statusSuccess=a.status?.success??"",o.statusError=a.status?.error??"",o.statusWarning=a.status?.warning??"",o.statusInfo=a.status?.info??"",o.tradeBuy=a.trade?.buy??"",o.tradeSell=a.trade?.sell??"",o.tradeTrade=a.trade?.trade??"";const u=v.fontSize??{};U.value=String(ke(u.sm??"0.875rem")),F.value=String(ke(u.base??"1rem")),r.value=String(ke(u.lg??"1.125rem")),V.value=Ns(v)}function O(){const v=y.branding.theme.colors??{},a=o.backgroundPage&&T(o.backgroundPage)?P(o.backgroundPage):v.background?.primary??"#1a1a2e",u=o.border&&T(o.border)?P(o.border):X(a,.12),E=Z(u,.1),G=o.textPrimary&&T(o.textPrimary)?P(o.textPrimary):v.text?.primary??"#ffffff",Y=o.textMuted&&T(o.textMuted)?P(o.textMuted):v.text?.muted??"#6b6b80",ue=Ls(G,Y,.5),ee=o.primary&&T(o.primary)?P(o.primary):v.primary?.main??"#00951a",Q=o.secondary&&T(o.secondary)?P(o.secondary):v.secondary?.main??"#cf0000",J=o.accent&&T(o.accent)?P(o.accent):v.accent?.main??"#8b5cf6",me={primary:{main:ee,hover:X(ee,.08),light:Z(ee,.2),dark:X(ee,.15)},secondary:{main:Q,hover:X(Q,.08),light:Z(Q,.2),dark:X(Q,.15)},accent:{main:J,hover:X(J,.1)},background:{primary:a,secondary:Z(a,.03),card:Z(a,.05)},text:{primary:G,secondary:ue,muted:Y},border:{default:u,light:E},status:{success:o.statusSuccess&&T(o.statusSuccess)?P(o.statusSuccess):v.status?.success??"#00951a",error:o.statusError&&T(o.statusError)?P(o.statusError):v.status?.error??"#cf0000",warning:o.statusWarning&&T(o.statusWarning)?P(o.statusWarning):v.status?.warning??"#ff6b35",info:o.statusInfo&&T(o.statusInfo)?P(o.statusInfo):v.status?.info??"#00d4ff"},trade:{buy:o.tradeBuy&&T(o.tradeBuy)?P(o.tradeBuy):v.trade?.buy??"#00ff00",buyHover:o.tradeBuy&&T(o.tradeBuy)?X(P(o.tradeBuy),.1):v.trade?.buyHover??"#00cc00",buyLight:o.tradeBuy&&T(o.tradeBuy)?Z(P(o.tradeBuy),.15):v.trade?.buyLight??"#33ff33",sell:o.tradeSell&&T(o.tradeSell)?P(o.tradeSell):v.trade?.sell??"#ff0000",sellHover:o.tradeSell&&T(o.tradeSell)?X(P(o.tradeSell),.1):v.trade?.sellHover??"#cc0000",sellLight:o.tradeSell&&T(o.tradeSell)?Z(P(o.tradeSell),.15):v.trade?.sellLight??"#ff3333",trade:o.tradeTrade&&T(o.tradeTrade)?P(o.tradeTrade):v.trade?.trade??"#ffaa00",tradeHover:o.tradeTrade&&T(o.tradeTrade)?X(P(o.tradeTrade),.1):v.trade?.tradeHover??"#cc8800",tradeLight:o.tradeTrade&&T(o.tradeTrade)?Z(P(o.tradeTrade),.15):v.trade?.tradeLight??"#ffbb33",swap:J,swapHover:X(J,.1),swapLight:Z(J,.2)},window:{background:Z(a,.05),border:u,header:Z(a,.03)}};y.branding.theme.colors=me}function L(){const v=parseFloat(U.value)||.875,a=parseFloat(F.value)||1,u=parseFloat(r.value)||1.25,E=G=>`${G}rem`;y.branding.theme.fontSize={xs:E(v*.9),sm:E(v),base:E(a),lg:E(u),xl:E(u*1.1),"2xl":E(u*1.25),"3xl":E(u*1.5),"4xl":E(u*1.75),"5xl":E(u*2)}}function w(){const v=$e[Math.max(0,Math.min(4,V.value))];y.branding.theme.borderRadius={sm:v.sm,md:v.md,lg:v.lg,xl:v.xl,full:v.full}}let f=!1;oe(()=>y.branding,async()=>{f=!0,N(),await Ve(),f=!1},{immediate:!0}),oe(()=>({...o}),()=>{f||O()},{deep:!0}),oe([U,F,r],()=>{f||L()},{immediate:!0}),oe(V,()=>{f||w()},{immediate:!0});const h=j({get:()=>(y.branding.theme.fonts?.primary??[]).join(", "),set:v=>{y.branding.theme.fonts=y.branding.theme.fonts??{primary:[],mono:[]},y.branding.theme.fonts.primary=v.split(",").map(a=>a.trim()).filter(Boolean)}}),I=j({get:()=>(y.branding.theme.fonts?.mono??[]).join(", "),set:v=>{y.branding.theme.fonts=y.branding.theme.fonts??{primary:[],mono:[]},y.branding.theme.fonts.mono=v.split(",").map(a=>a.trim()).filter(Boolean)}}),$=j(()=>{const v=Be(y.branding.theme),a={};for(const[u,E]of Object.entries(v))E&&(a[u]=E);return a});return(v,a)=>(i(),m("div",Os,[s("div",js,[s("section",qs,[a[36]||(a[36]=s("h3",{class:"theme-settings__heading"},"Branding",-1)),c(t(C),{modelValue:_.branding.logo,"onUpdate:modelValue":a[0]||(a[0]=u=>_.branding.logo=u),label:"Logo URL",placeholder:"https://..."},null,8,["modelValue"])]),s("details",Hs,[a[41]||(a[41]=s("summary",{class:"theme-settings__heading"},"Colors",-1)),a[42]||(a[42]=s("p",{class:"theme-settings__hint"},"Set main colours; hover and variants are derived.",-1)),s("div",Ws,[s("div",zs,[a[37]||(a[37]=s("h4",{class:"theme-settings__sub"},"Brand",-1)),c(t(K),{modelValue:o.primary,"onUpdate:modelValue":a[1]||(a[1]=u=>o.primary=u),label:"Primary (buttons, links)"},null,8,["modelValue"]),c(t(K),{modelValue:o.secondary,"onUpdate:modelValue":a[2]||(a[2]=u=>o.secondary=u),label:"Secondary"},null,8,["modelValue"]),c(t(K),{modelValue:o.accent,"onUpdate:modelValue":a[3]||(a[3]=u=>o.accent=u),label:"Accent"},null,8,["modelValue"])]),s("div",Gs,[a[38]||(a[38]=s("h4",{class:"theme-settings__sub"},"Surfaces & text",-1)),c(t(K),{modelValue:o.backgroundPage,"onUpdate:modelValue":a[4]||(a[4]=u=>o.backgroundPage=u),label:"Background (page)"},null,8,["modelValue"]),c(t(K),{modelValue:o.textPrimary,"onUpdate:modelValue":a[5]||(a[5]=u=>o.textPrimary=u),label:"Text"},null,8,["modelValue"]),c(t(K),{modelValue:o.textMuted,"onUpdate:modelValue":a[6]||(a[6]=u=>o.textMuted=u),label:"Text muted"},null,8,["modelValue"]),c(t(K),{modelValue:o.border,"onUpdate:modelValue":a[7]||(a[7]=u=>o.border=u),label:"Border (leave empty to derive)"},null,8,["modelValue"])]),s("div",Ks,[a[39]||(a[39]=s("h4",{class:"theme-settings__sub"},"Status",-1)),c(t(K),{modelValue:o.statusSuccess,"onUpdate:modelValue":a[8]||(a[8]=u=>o.statusSuccess=u),label:"Success"},null,8,["modelValue"]),c(t(K),{modelValue:o.statusError,"onUpdate:modelValue":a[9]||(a[9]=u=>o.statusError=u),label:"Error"},null,8,["modelValue"]),c(t(K),{modelValue:o.statusWarning,"onUpdate:modelValue":a[10]||(a[10]=u=>o.statusWarning=u),label:"Warning"},null,8,["modelValue"]),c(t(K),{modelValue:o.statusInfo,"onUpdate:modelValue":a[11]||(a[11]=u=>o.statusInfo=u),label:"Info"},null,8,["modelValue"])]),s("div",Js,[a[40]||(a[40]=s("h4",{class:"theme-settings__sub"},"Trade (market)",-1)),c(t(K),{modelValue:o.tradeBuy,"onUpdate:modelValue":a[12]||(a[12]=u=>o.tradeBuy=u),label:"Buy"},null,8,["modelValue"]),c(t(K),{modelValue:o.tradeSell,"onUpdate:modelValue":a[13]||(a[13]=u=>o.tradeSell=u),label:"Sell"},null,8,["modelValue"]),c(t(K),{modelValue:o.tradeTrade,"onUpdate:modelValue":a[14]||(a[14]=u=>o.tradeTrade=u),label:"Trade"},null,8,["modelValue"])])])]),s("details",Ys,[a[43]||(a[43]=s("summary",{class:"theme-settings__heading"},"Typography",-1)),a[44]||(a[44]=s("p",{class:"theme-settings__hint"},"Three sizes control the scale: small (labels, captions), body (main text), heading (titles).",-1)),s("div",Zs,[c(t(C),{modelValue:h.value,"onUpdate:modelValue":a[15]||(a[15]=u=>h.value=u),label:"Font family (primary)",placeholder:"Inter, sans-serif"},null,8,["modelValue"]),c(t(C),{modelValue:I.value,"onUpdate:modelValue":a[16]||(a[16]=u=>I.value=u),label:"Font family (mono)",placeholder:"JetBrains Mono, monospace"},null,8,["modelValue"])]),s("div",Qs,[c(t(C),{modelValue:U.value,"onUpdate:modelValue":a[17]||(a[17]=u=>U.value=u),label:"Small (rem)",placeholder:"0.875"},null,8,["modelValue"]),c(t(C),{modelValue:F.value,"onUpdate:modelValue":a[18]||(a[18]=u=>F.value=u),label:"Body (rem)",placeholder:"1"},null,8,["modelValue"]),c(t(C),{modelValue:r.value,"onUpdate:modelValue":a[19]||(a[19]=u=>r.value=u),label:"Heading (rem)",placeholder:"1.25"},null,8,["modelValue"])])]),s("details",Xs,[a[46]||(a[46]=s("summary",{class:"theme-settings__heading"},"Rounding",-1)),a[47]||(a[47]=s("p",{class:"theme-settings__hint"},"One slider sets corner radius for the whole theme.",-1)),s("div",el,[s("label",{class:"theme-settings__slider-label",for:p},"Sharp"),ae(s("input",{id:p,"onUpdate:modelValue":a[20]||(a[20]=u=>V.value=u),type:"range",min:"0",max:"4",step:"1",class:"theme-settings__slider"},null,512),[[Ie,V.value,void 0,{number:!0}]]),a[45]||(a[45]=s("label",{class:"theme-settings__slider-label"},"Round",-1))]),s("p",tl,k(S[V.value]),1)]),s("details",sl,[a[48]||(a[48]=s("summary",{class:"theme-settings__heading"},"Spacing & effects",-1)),s("div",ll,[c(t(C),{modelValue:_.branding.theme.spacing.xs,"onUpdate:modelValue":a[21]||(a[21]=u=>_.branding.theme.spacing.xs=u),label:"Space xs"},null,8,["modelValue"]),c(t(C),{modelValue:_.branding.theme.spacing.sm,"onUpdate:modelValue":a[22]||(a[22]=u=>_.branding.theme.spacing.sm=u),label:"Space sm"},null,8,["modelValue"]),c(t(C),{modelValue:_.branding.theme.spacing.md,"onUpdate:modelValue":a[23]||(a[23]=u=>_.branding.theme.spacing.md=u),label:"Space md"},null,8,["modelValue"]),c(t(C),{modelValue:_.branding.theme.spacing.lg,"onUpdate:modelValue":a[24]||(a[24]=u=>_.branding.theme.spacing.lg=u),label:"Space lg"},null,8,["modelValue"]),c(t(C),{modelValue:_.branding.theme.spacing.xl,"onUpdate:modelValue":a[25]||(a[25]=u=>_.branding.theme.spacing.xl=u),label:"Space xl"},null,8,["modelValue"]),c(t(C),{modelValue:_.branding.theme.spacing["2xl"],"onUpdate:modelValue":a[26]||(a[26]=u=>_.branding.theme.spacing["2xl"]=u),label:"Space 2xl"},null,8,["modelValue"])]),s("div",nl,[c(t(C),{modelValue:_.branding.theme.borderWidth.thin,"onUpdate:modelValue":a[27]||(a[27]=u=>_.branding.theme.borderWidth.thin=u),label:"Border thin"},null,8,["modelValue"]),c(t(C),{modelValue:_.branding.theme.borderWidth.medium,"onUpdate:modelValue":a[28]||(a[28]=u=>_.branding.theme.borderWidth.medium=u),label:"Border medium"},null,8,["modelValue"]),c(t(C),{modelValue:_.branding.theme.borderWidth.thick,"onUpdate:modelValue":a[29]||(a[29]=u=>_.branding.theme.borderWidth.thick=u),label:"Border thick"},null,8,["modelValue"])]),c(t(C),{modelValue:_.branding.theme.shadows.glow,"onUpdate:modelValue":a[30]||(a[30]=u=>_.branding.theme.shadows.glow=u),label:"Shadow glow",placeholder:"0 0 20px rgba(...)"},null,8,["modelValue"]),c(t(C),{modelValue:_.branding.theme.shadows.glowHover,"onUpdate:modelValue":a[31]||(a[31]=u=>_.branding.theme.shadows.glowHover=u),label:"Shadow glow hover"},null,8,["modelValue"]),c(t(C),{modelValue:_.branding.theme.shadows.card,"onUpdate:modelValue":a[32]||(a[32]=u=>_.branding.theme.shadows.card=u),label:"Shadow card"},null,8,["modelValue"]),c(t(C),{modelValue:_.branding.theme.gradients.primary,"onUpdate:modelValue":a[33]||(a[33]=u=>_.branding.theme.gradients.primary=u),label:"Gradient primary",placeholder:"linear-gradient(...)"},null,8,["modelValue"]),c(t(C),{modelValue:_.branding.theme.gradients.secondary,"onUpdate:modelValue":a[34]||(a[34]=u=>_.branding.theme.gradients.secondary=u),label:"Gradient secondary"},null,8,["modelValue"]),c(t(C),{modelValue:_.branding.theme.gradients.accent,"onUpdate:modelValue":a[35]||(a[35]=u=>_.branding.theme.gradients.accent=u),label:"Gradient accent"},null,8,["modelValue"])])]),s("aside",{class:"theme-settings__preview",style:Pe($.value)},[...a[49]||(a[49]=[Ue('<p class="theme-settings__preview-label" data-v-cd24e24f>Preview</p><div class="theme-settings__preview-content" data-v-cd24e24f><div class="theme-settings__preview-buttons" data-v-cd24e24f><button type="button" class="theme-settings__btn theme-settings__btn--primary" data-v-cd24e24f> Primary </button><button type="button" class="theme-settings__btn theme-settings__btn--secondary" data-v-cd24e24f> Secondary </button></div><div class="theme-settings__preview-card" data-v-cd24e24f><p class="theme-settings__preview-title" data-v-cd24e24f>Card title</p><p class="theme-settings__preview-body" data-v-cd24e24f>Body text and secondary text.</p><p class="theme-settings__preview-muted" data-v-cd24e24f>Muted caption</p></div><div class="theme-settings__preview-status" data-v-cd24e24f><span class="theme-settings__pill theme-settings__pill--success" data-v-cd24e24f>Success</span><span class="theme-settings__pill theme-settings__pill--error" data-v-cd24e24f>Error</span><span class="theme-settings__pill theme-settings__pill--warning" data-v-cd24e24f>Warning</span><span class="theme-settings__pill theme-settings__pill--info" data-v-cd24e24f>Info</span></div><div class="theme-settings__preview-trade" data-v-cd24e24f><span class="theme-settings__chip theme-settings__chip--buy" data-v-cd24e24f>Buy</span><span class="theme-settings__chip theme-settings__chip--sell" data-v-cd24e24f>Sell</span><span class="theme-settings__chip theme-settings__chip--trade" data-v-cd24e24f>Trade</span></div></div>',2)])],4)]))}}),ol=Object.assign(ne(al,[["__scopeId","data-v-cd24e24f"]]),{__name:"AdminThemeSettings"}),il={key:0,class:"discord-server-card__loading"},rl={key:1,class:"discord-server-card__connected"},dl={class:"discord-server-card__status"},cl={key:0,class:"discord-server-card__guild-id"},ul={key:2,class:"discord-server-card__connect"},ml={key:0,class:"discord-server-card__invite"},_l=["href"],pl={key:1,class:"discord-server-card__permissions-hint"},gl={key:2,class:"discord-server-card__hint"},vl={class:"discord-server-card__link-row"},yl=le({__name:"AdminDiscordServerCard",props:{slug:{},loading:{type:Boolean},server:{},inviteUrl:{},guildIdInput:{},linkError:{},linking:{type:Boolean},disconnecting:{type:Boolean}},emits:["update:guildIdInput","link","disconnect"],setup(_){return(y,p)=>(i(),se(t(te),null,{default:R(()=>[p[9]||(p[9]=s("h3",null,"Discord server",-1)),p[10]||(p[10]=s("p",{class:"discord-server-card__hint"}," Connect one Discord server to this community. Members can use /verify to link their wallet and receive roles based on token and NFT rules. ",-1)),_.loading?(i(),m("p",il,[c(t(x),{icon:"mdi:loading",class:"discord-server-card__spinner"}),p[3]||(p[3]=H(" Loading… ",-1))])):_.server.connected?(i(),m("div",rl,[s("p",dl,[c(t(x),{icon:"mdi:check-circle",class:"discord-server-card__status-icon"}),H(" Connected: "+k(_.server.guild_name||_.server.discord_guild_id),1)]),_.server.guild_name?(i(),m("p",cl,[p[4]||(p[4]=H(" Server ID: ",-1)),s("code",null,k(_.server.discord_guild_id),1)])):B("",!0),c(t(q),{variant:"secondary",disabled:_.disconnecting,onClick:p[0]||(p[0]=S=>y.$emit("disconnect"))},{default:R(()=>[...p[5]||(p[5]=[H(" Disconnect ",-1)])]),_:1},8,["disabled"])])):(i(),m("div",ul,[p[7]||(p[7]=s("p",{class:"discord-server-card__step"}," 1. Invite the bot to your Discord server: ",-1)),_.inviteUrl?(i(),m("p",ml,[s("a",{href:_.inviteUrl,target:"_blank",rel:"noopener"}," Invite bot to server ",8,_l)])):B("",!0),_.inviteUrl?(i(),m("p",pl," This link requests only two permissions: Manage Roles (to assign/remove roles) and Use Application Commands (for /verify). If you already added the bot with more permissions, remove it from the server and use this link to re-add it with minimal access. ")):(i(),m("p",gl," Invite URL not configured. Set DISCORD_CLIENT_ID on the API. ")),p[8]||(p[8]=s("p",{class:"discord-server-card__step"},' 2. Enable Developer Mode in Discord (User Settings → App Settings → Advanced), then right‑click your server name and choose "Copy Server ID". ',-1)),s("div",vl,[c(t(C),{"model-value":_.guildIdInput,placeholder:"Paste Discord Server ID",label:"Server ID",error:_.linkError,"onUpdate:modelValue":p[1]||(p[1]=S=>y.$emit("update:guildIdInput",S))},null,8,["model-value","error"]),c(t(q),{variant:"primary",disabled:!_.guildIdInput.trim()||_.linking,onClick:p[2]||(p[2]=S=>y.$emit("link",{guildId:_.guildIdInput.trim()}))},{default:R(()=>[...p[6]||(p[6]=[H(" Link server ",-1)])]),_:1},8,["disabled"])])]))]),_:1}))}}),hl=Object.assign(ne(yl,[["__scopeId","data-v-ced7e07c"]]),{__name:"AdminDiscordServerCard"}),fl={key:0,class:"discord-rules-card__mint-count"},bl={key:1,class:"discord-rules-card__error"},kl={key:2,class:"discord-rules-card__loading"},$l={key:0,class:"discord-rules-card__list"},Vl={class:"discord-rules-card__summary"},Sl={class:"discord-rules-card__rule-name"},wl={class:"discord-rules-card__conditions"},Ml={class:"discord-rules-card__actions"},Tl={key:1,class:"discord-rules-card__empty"},Cl={class:"discord-rules-card__form"},Fl={class:"discord-rules-card__form-row"},Al=["disabled"],Il=["value"],Ul={key:0,class:"discord-rules-card__roles-hint"},Pl={key:1,class:"discord-rules-card__roles-hint"},Bl={class:"discord-rules-card__conditions-block"},Dl={class:"discord-rules-card__condition-row"},Rl=["onUpdate:modelValue","onChange"],El=["value"],xl=["onUpdate:modelValue","onChange"],Ll=["value"],Nl=["onUpdate:modelValue"],Ol=["value"],jl={key:1,class:"discord-rules-card__discord-roles"},ql=["onUpdate:modelValue"],Hl=["value"],Wl=["onUpdate:modelValue"],zl=["onUpdate:modelValue"],Gl={key:0,class:"discord-rules-card__mint-preview"},Kl={class:"discord-rules-card__mint-preview-name"},Jl={key:0,class:"discord-rules-card__mint-preview-symbol"},Yl={key:1,class:"discord-rules-card__mint-preview-meta"},Zl={key:2,class:"discord-rules-card__mint-preview-holders"},Ql={class:"discord-rules-card__form-actions"},Xl={key:1,class:"discord-rules-card__error discord-rules-card__error--inline"},en=le({__name:"AdminDiscordRulesCard",props:{slug:{}},setup(_){const y=_,p=ve(),S=M([]),o=M([]),U=M([]),F=M(!1),r=M(null),V=M(null),T=M(null),P=M(null),N=M(null),O=M(!1),L=M([]),w=ge({discord_role_id:"",operator:"AND",conditions:[]}),f=M({}),h=M({}),I=M({}),$=M({});function v(n){return n==="SPL"||n==="NFT"||n==="TRAIT"}function a(n){n.type==="DISCORD"&&!Array.isArray(n.required_role_ids)&&(n.required_role_ids=[],n.role_logic="OR")}function u(n){return v(n.type)?!!n.mint_or_group?.trim():n.type==="DISCORD"?(n.required_role_ids?.length??0)>0:!1}const E=j(()=>[...U.value].sort((e,l)=>{const d=J(e.discord_role_id).toLowerCase(),b=J(l.discord_role_id).toLowerCase();return d.localeCompare(b)}));async function G(n){const e=w.conditions[n],l=e?.mint_or_group?.trim();if(!l||l.length<32)return;const d=e?.type==="NFT"||e?.type==="TRAIT",b=`${l}:${d?"collection":"mint"}`,A=$.value[b];if(A){f.value={...f.value,[n]:A.preview},A.traitOptions&&(I.value={...I.value,[n]:A.traitOptions});return}h.value={...h.value,[n]:!0};try{if(d){const re=await fetch(`${p.value}/api/v1/tenant/${y.slug}/discord/collection-preview?mint=${encodeURIComponent(l)}&fetch=1`,{credentials:"include"});if(re.ok){const W=await re.json(),de={mint:W.mint,name:W.name??null,symbol:null,image:W.image??null,decimals:null,holder_count:W.items_loaded??null},Me={trait_keys:W.trait_keys??[],trait_options:W.trait_options??{}};$.value={...$.value,[b]:{preview:de,traitOptions:Me,isCollection:!0}},f.value={...f.value,[n]:de},I.value={...I.value,[n]:Me}}else f.value={...f.value,[n]:null},I.value={...I.value,[n]:{trait_keys:[],trait_options:{}}}}else{const re=await fetch(`${p.value}/api/v1/tenant/${y.slug}/discord/mint-preview?mint=${encodeURIComponent(l)}&fetch=1`,{credentials:"include"});if(re.ok){const W=await re.json(),de={mint:W.mint,name:W.name??null,symbol:W.symbol??null,image:W.image??null,decimals:W.decimals??null,holder_count:W.holder_count??null};$.value={...$.value,[b]:{preview:de,isCollection:!1}},f.value={...f.value,[n]:de}}else f.value={...f.value,[n]:null}}}finally{h.value={...h.value,[n]:!1}}}function Y(n){const l=w.conditions[n]?.trait_key?.trim();if(!l)return[];const d=I.value[n];return d?.trait_options?d.trait_options[l]??[]:[]}function ue(){if(w.conditions.length>=5)return;const n=w.conditions[w.conditions.length-1];n&&(n.logic_to_next=n.logic_to_next??"AND");const e=L.value[0]?.id??"SPL";w.conditions.push({type:e,mint_or_group:"",logic_to_next:"AND",...e==="DISCORD"?{required_role_ids:[],role_logic:"OR"}:{}})}function ee(n){w.conditions.splice(n,1),n>0&&w.conditions[n-1]&&(w.conditions[n-1].logic_to_next="AND");const e={};Object.entries(f.value).forEach(([d,b])=>{const A=Number(d);A<n?e[A]=b:A>n&&(e[A-1]=b)}),f.value=e;const l={};Object.entries(I.value).forEach(([d,b])=>{const A=Number(d);A<n?l[A]=b:A>n&&(l[A-1]=b)}),I.value=l}function Q(){w.discord_role_id="",w.operator="AND";const n=L.value[0]?.id??"SPL";w.conditions=[{type:n,mint_or_group:"",logic_to_next:"AND",...n==="DISCORD"?{required_role_ids:[],role_logic:"OR"}:{}}],f.value={},I.value={},N.value=null}function J(n){return S.value.find(e=>e.id===n)?.name??n}function me(n,e){if(n.type==="DISCORD"){const A=(n.required_role_ids??[]).map(de=>J(de)).filter(Boolean),re=n.role_logic??"OR",W=`DISCORD ${A.length?A.join(", "):"(no roles)"} (${re})`;return e?`${W} ${e}`:W}const l=[n.type,n.mint_or_group];n.type==="SPL"&&n.threshold!=null&&l.push(`>= ${n.threshold}`),n.type==="TRAIT"&&n.trait_key&&l.push(`${n.trait_key}=${n.trait_value??""}`);const d=l.join(" ");return e?`${d} ${e}`:d}async function ie(){F.value=!0,r.value=null;try{const[n,e,l]=await Promise.all([fetch(`${p.value}/api/v1/tenant/${y.slug}/discord/condition-types`,{credentials:"include"}),fetch(`${p.value}/api/v1/tenant/${y.slug}/discord/roles`,{credentials:"include"}),fetch(`${p.value}/api/v1/tenant/${y.slug}/discord/rules`,{credentials:"include"})]);if(n.ok){const d=await n.json();L.value=d.types??[]}if(L.value.length===0&&(L.value=[{id:"SPL",label:"SPL"},{id:"NFT",label:"NFT"},{id:"TRAIT",label:"Trait"},{id:"DISCORD",label:"Discord role"}]),e.ok){const d=await e.json();S.value=d.roles??[],o.value=d.assignable_roles??[]}if(l.ok){const d=await l.json();U.value=d.rules??[],T.value=d.configured_mint_count??0,P.value=d.mint_cap??null}else{const d=await l.json().catch(()=>({}));r.value=d.error??`Failed to load rules (${l.status})`}}finally{F.value=!1}}function ye(n){N.value=n.id,w.discord_role_id=n.discord_role_id,w.operator=n.operator;const e=L.value[0]?.id??"SPL";w.conditions=n.conditions.length?n.conditions.map((l,d)=>({type:l.type,mint_or_group:l.mint_or_group??"",threshold:l.threshold!=null?String(l.threshold):"",trait_key:l.trait_key??"",trait_value:l.trait_value??"",required_role_ids:l.required_role_ids??[],role_logic:l.role_logic??"OR",logic_to_next:l.logic_to_next??(d<n.conditions.length-1?"AND":void 0)})):[{type:e,mint_or_group:"",logic_to_next:"AND",...e==="DISCORD"?{required_role_ids:[],role_logic:"OR"}:{}}],f.value={},I.value={},Ve(()=>{w.conditions.forEach((l,d)=>{v(l.type)&&l.mint_or_group.trim()&&G(d)})})}function he(){Q()}async function fe(){if(!(!w.discord_role_id||w.conditions.every(n=>!u(n)))){O.value=!0,V.value=null;try{const n=w.conditions.filter(l=>u(l)),e=n.map((l,d)=>{const b={type:l.type,logic_to_next:d<n.length-1?l.logic_to_next==="OR"?"OR":"AND":null};return l.type==="DISCORD"?{...b,required_role_ids:l.required_role_ids??[],role_logic:l.role_logic??"OR"}:{...b,mint_or_group:l.mint_or_group.trim(),threshold:l.type==="SPL"&&l.threshold!==""?Number(l.threshold):void 0,trait_key:l.trait_key?.trim()||void 0,trait_value:l.trait_value?.trim()||void 0}});if(N.value!=null){const l=await fetch(`${p.value}/api/v1/tenant/${y.slug}/discord/rules/${N.value}`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({operator:w.operator,conditions:e})});if(l.ok)await ie();else{const d=await l.json().catch(()=>({}));V.value=d.error??`Failed to update rule (${l.status})`}}else{const l=await fetch(`${p.value}/api/v1/tenant/${y.slug}/discord/rules`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({discord_role_id:w.discord_role_id,operator:w.operator,conditions:e})});if(l.ok)Q(),await ie();else{const d=await l.json().catch(()=>({}));V.value=d.error??`Failed to add rule (${l.status})`}}}finally{O.value=!1}}}async function g(n){(await fetch(`${p.value}/api/v1/tenant/${y.slug}/discord/rules/${n}`,{method:"DELETE",credentials:"include"})).ok&&(N.value===n&&Q(),await ie())}return Se(()=>{ue(),ie()}),(n,e)=>(i(),se(t(te),{class:"discord-rules-card"},{default:R(()=>[e[15]||(e[15]=s("h3",null,"Role rules",-1)),e[16]||(e[16]=s("p",{class:"discord-rules-card__hint"}," Assign a Discord role when members meet conditions (SPL balance, NFT collection, trait, or Discord role). For SPL mints, click Load to fetch metadata first; the threshold is in token units. For NFT or Trait conditions, click Load to fetch and index all NFTs in the collection (required for Year 3 and other collections); trait options then appear as dropdowns. After each condition choose AND or OR before the next. Max 5 conditions per rule. ",-1)),t(T)!==null?(i(),m("p",fl," Mints used: "+k(t(T))+k(t(P)!=null?` / ${t(P)}`:""),1)):B("",!0),t(r)?(i(),m("div",bl,[H(k(t(r))+" ",1),e[1]||(e[1]=s("span",{class:"discord-rules-card__error-hint"},"If the error mentions a missing table, ensure the API has run database migrations (they run on API startup when DATABASE_URL is set). Restart the API and try again.",-1))])):B("",!0),t(F)?(i(),m("div",kl,[c(t(x),{icon:"mdi:loading",class:"discord-rules-card__spinner"}),e[2]||(e[2]=H(" Loading rules… ",-1))])):(i(),m(D,{key:3},[t(E).length?(i(),m("ul",$l,[(i(!0),m(D,null,z(t(E),l=>(i(),m("li",{key:l.id,class:"discord-rules-card__item"},[s("div",Vl,[s("span",Sl,k(J(l.discord_role_id)),1),e[3]||(e[3]=s("span",{class:"discord-rules-card__sep"},"—",-1)),s("span",wl,k(l.conditions.map(d=>me(d,d.logic_to_next??void 0)).join(" ")),1)]),s("div",Ml,[c(t(q),{variant:"ghost",size:"small",onClick:d=>ye(l)},{default:R(()=>[c(t(x),{icon:"mdi:pencil"})]),_:1},8,["onClick"]),c(t(q),{variant:"ghost",size:"small",onClick:d=>g(l.id)},{default:R(()=>[c(t(x),{icon:"mdi:delete"})]),_:1},8,["onClick"])])]))),128))])):(i(),m("p",Tl,"No role rules. Add one below.")),s("div",Cl,[s("h4",null,k(t(N)?"Edit rule":"Add rule"),1),s("div",Fl,[e[5]||(e[5]=s("label",{class:"discord-rules-card__label"},"Assign role",-1)),ae(s("select",{"onUpdate:modelValue":e[0]||(e[0]=l=>t(w).discord_role_id=l),class:"discord-rules-card__select discord-rules-card__select--themed",disabled:!!t(N)},[e[4]||(e[4]=s("option",{value:""},"Select role",-1)),(i(!0),m(D,null,z(t(o),l=>(i(),m("option",{key:l.id,value:l.id},k(l.name),9,Il))),128))],8,Al),[[ce,t(w).discord_role_id]]),t(o).length===0&&!t(F)?(i(),m("p",Ul," Roles are synced by the bot when it starts or joins the server. If the list is empty, ensure the bot is in your Discord server and has been restarted after you linked this server, then refresh this page. ")):t(o).length>0?(i(),m("p",Pl,' Only roles the bot can assign are listed (those below its role in the server hierarchy). For conditions, you can use any server role in the "Discord role" condition type below. ')):B("",!0)]),s("div",Bl,[e[13]||(e[13]=s("label",{class:"discord-rules-card__label"},"Conditions",-1)),(i(!0),m(D,null,z(t(w).conditions,(l,d)=>(i(),m("div",{key:d,class:"discord-rules-card__condition-block"},[s("div",Dl,[ae(s("select",{"onUpdate:modelValue":b=>l.type=b,class:"discord-rules-card__select discord-rules-card__select--sm discord-rules-card__select--themed",onChange:b=>a(l)},[(i(!0),m(D,null,z(t(L),b=>(i(),m("option",{key:b.id,value:b.id},k(b.label),9,El))),128))],40,Rl),[[ce,l.type]]),v(l.type)?(i(),m(D,{key:0},[c(t(C),{modelValue:l.mint_or_group,"onUpdate:modelValue":b=>l.mint_or_group=b,placeholder:"Mint or collection address",class:"discord-rules-card__mint-input"},null,8,["modelValue","onUpdate:modelValue"]),c(t(q),{variant:"secondary",size:"small",disabled:!l.mint_or_group.trim()||l.mint_or_group.trim().length<32||t(h)[d],"aria-label":"Load metadata for condition "+(d+1),onClick:b=>G(d)},{default:R(()=>[t(h)[d]?(i(),se(t(x),{key:0,icon:"mdi:loading",class:"discord-rules-card__btn-spin"})):B("",!0),H(" "+k(t(h)[d]?"Loading…":"Load"),1)]),_:2},1032,["disabled","aria-label","onClick"]),l.type==="SPL"?(i(),se(t(C),{key:0,modelValue:l.threshold,"onUpdate:modelValue":b=>l.threshold=b,type:"number",placeholder:"Min amount",class:"discord-rules-card__threshold-input"},null,8,["modelValue","onUpdate:modelValue"])):B("",!0),l.type==="TRAIT"?(i(),m(D,{key:1},[t(I)[d]?.trait_keys?.length?(i(),m(D,{key:0},[ae(s("select",{"onUpdate:modelValue":b=>l.trait_key=b,class:"discord-rules-card__select discord-rules-card__select--sm discord-rules-card__select--themed","aria-label":"Trait key",onChange:b=>l.trait_value=""},[e[6]||(e[6]=s("option",{value:""},"Select trait",-1)),(i(!0),m(D,null,z(t(I)[d]?.trait_keys??[],b=>(i(),m("option",{key:b,value:b},k(b),9,Ll))),128))],40,xl),[[ce,l.trait_key]]),ae(s("select",{"onUpdate:modelValue":b=>l.trait_value=b,class:"discord-rules-card__select discord-rules-card__select--sm discord-rules-card__select--themed","aria-label":"Trait value"},[e[7]||(e[7]=s("option",{value:""},"Select value",-1)),(i(!0),m(D,null,z(Y(d),b=>(i(),m("option",{key:b,value:b},k(b),9,Ol))),128))],8,Nl),[[ce,l.trait_value]])],64)):(i(),m(D,{key:1},[c(t(C),{modelValue:l.trait_key,"onUpdate:modelValue":b=>l.trait_key=b,placeholder:"Trait key (load collection first)",class:"discord-rules-card__trait-input"},null,8,["modelValue","onUpdate:modelValue"]),c(t(C),{modelValue:l.trait_value,"onUpdate:modelValue":b=>l.trait_value=b,placeholder:"Trait value",class:"discord-rules-card__trait-input"},null,8,["modelValue","onUpdate:modelValue"]),e[8]||(e[8]=s("span",{class:"discord-rules-card__trait-hint"},"Click Load to fetch and index all NFTs in the collection; trait options will appear as dropdowns.",-1))],64))],64)):B("",!0)],64)):l.type==="DISCORD"?(i(),m("div",jl,[ae(s("select",{"onUpdate:modelValue":b=>l.required_role_ids=b,multiple:"",class:"discord-rules-card__select discord-rules-card__select--multi discord-rules-card__select--themed","aria-label":"Required Discord roles"},[(i(!0),m(D,null,z(t(S),b=>(i(),m("option",{key:b.id,value:b.id},k(b.name),9,Hl))),128))],8,ql),[[ce,l.required_role_ids]]),e[10]||(e[10]=s("span",{class:"discord-rules-card__role-logic-label"},"Member must have:",-1)),ae(s("select",{"onUpdate:modelValue":b=>l.role_logic=b,class:"discord-rules-card__select discord-rules-card__select--sm discord-rules-card__select--themed"},[...e[9]||(e[9]=[s("option",{value:"AND"},"All of the selected roles",-1),s("option",{value:"OR"},"Any of the selected roles",-1)])],8,Wl),[[ce,l.role_logic]])])):B("",!0),d<t(w).conditions.length-1?ae((i(),m("select",{key:2,"onUpdate:modelValue":b=>l.logic_to_next=b,class:"discord-rules-card__select discord-rules-card__select--sm discord-rules-card__select--themed","aria-label":"Logic to next condition"},[...e[11]||(e[11]=[s("option",{value:"AND"},"AND",-1),s("option",{value:"OR"},"OR",-1)])],8,zl)),[[ce,l.logic_to_next]]):B("",!0),c(t(q),{variant:"ghost",size:"small",onClick:b=>ee(d)},{default:R(()=>[c(t(x),{icon:"mdi:close"})]),_:1},8,["onClick"])]),t(f)[d]?(i(),m("div",Gl,[t(f)[d]?.name||t(f)[d]?.symbol?(i(),m(D,{key:0},[s("span",Kl,k(t(f)[d]?.name??t(f)[d]?.mint?.slice(0,8)+"…"),1),t(f)[d]?.symbol?(i(),m("span",Jl,k(t(f)[d]?.symbol),1)):B("",!0)],64)):B("",!0),t(f)[d]?.decimals!=null?(i(),m("span",Yl,"Decimals: "+k(t(f)[d]?.decimals),1)):B("",!0),t(f)[d]?.holder_count!=null?(i(),m("span",Zl,"Holders: "+k(t(f)[d]?.holder_count),1)):B("",!0)])):B("",!0)]))),128)),c(t(q),{variant:"secondary",size:"small",disabled:t(w).conditions.length>=5,onClick:ue},{default:R(()=>[...e[12]||(e[12]=[H(" Add condition ",-1)])]),_:1},8,["disabled"])]),s("div",Ql,[t(N)?(i(),se(t(q),{key:0,variant:"secondary",onClick:he},{default:R(()=>[...e[14]||(e[14]=[H(" Cancel ",-1)])]),_:1})):B("",!0),t(V)?(i(),m("p",Xl,k(t(V)),1)):B("",!0),c(t(q),{variant:"primary",disabled:!t(w).discord_role_id||t(w).conditions.every(l=>!u(l))||t(O),onClick:fe},{default:R(()=>[H(k(t(N)?"Update rule":"Add rule"),1)]),_:1},8,["disabled"])])])],64))]),_:1}))}}),tn=Object.assign(ne(en,[["__scopeId","data-v-0d81a457"]]),{__name:"AdminDiscordRulesCard"}),sn={class:"discord-settings"},ln=le({__name:"AdminDiscordSettings",props:{slug:{}},setup(_){const y=_,p=ve(),S=M(!0),o=M(null),U=M({connected:!1}),F=M(""),r=M(!1),V=M(!1),T=M(null);async function P(){const f=await fetch(`${p.value}/api/v1/tenant/${y.slug}/discord/invite-url`,{credentials:"include"});if(f.ok){const h=await f.json();o.value=h.invite_url??null}}async function N(){const f=await fetch(`${p.value}/api/v1/tenant/${y.slug}/discord/server`,{credentials:"include"});if(f.ok){const h=await f.json();U.value={connected:h.connected,discord_guild_id:h.discord_guild_id,guild_name:h.guild_name,connected_at:h.connected_at}}}async function O(){S.value=!0,T.value=null;try{await Promise.all([P(),N()])}finally{S.value=!1}}async function L(f){const h=f.guildId;if(h){r.value=!0,T.value=null;try{const I=await fetch(`${p.value}/api/v1/tenant/${y.slug}/discord/server`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({discord_guild_id:h})}),$=await I.json().catch(()=>({}));if(!I.ok){T.value=$.error??"Failed to link server";return}U.value={connected:$.connected??!0,discord_guild_id:$.discord_guild_id,guild_name:$.guild_name,connected_at:$.connected_at},F.value=""}finally{r.value=!1}}}async function w(){V.value=!0;try{const f=await fetch(`${p.value}/api/v1/tenant/${y.slug}/discord/server`,{method:"DELETE",credentials:"include"});if(f.ok){const h=await f.json();U.value={connected:h.connected??!1}}}finally{V.value=!1}}return Se(O),(f,h)=>(i(),m("div",sn,[c(hl,{slug:_.slug,loading:t(S),server:t(U),"invite-url":t(o),"guild-id-input":t(F),"onUpdate:guildIdInput":h[0]||(h[0]=I=>Fe(F)?F.value=I:null),"link-error":t(T),linking:t(r),disconnecting:t(V),onLink:L,onDisconnect:w},null,8,["slug","loading","server","invite-url","guild-id-input","link-error","linking","disconnecting"]),t(U).connected&&!t(S)?(i(),se(tn,{key:0,slug:_.slug},null,8,["slug"])):B("",!0)]))}}),nn=Object.assign(ne(ln,[["__scopeId","data-v-7a05fe2d"]]),{__name:"AdminDiscordSettings"}),an={class:"admin"},on={key:0,class:"admin__panel"},rn={key:1,class:"admin__panel"},dn={key:2,class:"admin__panel"},cn={key:3,class:"admin__panel"},un={key:4,class:"admin__panel"},mn={class:"admin__actions"},_n={key:0,class:"admin__error"},pn=le({__name:"admin",setup(_){const y=De(),p=Re(),S=ve(),o=j(()=>p.tenant),U=j(()=>p.slug),F=j(()=>Object.keys(Te)),r=new Set(qe.admin?.map($=>$.id)??["general","modules","theming","marketplace","discord"]),V=M(!1),T=j(()=>{const $=p.marketplaceSettings;return $?{collectionMints:$.collectionMints,splAssetMints:$.splAssetMints??[],currencyMints:$.currencyMints,whitelist:$.whitelist,shopFee:$.shopFee}:null});function P($,v){$==="marketplace"&&v&&(V.value=!0),h.modulesById[$]=v}function N($){const v=$;p.setMarketplaceSettings(v?{collectionMints:v.collectionMints??[],splAssetMints:v.splAssetMints??[],currencyMints:v.currencyMints??[],whitelist:v.whitelist,shopFee:v.shopFee??{wallet:"",makerFlatFee:0,takerFlatFee:0,makerPercentFee:0,takerPercentFee:0}}:null)}const O=j(()=>{const $=y.query.tab;return typeof $=="string"&&r.has($)?$:"general"});Se(()=>{const $=y.query.tab;(typeof $!="string"||!r.has($))&&Ee({path:y.path,query:{...y.query,tab:"general"},replace:!0})});const L=M(!1),w=M(null);function f($){const v=xe(Ne,$?.branding?.theme??{});return{logo:$?.branding?.logo??"",theme:v}}const h=ge({name:"",description:"",branding:f(null),modulesById:{}});oe(o,$=>{if(!$){h.modulesById=Object.fromEntries(F.value.map(a=>[a,!1])),h.branding=f(null);return}h.name=$.name??"",h.description=$.description??"",h.branding=f($);const v=$.modules??{};h.modulesById=Object.fromEntries(F.value.map(a=>[a,v[a]?.active??!1]))},{immediate:!0});async function I(){if(U.value){L.value=!0,w.value=null;try{const $=o.value?.modules??{},v={};for(const G of F.value){const Y=$[G];v[G]={active:h.modulesById[G]??!1,deactivatedate:Y?.deactivatedate??null,settingsjson:Y?.settingsjson??{}}}const a=S.value,u=await fetch(`${a}/api/v1/tenant/${U.value}/settings`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({name:h.name,description:h.description,branding:{logo:h.branding.logo,theme:h.branding.theme},modules:v})});if(!u.ok){const Y=(await u.json().catch(()=>({}))).error??(u.status===503?"API cannot persist (set DATABASE_URL or TENANT_CONFIG_PATH).":"Failed to save");throw new Error(Y)}const E=await u.json();p.setTenant(E.tenant),Le().loadTheme(E.tenant.branding?.theme??{},E.tenant.branding)}catch($){w.value=$ instanceof Error?$.message:"Failed to save"}finally{L.value=!1}}}return($,v)=>(i(),se(t(je),{title:"Admin"},{default:R(()=>[s("div",an,[t(O)==="general"?(i(),m("div",on,[c(t(te),null,{default:R(()=>[v[3]||(v[3]=s("h3",null,"General",-1)),c(t(C),{"model-value":t(U)??"",label:"Slug",disabled:""},null,8,["model-value"]),c(t(C),{modelValue:t(h).name,"onUpdate:modelValue":v[0]||(v[0]=a=>t(h).name=a),label:"Name"},null,8,["modelValue"]),c(t(C),{modelValue:t(h).description,"onUpdate:modelValue":v[1]||(v[1]=a=>t(h).description=a),label:"Description"},null,8,["modelValue"])]),_:1})])):t(O)==="theming"?(i(),m("div",rn,[c(ol,{branding:t(h).branding},null,8,["branding"])])):t(O)==="modules"?(i(),m("div",dn,[c(t(te),null,{default:R(()=>[v[4]||(v[4]=s("h3",null,"Modules",-1)),(i(!0),m(D,null,z(t(F),a=>(i(),m("div",{key:a,class:"admin__module"},[s("span",null,k(t(Te)[a]?.label??a),1),c(t(Oe),{"model-value":t(h).modulesById[a],label:t(h).modulesById[a]?"On":"Off","onUpdate:modelValue":u=>P(a,u)},null,8,["model-value","label","onUpdate:modelValue"])]))),128))]),_:1})])):t(O)==="marketplace"?(i(),m("div",cn,[c(Cs,{slug:t(U)??"",settings:t(T),onSaved:N},null,8,["slug","settings"])])):t(O)==="discord"?(i(),m("div",un,[c(nn,{slug:t(U)??""},null,8,["slug"])])):B("",!0),s("div",mn,[c(t(q),{variant:"primary",disabled:t(L),onClick:I},{default:R(()=>[...v[5]||(v[5]=[H(" Save ",-1)])]),_:1},8,["disabled"]),t(w)?(i(),m("p",_n,k(t(w)),1)):B("",!0)])]),c(xs,{modelValue:t(V),"onUpdate:modelValue":v[2]||(v[2]=a=>Fe(V)?V.value=a:null)},null,8,["modelValue"])]),_:1}))}}),Tn=ne(pn,[["__scopeId","data-v-c9f57984"]]);export{Tn as default};
