import{a5 as U,as as Q,at as mt,ap as ve,au as ur,av as ci,aw as ui,ax as li,ay as Dt,az as ze,aA as ce,aB as lr,aC as wt,a6 as re,aD as di,aE as fi}from"./DhkfeLsH.js";const Z=new U("TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA"),Ia=new U("TokenzQdBNbLqP5VEhdkAS6EPFLC1PHnBqCXEpPxuEb"),ee=new U("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"),dr=new U("So11111111111111111111111111111111111111112");new U("9pan9bMn5HatX4EJdBwg9VgCa7Uz5HL8N1m5D3NdXejP");const Ht=n=>{const t=n.decode.bind(n),e=n.encode.bind(n);return{decode:t,encode:e}};var _e={},an;function hi(){if(an)return _e;an=1,Object.defineProperty(_e,"__esModule",{value:!0});function n(s){{const i=Buffer.from(s);i.reverse();const o=i.toString("hex");return o.length===0?BigInt(0):BigInt(`0x${o}`)}}_e.toBigIntLE=n;function t(s){{const i=s.toString("hex");return i.length===0?BigInt(0):BigInt(`0x${i}`)}}_e.toBigIntBE=t;function e(s,i){{const o=s.toString(16),u=Buffer.from(o.padStart(i*2,"0").slice(0,i*2),"hex");return u.reverse(),u}}_e.toBufferLE=e;function r(s,i){{const o=s.toString(16);return Buffer.from(o.padStart(i*2,"0").slice(0,i*2),"hex")}}return _e.toBufferBE=r,_e}var cn=hi();const pi=n=>t=>{const e=Q.blob(n,t),{encode:r,decode:s}=Ht(e),i=e;return i.decode=(o,u)=>{const h=s(o,u);return cn.toBigIntLE(Buffer.from(h))},i.encode=(o,u,h)=>{const l=cn.toBufferLE(o,n);return r(l,u,h)},i},rt=pi(8),fr=n=>{const t=Q.u8(n),{encode:e,decode:r}=Ht(t),s=t;return s.decode=(i,o)=>!!r(i,o),s.encode=(i,o,u)=>{const h=Number(i);return e(h,o,u)},s},J=n=>{const t=Q.blob(32,n),{encode:e,decode:r}=Ht(t),s=t;return s.decode=(i,o)=>{const u=r(i,o);return new U(u)},s.encode=(i,o,u)=>{const h=i.toBuffer();return e(h,o,u)},s};class Be extends Error{constructor(t){super(t)}}class hr extends Be{constructor(){super(...arguments),this.name="TokenAccountNotFoundError"}}class mi extends Be{constructor(){super(...arguments),this.name="TokenInvalidAccountError"}}class pr extends Be{constructor(){super(...arguments),this.name="TokenInvalidAccountOwnerError"}}class qe extends Be{constructor(){super(...arguments),this.name="TokenInvalidAccountSizeError"}}class wi extends Be{constructor(){super(...arguments),this.name="TokenInvalidMintError"}}class gi extends Be{constructor(){super(...arguments),this.name="TokenOwnerOffCurveError"}}var Nt;(function(n){n[n.InitializeMint=0]="InitializeMint",n[n.InitializeAccount=1]="InitializeAccount",n[n.InitializeMultisig=2]="InitializeMultisig",n[n.Transfer=3]="Transfer",n[n.Approve=4]="Approve",n[n.Revoke=5]="Revoke",n[n.SetAuthority=6]="SetAuthority",n[n.MintTo=7]="MintTo",n[n.Burn=8]="Burn",n[n.CloseAccount=9]="CloseAccount",n[n.FreezeAccount=10]="FreezeAccount",n[n.ThawAccount=11]="ThawAccount",n[n.TransferChecked=12]="TransferChecked",n[n.ApproveChecked=13]="ApproveChecked",n[n.MintToChecked=14]="MintToChecked",n[n.BurnChecked=15]="BurnChecked",n[n.InitializeAccount2=16]="InitializeAccount2",n[n.SyncNative=17]="SyncNative",n[n.InitializeAccount3=18]="InitializeAccount3",n[n.InitializeMultisig2=19]="InitializeMultisig2",n[n.InitializeMint2=20]="InitializeMint2",n[n.GetAccountDataSize=21]="GetAccountDataSize",n[n.InitializeImmutableOwner=22]="InitializeImmutableOwner",n[n.AmountToUiAmount=23]="AmountToUiAmount",n[n.UiAmountToAmount=24]="UiAmountToAmount",n[n.InitializeMintCloseAuthority=25]="InitializeMintCloseAuthority",n[n.TransferFeeExtension=26]="TransferFeeExtension",n[n.ConfidentialTransferExtension=27]="ConfidentialTransferExtension",n[n.DefaultAccountStateExtension=28]="DefaultAccountStateExtension",n[n.Reallocate=29]="Reallocate",n[n.MemoTransferExtension=30]="MemoTransferExtension",n[n.CreateNativeMint=31]="CreateNativeMint",n[n.InitializeNonTransferableMint=32]="InitializeNonTransferableMint",n[n.InterestBearingMintExtension=33]="InterestBearingMintExtension",n[n.CpiGuardExtension=34]="CpiGuardExtension",n[n.InitializePermanentDelegate=35]="InitializePermanentDelegate",n[n.TransferHookExtension=36]="TransferHookExtension",n[n.MetadataPointerExtension=39]="MetadataPointerExtension",n[n.GroupPointerExtension=40]="GroupPointerExtension",n[n.GroupMemberPointerExtension=41]="GroupMemberPointerExtension",n[n.ScaledUiAmountExtension=43]="ScaledUiAmountExtension",n[n.PausableExtension=44]="PausableExtension"})(Nt||(Nt={}));var ot;(function(n){n[n.Uninitialized=0]="Uninitialized",n[n.Mint=1]="Mint",n[n.Account=2]="Account"})(ot||(ot={}));const mr=1,yi=Q.struct([Q.u8("m"),Q.u8("n"),fr("isInitialized"),J("signer1"),J("signer2"),J("signer3"),J("signer4"),J("signer5"),J("signer6"),J("signer7"),J("signer8"),J("signer9"),J("signer10"),J("signer11")]),wr=yi.span;var at;(function(n){n[n.Uninitialized=0]="Uninitialized",n[n.Initialized=1]="Initialized",n[n.Frozen=2]="Frozen"})(at||(at={}));const gr=Q.struct([J("mint"),J("owner"),rt("amount"),Q.u32("delegateOption"),J("delegate"),Q.u8("state"),Q.u32("isNativeOption"),rt("isNative"),rt("delegatedAmount"),Q.u32("closeAuthorityOption"),J("closeAuthority")]),ge=gr.span;async function vi(n,t,e,r=Z){const s=await n.getAccountInfo(t,e);return bi(t,s,r)}function bi(n,t,e=Z){if(!t)throw new hr;if(!t.owner.equals(e))throw new pr;if(t.data.length<ge)throw new qe;const r=gr.decode(t.data.slice(0,ge));let s=Buffer.alloc(0);if(t.data.length>ge){if(t.data.length===wr)throw new qe;if(t.data[ge]!=ot.Account)throw new mi;s=t.data.slice(ge+mr)}return{address:n,mint:r.mint,owner:r.owner,amount:r.amount,delegate:r.delegateOption?r.delegate:null,delegatedAmount:r.delegatedAmount,isInitialized:r.state!==at.Uninitialized,isFrozen:r.state===at.Frozen,isNative:!!r.isNativeOption,rentExemptReserve:r.isNativeOption?r.isNative:null,closeAuthority:r.closeAuthorityOption?r.closeAuthority:null,tlvData:s}}const yr=Q.struct([Q.u32("mintAuthorityOption"),J("mintAuthority"),rt("supply"),Q.u8("decimals"),fr("isInitialized"),Q.u32("freezeAuthorityOption"),J("freezeAuthority")]),At=yr.span;async function Ei(n,t,e,r=Z){const s=await n.getAccountInfo(t,e);return _i(t,s,r)}function _i(n,t,e=Z){if(!t)throw new hr;if(!t.owner.equals(e))throw new pr;if(t.data.length<At)throw new qe;const r=yr.decode(t.data.slice(0,At));let s=Buffer.alloc(0);if(t.data.length>At){if(t.data.length<=ge)throw new qe;if(t.data.length===wr)throw new qe;if(t.data[ge]!=ot.Mint)throw new wi;s=t.data.slice(ge+mr)}return{address:n,mintAuthority:r.mintAuthorityOption?r.mintAuthority:null,supply:r.supply,decimals:r.decimals,isInitialized:r.isInitialized,freezeAuthority:r.freezeAuthorityOption?r.freezeAuthority:null,tlvData:s}}function me(n,t,e=!1,r=Z,s=ee){if(!e&&!U.isOnCurve(t.toBuffer()))throw new gi;const[i]=U.findProgramAddressSync([t.toBuffer(),r.toBuffer(),n.toBuffer()],s);return i}function Ai(n,t,e,r,s=Z,i=ee){return ki(n,t,e,r,Buffer.alloc(0),s,i)}function ki(n,t,e,r,s,i=Z,o=ee){const u=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:ve.programId,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1}];return new mt({keys:u,programId:o,data:s})}const un=Q.struct([Q.u8("instruction")]);function Si(n,t=Z){const e=[{pubkey:n,isSigner:!1,isWritable:!0}],r=Buffer.alloc(un.span);return un.encode({instruction:Nt.SyncNative},r),new mt({keys:e,programId:t,data:r})}var xi={version:"0.1.0",name:"escrow_service",instructions:[{name:"initialize",accounts:[{name:"maker",isMut:!0,isSigner:!0},{name:"makerAta",isMut:!0,isSigner:!1},{name:"recipient",isMut:!1,isSigner:!1,isOptional:!0},{name:"depositToken",isMut:!1,isSigner:!1},{name:"requestToken",isMut:!1,isSigner:!1},{name:"auth",isMut:!1,isSigner:!1},{name:"vault",isMut:!0,isSigner:!1},{name:"escrow",isMut:!0,isSigner:!1},{name:"tokenProgram",isMut:!1,isSigner:!1},{name:"associatedTokenProgram",isMut:!1,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1},{name:"fee",isMut:!0,isSigner:!1},{name:"whitelistProgram",isMut:!1,isSigner:!1,isOptional:!0},{name:"whitelist",isMut:!1,isSigner:!1,isOptional:!0},{name:"entry",isMut:!1,isSigner:!1,isOptional:!0}],args:[{name:"seed",type:"u64"},{name:"depositAmount",type:"u64"},{name:"requestAmount",type:"u64"},{name:"expireTimestamp",type:"i64"},{name:"allowPartialFill",type:"bool"},{name:"onlyWhitelist",type:"bool"},{name:"slippage",type:"f32"}]},{name:"cancel",accounts:[{name:"maker",isMut:!0,isSigner:!0},{name:"makerAta",isMut:!0,isSigner:!1},{name:"depositToken",isMut:!1,isSigner:!1},{name:"makerAtaRequest",isMut:!1,isSigner:!1},{name:"makerTokenRequest",isMut:!1,isSigner:!1},{name:"auth",isMut:!1,isSigner:!1},{name:"vault",isMut:!0,isSigner:!1},{name:"escrow",isMut:!0,isSigner:!1},{name:"tokenProgram",isMut:!1,isSigner:!1},{name:"associatedTokenProgram",isMut:!1,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"exchange",accounts:[{name:"maker",isMut:!0,isSigner:!1},{name:"makerReceiveAta",isMut:!0,isSigner:!1},{name:"depositToken",isMut:!1,isSigner:!1},{name:"taker",isMut:!0,isSigner:!0},{name:"takerAta",isMut:!0,isSigner:!1},{name:"takerReceiveAta",isMut:!0,isSigner:!1},{name:"requestToken",isMut:!1,isSigner:!1},{name:"auth",isMut:!1,isSigner:!1},{name:"vault",isMut:!0,isSigner:!1},{name:"escrow",isMut:!0,isSigner:!1},{name:"tokenProgram",isMut:!1,isSigner:!1},{name:"associatedTokenProgram",isMut:!1,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1},{name:"fee",isMut:!0,isSigner:!1},{name:"whitelistProgram",isMut:!1,isSigner:!1,isOptional:!0},{name:"whitelist",isMut:!1,isSigner:!1,isOptional:!0},{name:"entry",isMut:!1,isSigner:!1,isOptional:!0}],args:[{name:"amount",type:"u64"}]}],accounts:[{name:"Escrow",type:{kind:"struct",fields:[{name:"maker",type:"publicKey"},{name:"depositToken",type:"publicKey"},{name:"requestToken",type:"publicKey"},{name:"tokensDepositInit",type:"u64"},{name:"tokensDepositRemaining",type:"u64"},{name:"price",type:"f64"},{name:"decimals",type:"i16"},{name:"slippage",type:"f32"},{name:"seed",type:"u64"},{name:"authBump",type:"u8"},{name:"vaultBump",type:"u8"},{name:"escrowBump",type:"u8"},{name:"expireTimestamp",type:"i64"},{name:"recipient",type:"publicKey"},{name:"onlyRecipient",type:"bool"},{name:"onlyWhitelist",type:"bool"},{name:"allowPartialFill",type:"bool"},{name:"whitelist",type:"publicKey"}]}}],errors:[{code:6e3,name:"AuthBumpError",msg:"Unable to get auth bump"},{code:6001,name:"VaultBumpError",msg:"Unable to get vault bump"},{code:6002,name:"EscrowBumpError",msg:"Unable to get escrow bump"},{code:6003,name:"EscrowNotEnoughRemaining",msg:"Escrow has not enough funds reamining"},{code:6004,name:"EscrowRecipientError",msg:"Wrong recipient input"},{code:6005,name:"EscrowFeeError",msg:"Wrong fee account input"},{code:6006,name:"EscrowMinimumError",msg:"Wrong minimum"},{code:6007,name:"EscrowPartialFillNotAllowed",msg:"Partial fill is not allowed"},{code:6008,name:"EscrowTimestampExpired",msg:"Timestamp expired"},{code:6009,name:"WrongWhitelistProvided",msg:"Wrong whitelist is provided"},{code:6010,name:"DecimalPrecisionLoss",msg:"Decimal precision loss"},{code:6011,name:"SlippageLimitExceeded",msg:"Slippage limit exceeded"},{code:6012,name:"ConvertToFloat",msg:"Error converting to float"}]},Re="esccxeEDYUXQaeMwq1ZwWAvJaHVYfsXNva13JYb2Chs",Zt="whi5uDPWK4rAE9Sus6hdxdHwsG1hjDBn6kXM6pyqwTn",vr="feeLpAUDSsYBMwpxvVr5hwwDQE32BcWXRfAd3A6agWx",Ii=xi,Xe={exports:{}},ln;function Ti(){if(ln)return Xe.exports;ln=1;const n=/[\p{Lu}]/u,t=/[\p{Ll}]/u,e=/^[\p{Lu}](?![\p{Lu}])/gu,r=/([\p{Alpha}\p{N}_]|$)/u,s=/[_.\- ]+/,i=new RegExp("^"+s.source),o=new RegExp(s.source+r.source,"gu"),u=new RegExp("\\d+"+r.source,"gu"),h=(w,p,y)=>{let x=!1,E=!1,A=!1;for(let T=0;T<w.length;T++){const k=w[T];x&&n.test(k)?(w=w.slice(0,T)+"-"+w.slice(T),x=!1,A=E,E=!0,T++):E&&A&&t.test(k)?(w=w.slice(0,T-1)+"-"+w.slice(T-1),A=E,E=!1,x=!0):(x=p(k)===k&&y(k)!==k,A=E,E=y(k)===k&&p(k)!==k)}return w},l=(w,p)=>(e.lastIndex=0,w.replace(e,y=>p(y))),d=(w,p)=>(o.lastIndex=0,u.lastIndex=0,w.replace(o,(y,x)=>p(x)).replace(u,y=>p(y))),v=(w,p)=>{if(!(typeof w=="string"||Array.isArray(w)))throw new TypeError("Expected the input to be `string | string[]`");if(p={pascalCase:!1,preserveConsecutiveUppercase:!1,...p},Array.isArray(w)?w=w.map(A=>A.trim()).filter(A=>A.length).join("-"):w=w.trim(),w.length===0)return"";const y=p.locale===!1?A=>A.toLowerCase():A=>A.toLocaleLowerCase(p.locale),x=p.locale===!1?A=>A.toUpperCase():A=>A.toLocaleUpperCase(p.locale);return w.length===1?p.pascalCase?x(w):y(w):(w!==y(w)&&(w=h(w,y,x)),w=w.replace(i,""),p.preserveConsecutiveUppercase?w=l(w,y):w=y(w),p.pascalCase&&(w=x(w.charAt(0))+w.slice(1)),d(w,x))};return Xe.exports=v,Xe.exports.default=v,Xe.exports}var Pi=Ti();const H=ur(Pi);var De={},L={},dn;function fn(){if(dn)return L;dn=1;class n{constructor(a,c){if(!Number.isInteger(a))throw new TypeError("span must be an integer");this.span=a,this.property=c}makeDestinationObject(){return{}}decode(a,c){throw new Error("Layout is abstract")}encode(a,c,f){throw new Error("Layout is abstract")}getSpan(a,c){if(0>this.span)throw new RangeError("indeterminate span");return this.span}replicate(a){const c=Object.create(this.constructor.prototype);return Object.assign(c,this),c.property=a,c}fromArray(a){}}L.Layout=n;function t(g,a){return a.property?g+"["+a.property+"]":g}L.nameWithProperty=t;function e(g,a){if(typeof g!="function")throw new TypeError("Class must be constructor");if(g.hasOwnProperty("layout_"))throw new Error("Class is already bound to a layout");if(!(a&&a instanceof n))throw new TypeError("layout must be a Layout");if(a.hasOwnProperty("boundConstructor_"))throw new Error("layout is already bound to a constructor");g.layout_=a,a.boundConstructor_=g,a.makeDestinationObject=(()=>new g),Object.defineProperty(g.prototype,"encode",{value:function(c,f){return a.encode(this,c,f)},writable:!0}),Object.defineProperty(g,"decode",{value:function(c,f){return a.decode(c,f)},writable:!0})}L.bindConstructorLayout=e;class r extends n{isCount(){throw new Error("ExternalLayout is abstract")}}class s extends r{constructor(a,c){if(a===void 0&&(a=1),!Number.isInteger(a)||0>=a)throw new TypeError("elementSpan must be a (positive) integer");super(-1,c),this.elementSpan=a}isCount(){return!0}decode(a,c){c===void 0&&(c=0);const f=a.length-c;return Math.floor(f/this.elementSpan)}encode(a,c,f){return 0}}class i extends r{constructor(a,c,f){if(!(a instanceof n))throw new TypeError("layout must be a Layout");if(c===void 0)c=0;else if(!Number.isInteger(c))throw new TypeError("offset must be integer or undefined");super(a.span,f||a.property),this.layout=a,this.offset=c}isCount(){return this.layout instanceof o||this.layout instanceof u}decode(a,c){return c===void 0&&(c=0),this.layout.decode(a,c+this.offset)}encode(a,c,f){return f===void 0&&(f=0),this.layout.encode(a,c,f+this.offset)}}class o extends n{constructor(a,c){if(super(a,c),6<this.span)throw new RangeError("span must not exceed 6 bytes")}decode(a,c){return c===void 0&&(c=0),a.readUIntLE(c,this.span)}encode(a,c,f){return f===void 0&&(f=0),c.writeUIntLE(a,f,this.span),this.span}}class u extends n{constructor(a,c){if(super(a,c),6<this.span)throw new RangeError("span must not exceed 6 bytes")}decode(a,c){return c===void 0&&(c=0),a.readUIntBE(c,this.span)}encode(a,c,f){return f===void 0&&(f=0),c.writeUIntBE(a,f,this.span),this.span}}class h extends n{constructor(a,c){if(super(a,c),6<this.span)throw new RangeError("span must not exceed 6 bytes")}decode(a,c){return c===void 0&&(c=0),a.readIntLE(c,this.span)}encode(a,c,f){return f===void 0&&(f=0),c.writeIntLE(a,f,this.span),this.span}}class l extends n{constructor(a,c){if(super(a,c),6<this.span)throw new RangeError("span must not exceed 6 bytes")}decode(a,c){return c===void 0&&(c=0),a.readIntBE(c,this.span)}encode(a,c,f){return f===void 0&&(f=0),c.writeIntBE(a,f,this.span),this.span}}const d=Math.pow(2,32);function v(g){const a=Math.floor(g/d),c=g-a*d;return{hi32:a,lo32:c}}function w(g,a){return g*d+a}class p extends n{constructor(a){super(8,a)}decode(a,c){c===void 0&&(c=0);const f=a.readUInt32LE(c),_=a.readUInt32LE(c+4);return w(_,f)}encode(a,c,f){f===void 0&&(f=0);const _=v(a);return c.writeUInt32LE(_.lo32,f),c.writeUInt32LE(_.hi32,f+4),8}}class y extends n{constructor(a){super(8,a)}decode(a,c){c===void 0&&(c=0);const f=a.readUInt32BE(c),_=a.readUInt32BE(c+4);return w(f,_)}encode(a,c,f){f===void 0&&(f=0);const _=v(a);return c.writeUInt32BE(_.hi32,f),c.writeUInt32BE(_.lo32,f+4),8}}class x extends n{constructor(a){super(8,a)}decode(a,c){c===void 0&&(c=0);const f=a.readUInt32LE(c),_=a.readInt32LE(c+4);return w(_,f)}encode(a,c,f){f===void 0&&(f=0);const _=v(a);return c.writeUInt32LE(_.lo32,f),c.writeInt32LE(_.hi32,f+4),8}}class E extends n{constructor(a){super(8,a)}decode(a,c){c===void 0&&(c=0);const f=a.readInt32BE(c),_=a.readUInt32BE(c+4);return w(f,_)}encode(a,c,f){f===void 0&&(f=0);const _=v(a);return c.writeInt32BE(_.hi32,f),c.writeUInt32BE(_.lo32,f+4),8}}class A extends n{constructor(a){super(4,a)}decode(a,c){return c===void 0&&(c=0),a.readFloatLE(c)}encode(a,c,f){return f===void 0&&(f=0),c.writeFloatLE(a,f),4}}class T extends n{constructor(a){super(4,a)}decode(a,c){return c===void 0&&(c=0),a.readFloatBE(c)}encode(a,c,f){return f===void 0&&(f=0),c.writeFloatBE(a,f),4}}class k extends n{constructor(a){super(8,a)}decode(a,c){return c===void 0&&(c=0),a.readDoubleLE(c)}encode(a,c,f){return f===void 0&&(f=0),c.writeDoubleLE(a,f),8}}class S extends n{constructor(a){super(8,a)}decode(a,c){return c===void 0&&(c=0),a.readDoubleBE(c)}encode(a,c,f){return f===void 0&&(f=0),c.writeDoubleBE(a,f),8}}class B extends n{constructor(a,c,f){if(!(a instanceof n))throw new TypeError("elementLayout must be a Layout");if(!(c instanceof r&&c.isCount()||Number.isInteger(c)&&0<=c))throw new TypeError("count must be non-negative integer or an unsigned integer ExternalLayout");let _=-1;!(c instanceof r)&&0<a.span&&(_=c*a.span),super(_,f),this.elementLayout=a,this.count=c}getSpan(a,c){if(0<=this.span)return this.span;c===void 0&&(c=0);let f=0,_=this.count;if(_ instanceof r&&(_=_.decode(a,c)),0<this.elementLayout.span)f=_*this.elementLayout.span;else{let P=0;for(;P<_;)f+=this.elementLayout.getSpan(a,c+f),++P}return f}decode(a,c){c===void 0&&(c=0);const f=[];let _=0,P=this.count;for(P instanceof r&&(P=P.decode(a,c));_<P;)f.push(this.elementLayout.decode(a,c)),c+=this.elementLayout.getSpan(a,c),_+=1;return f}encode(a,c,f){f===void 0&&(f=0);const _=this.elementLayout,P=a.reduce((K,X)=>K+_.encode(X,c,f+K),0);return this.count instanceof r&&this.count.encode(a.length,c,f),P}}class G extends n{constructor(a,c,f){if(!(Array.isArray(a)&&a.reduce((P,K)=>P&&K instanceof n,!0)))throw new TypeError("fields must be array of Layout instances");typeof c=="boolean"&&f===void 0&&(f=c,c=void 0);for(const P of a)if(0>P.span&&P.property===void 0)throw new Error("fields cannot contain unnamed variable-length layout");let _=-1;try{_=a.reduce((P,K)=>P+K.getSpan(),0)}catch{}super(_,c),this.fields=a,this.decodePrefixes=!!f}getSpan(a,c){if(0<=this.span)return this.span;c===void 0&&(c=0);let f=0;try{f=this.fields.reduce((_,P)=>{const K=P.getSpan(a,c);return c+=K,_+K},0)}catch{throw new RangeError("indeterminate span")}return f}decode(a,c){c===void 0&&(c=0);const f=this.makeDestinationObject();for(const _ of this.fields)if(_.property!==void 0&&(f[_.property]=_.decode(a,c)),c+=_.getSpan(a,c),this.decodePrefixes&&a.length===c)break;return f}encode(a,c,f){f===void 0&&(f=0);const _=f;let P=0,K=0;for(const X of this.fields){let Me=X.span;if(K=0<Me?Me:0,X.property!==void 0){const on=a[X.property];on!==void 0&&(K=X.encode(on,c,f),0>Me&&(Me=X.getSpan(c,f)))}P=f,f+=Me}return P+K-_}fromArray(a){const c=this.makeDestinationObject();for(const f of this.fields)f.property!==void 0&&0<a.length&&(c[f.property]=a.shift());return c}layoutFor(a){if(typeof a!="string")throw new TypeError("property must be string");for(const c of this.fields)if(c.property===a)return c}offsetOf(a){if(typeof a!="string")throw new TypeError("property must be string");let c=0;for(const f of this.fields){if(f.property===a)return c;0>f.span?c=-1:0<=c&&(c+=f.span)}}}class O{constructor(a){this.property=a}decode(){throw new Error("UnionDiscriminator is abstract")}encode(){throw new Error("UnionDiscriminator is abstract")}}class z extends O{constructor(a,c){if(!(a instanceof r&&a.isCount()))throw new TypeError("layout must be an unsigned integer ExternalLayout");super(c||a.property||"variant"),this.layout=a}decode(a,c){return this.layout.decode(a,c)}encode(a,c,f){return this.layout.encode(a,c,f)}}class q extends n{constructor(a,c,f){const _=a instanceof o||a instanceof u;if(_)a=new z(new i(a));else if(a instanceof r&&a.isCount())a=new z(a);else if(!(a instanceof O))throw new TypeError("discr must be a UnionDiscriminator or an unsigned integer layout");if(c===void 0&&(c=null),!(c===null||c instanceof n))throw new TypeError("defaultLayout must be null or a Layout");if(c!==null){if(0>c.span)throw new Error("defaultLayout must have constant span");c.property===void 0&&(c=c.replicate("content"))}let P=-1;c&&(P=c.span,0<=P&&_&&(P+=a.layout.span)),super(P,f),this.discriminator=a,this.usesPrefixDiscriminator=_,this.defaultLayout=c,this.registry={};let K=this.defaultGetSourceVariant.bind(this);this.getSourceVariant=function(X){return K(X)},this.configGetSourceVariant=function(X){K=X.bind(this)}}getSpan(a,c){if(0<=this.span)return this.span;c===void 0&&(c=0);const f=this.getVariant(a,c);if(!f)throw new Error("unable to determine span for unrecognized variant");return f.getSpan(a,c)}defaultGetSourceVariant(a){if(a.hasOwnProperty(this.discriminator.property)){if(this.defaultLayout&&a.hasOwnProperty(this.defaultLayout.property))return;const c=this.registry[a[this.discriminator.property]];if(c&&(!c.layout||a.hasOwnProperty(c.property)))return c}else for(const c in this.registry){const f=this.registry[c];if(a.hasOwnProperty(f.property))return f}throw new Error("unable to infer src variant")}decode(a,c){c===void 0&&(c=0);let f;const _=this.discriminator,P=_.decode(a,c);let K=this.registry[P];if(K===void 0){let X=0;K=this.defaultLayout,this.usesPrefixDiscriminator&&(X=_.layout.span),f=this.makeDestinationObject(),f[_.property]=P,f[K.property]=this.defaultLayout.decode(a,c+X)}else f=K.decode(a,c);return f}encode(a,c,f){f===void 0&&(f=0);const _=this.getSourceVariant(a);if(_===void 0){const P=this.discriminator,K=this.defaultLayout;let X=0;return this.usesPrefixDiscriminator&&(X=P.layout.span),P.encode(a[P.property],c,f),X+K.encode(a[K.property],c,f+X)}return _.encode(a,c,f)}addVariant(a,c,f){const _=new D(this,a,c,f);return this.registry[a]=_,_}getVariant(a,c){let f=a;return Buffer.isBuffer(a)&&(c===void 0&&(c=0),f=this.discriminator.decode(a,c)),this.registry[f]}}class D extends n{constructor(a,c,f,_){if(!(a instanceof q))throw new TypeError("union must be a Union");if(!Number.isInteger(c)||0>c)throw new TypeError("variant must be a (non-negative) integer");if(typeof f=="string"&&_===void 0&&(_=f,f=null),f){if(!(f instanceof n))throw new TypeError("layout must be a Layout");if(a.defaultLayout!==null&&0<=f.span&&f.span>a.defaultLayout.span)throw new Error("variant span exceeds span of containing union");if(typeof _!="string")throw new TypeError("variant must have a String property")}let P=a.span;0>a.span&&(P=f?f.span:0,0<=P&&a.usesPrefixDiscriminator&&(P+=a.discriminator.layout.span)),super(P,_),this.union=a,this.variant=c,this.layout=f||null}getSpan(a,c){if(0<=this.span)return this.span;c===void 0&&(c=0);let f=0;return this.union.usesPrefixDiscriminator&&(f=this.union.discriminator.layout.span),f+this.layout.getSpan(a,c+f)}decode(a,c){const f=this.makeDestinationObject();if(c===void 0&&(c=0),this!==this.union.getVariant(a,c))throw new Error("variant mismatch");let _=0;return this.union.usesPrefixDiscriminator&&(_=this.union.discriminator.layout.span),this.layout?f[this.property]=this.layout.decode(a,c+_):this.property?f[this.property]=!0:this.union.usesPrefixDiscriminator&&(f[this.union.discriminator.property]=this.variant),f}encode(a,c,f){f===void 0&&(f=0);let _=0;if(this.union.usesPrefixDiscriminator&&(_=this.union.discriminator.layout.span),this.layout&&!a.hasOwnProperty(this.property))throw new TypeError("variant lacks property "+this.property);this.union.discriminator.encode(this.variant,c,f);let P=_;if(this.layout&&(this.layout.encode(a[this.property],c,f+_),P+=this.layout.getSpan(c,f+_),0<=this.union.span&&P>this.union.span))throw new Error("encoded variant overruns containing union");return P}fromArray(a){if(this.layout)return this.layout.fromArray(a)}}function M(g){return 0>g&&(g+=4294967296),g}class R extends n{constructor(a,c,f){if(!(a instanceof o||a instanceof u))throw new TypeError("word must be a UInt or UIntBE layout");if(typeof c=="string"&&f===void 0&&(f=c,c=void 0),4<a.span)throw new RangeError("word cannot exceed 32 bits");super(a.span,f),this.word=a,this.msb=!!c,this.fields=[];let _=0;this._packedSetValue=function(P){return _=M(P),this},this._packedGetValue=function(){return _}}decode(a,c){const f=this.makeDestinationObject();c===void 0&&(c=0);const _=this.word.decode(a,c);this._packedSetValue(_);for(const P of this.fields)P.property!==void 0&&(f[P.property]=P.decode(_));return f}encode(a,c,f){f===void 0&&(f=0);const _=this.word.decode(c,f);this._packedSetValue(_);for(const P of this.fields)if(P.property!==void 0){const K=a[P.property];K!==void 0&&P.encode(K)}return this.word.encode(this._packedGetValue(),c,f)}addField(a,c){const f=new I(this,a,c);return this.fields.push(f),f}addBoolean(a){const c=new m(this,a);return this.fields.push(c),c}fieldFor(a){if(typeof a!="string")throw new TypeError("property must be string");for(const c of this.fields)if(c.property===a)return c}}class I{constructor(a,c,f){if(!(a instanceof R))throw new TypeError("container must be a BitStructure");if(!Number.isInteger(c)||0>=c)throw new TypeError("bits must be positive integer");const _=8*a.span,P=a.fields.reduce((K,X)=>K+X.bits,0);if(c+P>_)throw new Error("bits too long for span remainder ("+(_-P)+" of "+_+" remain)");this.container=a,this.bits=c,this.valueMask=(1<<c)-1,c===32&&(this.valueMask=4294967295),this.start=P,this.container.msb&&(this.start=_-P-c),this.wordMask=M(this.valueMask<<this.start),this.property=f}decode(){const a=this.container._packedGetValue();return M(a&this.wordMask)>>>this.start}encode(a){if(!Number.isInteger(a)||a!==M(a&this.valueMask))throw new TypeError(t("BitField.encode",this)+" value must be integer not exceeding "+this.valueMask);const c=this.container._packedGetValue(),f=M(a<<this.start);this.container._packedSetValue(M(c&~this.wordMask)|f)}}class m extends I{constructor(a,c){super(a,1,c)}decode(a,c){return!!I.prototype.decode.call(this,a,c)}encode(a){return typeof a=="boolean"&&(a=+a),I.prototype.encode.call(this,a)}}class b extends n{constructor(a,c){if(!(a instanceof r&&a.isCount()||Number.isInteger(a)&&0<=a))throw new TypeError("length must be positive integer or an unsigned integer ExternalLayout");let f=-1;a instanceof r||(f=a),super(f,c),this.length=a}getSpan(a,c){let f=this.span;return 0>f&&(f=this.length.decode(a,c)),f}decode(a,c){c===void 0&&(c=0);let f=this.span;return 0>f&&(f=this.length.decode(a,c)),a.slice(c,c+f)}encode(a,c,f){let _=this.length;if(this.length instanceof r&&(_=a.length),!(Buffer.isBuffer(a)&&_===a.length))throw new TypeError(t("Blob.encode",this)+" requires (length "+_+") Buffer as src");if(f+_>c.length)throw new RangeError("encoding overruns Buffer");return c.write(a.toString("hex"),f,_,"hex"),this.length instanceof r&&this.length.encode(_,c,f),_}}class C extends n{constructor(a){super(-1,a)}getSpan(a,c){if(!Buffer.isBuffer(a))throw new TypeError("b must be a Buffer");c===void 0&&(c=0);let f=c;for(;f<a.length&&a[f]!==0;)f+=1;return 1+f-c}decode(a,c,f){c===void 0&&(c=0);let _=this.getSpan(a,c);return a.slice(c,c+_-1).toString("utf-8")}encode(a,c,f){f===void 0&&(f=0),typeof a!="string"&&(a=a.toString());const _=new Buffer(a,"utf8"),P=_.length;if(f+P>c.length)throw new RangeError("encoding overruns Buffer");return _.copy(c,f),c[f+P]=0,P+1}}class V extends n{constructor(a,c){if(typeof a=="string"&&c===void 0&&(c=a,a=void 0),a===void 0)a=-1;else if(!Number.isInteger(a))throw new TypeError("maxSpan must be an integer");super(-1,c),this.maxSpan=a}getSpan(a,c){if(!Buffer.isBuffer(a))throw new TypeError("b must be a Buffer");return c===void 0&&(c=0),a.length-c}decode(a,c,f){c===void 0&&(c=0);let _=this.getSpan(a,c);if(0<=this.maxSpan&&this.maxSpan<_)throw new RangeError("text length exceeds maxSpan");return a.slice(c,c+_).toString("utf-8")}encode(a,c,f){f===void 0&&(f=0),typeof a!="string"&&(a=a.toString());const _=new Buffer(a,"utf8"),P=_.length;if(0<=this.maxSpan&&this.maxSpan<P)throw new RangeError("text length exceeds maxSpan");if(f+P>c.length)throw new RangeError("encoding overruns Buffer");return _.copy(c,f),P}}class W extends n{constructor(a,c){super(0,c),this.value=a}decode(a,c,f){return this.value}encode(a,c,f){return 0}}return L.ExternalLayout=r,L.GreedyCount=s,L.OffsetLayout=i,L.UInt=o,L.UIntBE=u,L.Int=h,L.IntBE=l,L.Float=A,L.FloatBE=T,L.Double=k,L.DoubleBE=S,L.Sequence=B,L.Structure=G,L.UnionDiscriminator=O,L.UnionLayoutDiscriminator=z,L.Union=q,L.VariantLayout=D,L.BitStructure=R,L.BitField=I,L.Boolean=m,L.Blob=b,L.CString=C,L.UTF8=V,L.Constant=W,L.greedy=((g,a)=>new s(g,a)),L.offset=((g,a,c)=>new i(g,a,c)),L.u8=(g=>new o(1,g)),L.u16=(g=>new o(2,g)),L.u24=(g=>new o(3,g)),L.u32=(g=>new o(4,g)),L.u40=(g=>new o(5,g)),L.u48=(g=>new o(6,g)),L.nu64=(g=>new p(g)),L.u16be=(g=>new u(2,g)),L.u24be=(g=>new u(3,g)),L.u32be=(g=>new u(4,g)),L.u40be=(g=>new u(5,g)),L.u48be=(g=>new u(6,g)),L.nu64be=(g=>new y(g)),L.s8=(g=>new h(1,g)),L.s16=(g=>new h(2,g)),L.s24=(g=>new h(3,g)),L.s32=(g=>new h(4,g)),L.s40=(g=>new h(5,g)),L.s48=(g=>new h(6,g)),L.ns64=(g=>new x(g)),L.s16be=(g=>new l(2,g)),L.s24be=(g=>new l(3,g)),L.s32be=(g=>new l(4,g)),L.s40be=(g=>new l(5,g)),L.s48be=(g=>new l(6,g)),L.ns64be=(g=>new E(g)),L.f32=(g=>new A(g)),L.f32be=(g=>new T(g)),L.f64=(g=>new k(g)),L.f64be=(g=>new S(g)),L.struct=((g,a,c)=>new G(g,a,c)),L.bits=((g,a,c)=>new R(g,a,c)),L.seq=((g,a,c)=>new B(g,a,c)),L.union=((g,a,c)=>new q(g,a,c)),L.unionLayoutDiscriminator=((g,a)=>new z(g,a)),L.blob=((g,a)=>new b(g,a)),L.cstr=(g=>new C(g)),L.utf8=((g,a)=>new V(g,a)),L.const=((g,a)=>new W(g,a)),L}const Li=ci(ui);var hn;function Ci(){return hn||(hn=1,(function(n){var t=De&&De.__importDefault||function(R){return R&&R.__esModule?R:{default:R}};Object.defineProperty(n,"__esModule",{value:!0}),n.map=n.array=n.rustEnum=n.str=n.vecU8=n.tagged=n.vec=n.bool=n.option=n.publicKey=n.i256=n.u256=n.i128=n.u128=n.i64=n.u64=n.struct=n.f64=n.f32=n.i32=n.u32=n.i16=n.u16=n.i8=n.u8=void 0;const e=fn(),r=Li,s=t(li());var i=fn();Object.defineProperty(n,"u8",{enumerable:!0,get:function(){return i.u8}}),Object.defineProperty(n,"i8",{enumerable:!0,get:function(){return i.s8}}),Object.defineProperty(n,"u16",{enumerable:!0,get:function(){return i.u16}}),Object.defineProperty(n,"i16",{enumerable:!0,get:function(){return i.s16}}),Object.defineProperty(n,"u32",{enumerable:!0,get:function(){return i.u32}}),Object.defineProperty(n,"i32",{enumerable:!0,get:function(){return i.s32}}),Object.defineProperty(n,"f32",{enumerable:!0,get:function(){return i.f32}}),Object.defineProperty(n,"f64",{enumerable:!0,get:function(){return i.f64}}),Object.defineProperty(n,"struct",{enumerable:!0,get:function(){return i.struct}});class o extends e.Layout{constructor(I,m,b){super(I,b),this.blob=(0,e.blob)(I),this.signed=m}decode(I,m=0){const b=new s.default(this.blob.decode(I,m),10,"le");return this.signed?b.fromTwos(this.span*8).clone():b}encode(I,m,b=0){return this.signed&&(I=I.toTwos(this.span*8)),this.blob.encode(I.toArrayLike(Buffer,"le",this.span),m,b)}}function u(R){return new o(8,!1,R)}n.u64=u;function h(R){return new o(8,!0,R)}n.i64=h;function l(R){return new o(16,!1,R)}n.u128=l;function d(R){return new o(16,!0,R)}n.i128=d;function v(R){return new o(32,!1,R)}n.u256=v;function w(R){return new o(32,!0,R)}n.i256=w;class p extends e.Layout{constructor(I,m,b,C){super(I.span,C),this.layout=I,this.decoder=m,this.encoder=b}decode(I,m){return this.decoder(this.layout.decode(I,m))}encode(I,m,b){return this.layout.encode(this.encoder(I),m,b)}getSpan(I,m){return this.layout.getSpan(I,m)}}function y(R){return new p((0,e.blob)(32),I=>new r.PublicKey(I),I=>I.toBuffer(),R)}n.publicKey=y;class x extends e.Layout{constructor(I,m){super(-1,m),this.layout=I,this.discriminator=(0,e.u8)()}encode(I,m,b=0){return I==null?this.discriminator.encode(0,m,b):(this.discriminator.encode(1,m,b),this.layout.encode(I,m,b+1)+1)}decode(I,m=0){const b=this.discriminator.decode(I,m);if(b===0)return null;if(b===1)return this.layout.decode(I,m+1);throw new Error("Invalid option "+this.property)}getSpan(I,m=0){const b=this.discriminator.decode(I,m);if(b===0)return 1;if(b===1)return this.layout.getSpan(I,m+1)+1;throw new Error("Invalid option "+this.property)}}function E(R,I){return new x(R,I)}n.option=E;function A(R){return new p((0,e.u8)(),T,k,R)}n.bool=A;function T(R){if(R===0)return!1;if(R===1)return!0;throw new Error("Invalid bool: "+R)}function k(R){return R?1:0}function S(R,I){const m=(0,e.u32)("length"),b=(0,e.struct)([m,(0,e.seq)(R,(0,e.offset)(m,-m.span),"values")]);return new p(b,({values:C})=>C,C=>({values:C}),I)}n.vec=S;function B(R,I,m){const b=(0,e.struct)([u("tag"),I.replicate("data")]);function C({tag:V,data:W}){if(!V.eq(R))throw new Error("Invalid tag, expected: "+R.toString("hex")+", got: "+V.toString("hex"));return W}return new p(b,C,V=>({tag:R,data:V}),m)}n.tagged=B;function G(R){const I=(0,e.u32)("length"),m=(0,e.struct)([I,(0,e.blob)((0,e.offset)(I,-I.span),"data")]);return new p(m,({data:b})=>b,b=>({data:b}),R)}n.vecU8=G;function O(R){return new p(G(),I=>I.toString("utf-8"),I=>Buffer.from(I,"utf-8"),R)}n.str=O;function z(R,I,m){const b=(0,e.union)(m??(0,e.u8)(),I);return R.forEach((C,V)=>b.addVariant(V,C,C.property)),b}n.rustEnum=z;function q(R,I,m){const b=(0,e.struct)([(0,e.seq)(R,I,"values")]);return new p(b,({values:C})=>C,C=>({values:C}),m)}n.array=q;class D extends e.Layout{constructor(I,m,b){super(I.span+m.span,b),this.keyLayout=I,this.valueLayout=m}decode(I,m){m=m||0;const b=this.keyLayout.decode(I,m),C=this.valueLayout.decode(I,m+this.keyLayout.getSpan(I,m));return[b,C]}encode(I,m,b){b=b||0;const C=this.keyLayout.encode(I[0],m,b),V=this.valueLayout.encode(I[1],m,b+C);return C+V}getSpan(I,m){return this.keyLayout.getSpan(I,m)+this.valueLayout.getSpan(I,m)}}function M(R,I,m){const b=(0,e.u32)("length"),C=(0,e.struct)([b,(0,e.seq)(new D(R,I),(0,e.offset)(b,-b.span),"values")]);return new p(C,({values:V})=>new Map(V),V=>({values:Array.from(V.entries())}),m)}n.map=M})(De)),De}var F=Ci();function Oe(n){let t=n.length;for(;--t>=0;)n[t]=0}const Bi=3,Ri=258,br=29,Oi=256,Mi=Oi+1+br,Er=30,Di=512,Ni=new Array((Mi+2)*2);Oe(Ni);const Ui=new Array(Er*2);Oe(Ui);const zi=new Array(Di);Oe(zi);const qi=new Array(Ri-Bi+1);Oe(qi);const Fi=new Array(br);Oe(Fi);const Vi=new Array(Er);Oe(Vi);const ji=(n,t,e,r)=>{let s=n&65535|0,i=n>>>16&65535|0,o=0;for(;e!==0;){o=e>2e3?2e3:e,e-=o;do s=s+t[r++]|0,i=i+s|0;while(--o);s%=65521,i%=65521}return s|i<<16|0};var Ut=ji;const Gi=()=>{let n,t=[];for(var e=0;e<256;e++){n=e;for(var r=0;r<8;r++)n=n&1?3988292384^n>>>1:n>>>1;t[e]=n}return t},Ki=new Uint32Array(Gi()),Wi=(n,t,e,r)=>{const s=Ki,i=r+e;n^=-1;for(let o=r;o<i;o++)n=n>>>8^s[(n^t[o])&255];return n^-1};var ue=Wi,zt={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},_r={Z_NO_FLUSH:0,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFLATED:8};const $i=(n,t)=>Object.prototype.hasOwnProperty.call(n,t);var Hi=function(n){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const e=t.shift();if(e){if(typeof e!="object")throw new TypeError(e+"must be non-object");for(const r in e)$i(e,r)&&(n[r]=e[r])}}return n},Zi=n=>{let t=0;for(let r=0,s=n.length;r<s;r++)t+=n[r].length;const e=new Uint8Array(t);for(let r=0,s=0,i=n.length;r<i;r++){let o=n[r];e.set(o,s),s+=o.length}return e},Ar={assign:Hi,flattenChunks:Zi};let kr=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{kr=!1}const je=new Uint8Array(256);for(let n=0;n<256;n++)je[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;je[254]=je[254]=1;var Xi=n=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(n);let t,e,r,s,i,o=n.length,u=0;for(s=0;s<o;s++)e=n.charCodeAt(s),(e&64512)===55296&&s+1<o&&(r=n.charCodeAt(s+1),(r&64512)===56320&&(e=65536+(e-55296<<10)+(r-56320),s++)),u+=e<128?1:e<2048?2:e<65536?3:4;for(t=new Uint8Array(u),i=0,s=0;i<u;s++)e=n.charCodeAt(s),(e&64512)===55296&&s+1<o&&(r=n.charCodeAt(s+1),(r&64512)===56320&&(e=65536+(e-55296<<10)+(r-56320),s++)),e<128?t[i++]=e:e<2048?(t[i++]=192|e>>>6,t[i++]=128|e&63):e<65536?(t[i++]=224|e>>>12,t[i++]=128|e>>>6&63,t[i++]=128|e&63):(t[i++]=240|e>>>18,t[i++]=128|e>>>12&63,t[i++]=128|e>>>6&63,t[i++]=128|e&63);return t};const Yi=(n,t)=>{if(t<65534&&n.subarray&&kr)return String.fromCharCode.apply(null,n.length===t?n:n.subarray(0,t));let e="";for(let r=0;r<t;r++)e+=String.fromCharCode(n[r]);return e};var Ji=(n,t)=>{const e=t||n.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(n.subarray(0,t));let r,s;const i=new Array(e*2);for(s=0,r=0;r<e;){let o=n[r++];if(o<128){i[s++]=o;continue}let u=je[o];if(u>4){i[s++]=65533,r+=u-1;continue}for(o&=u===2?31:u===3?15:7;u>1&&r<e;)o=o<<6|n[r++]&63,u--;if(u>1){i[s++]=65533;continue}o<65536?i[s++]=o:(o-=65536,i[s++]=55296|o>>10&1023,i[s++]=56320|o&1023)}return Yi(i,s)},Qi=(n,t)=>{t=t||n.length,t>n.length&&(t=n.length);let e=t-1;for(;e>=0&&(n[e]&192)===128;)e--;return e<0||e===0?t:e+je[n[e]]>t?e:t},qt={string2buf:Xi,buf2string:Ji,utf8border:Qi};function es(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var ts=es;const Ye=16209,ns=16191;var rs=function(t,e){let r,s,i,o,u,h,l,d,v,w,p,y,x,E,A,T,k,S,B,G,O,z,q,D;const M=t.state;r=t.next_in,q=t.input,s=r+(t.avail_in-5),i=t.next_out,D=t.output,o=i-(e-t.avail_out),u=i+(t.avail_out-257),h=M.dmax,l=M.wsize,d=M.whave,v=M.wnext,w=M.window,p=M.hold,y=M.bits,x=M.lencode,E=M.distcode,A=(1<<M.lenbits)-1,T=(1<<M.distbits)-1;e:do{y<15&&(p+=q[r++]<<y,y+=8,p+=q[r++]<<y,y+=8),k=x[p&A];t:for(;;){if(S=k>>>24,p>>>=S,y-=S,S=k>>>16&255,S===0)D[i++]=k&65535;else if(S&16){B=k&65535,S&=15,S&&(y<S&&(p+=q[r++]<<y,y+=8),B+=p&(1<<S)-1,p>>>=S,y-=S),y<15&&(p+=q[r++]<<y,y+=8,p+=q[r++]<<y,y+=8),k=E[p&T];n:for(;;){if(S=k>>>24,p>>>=S,y-=S,S=k>>>16&255,S&16){if(G=k&65535,S&=15,y<S&&(p+=q[r++]<<y,y+=8,y<S&&(p+=q[r++]<<y,y+=8)),G+=p&(1<<S)-1,G>h){t.msg="invalid distance too far back",M.mode=Ye;break e}if(p>>>=S,y-=S,S=i-o,G>S){if(S=G-S,S>d&&M.sane){t.msg="invalid distance too far back",M.mode=Ye;break e}if(O=0,z=w,v===0){if(O+=l-S,S<B){B-=S;do D[i++]=w[O++];while(--S);O=i-G,z=D}}else if(v<S){if(O+=l+v-S,S-=v,S<B){B-=S;do D[i++]=w[O++];while(--S);if(O=0,v<B){S=v,B-=S;do D[i++]=w[O++];while(--S);O=i-G,z=D}}}else if(O+=v-S,S<B){B-=S;do D[i++]=w[O++];while(--S);O=i-G,z=D}for(;B>2;)D[i++]=z[O++],D[i++]=z[O++],D[i++]=z[O++],B-=3;B&&(D[i++]=z[O++],B>1&&(D[i++]=z[O++]))}else{O=i-G;do D[i++]=D[O++],D[i++]=D[O++],D[i++]=D[O++],B-=3;while(B>2);B&&(D[i++]=D[O++],B>1&&(D[i++]=D[O++]))}}else if((S&64)===0){k=E[(k&65535)+(p&(1<<S)-1)];continue n}else{t.msg="invalid distance code",M.mode=Ye;break e}break}}else if((S&64)===0){k=x[(k&65535)+(p&(1<<S)-1)];continue t}else if(S&32){M.mode=ns;break e}else{t.msg="invalid literal/length code",M.mode=Ye;break e}break}}while(r<s&&i<u);B=y>>3,r-=B,y-=B<<3,p&=(1<<y)-1,t.next_in=r,t.next_out=i,t.avail_in=r<s?5+(s-r):5-(r-s),t.avail_out=i<u?257+(u-i):257-(i-u),M.hold=p,M.bits=y};const Pe=15,pn=852,mn=592,wn=0,kt=1,gn=2,is=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),ss=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),os=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),as=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),cs=(n,t,e,r,s,i,o,u)=>{const h=u.bits;let l=0,d=0,v=0,w=0,p=0,y=0,x=0,E=0,A=0,T=0,k,S,B,G,O,z=null,q;const D=new Uint16Array(Pe+1),M=new Uint16Array(Pe+1);let R=null,I,m,b;for(l=0;l<=Pe;l++)D[l]=0;for(d=0;d<r;d++)D[t[e+d]]++;for(p=h,w=Pe;w>=1&&D[w]===0;w--);if(p>w&&(p=w),w===0)return s[i++]=1<<24|64<<16|0,s[i++]=1<<24|64<<16|0,u.bits=1,0;for(v=1;v<w&&D[v]===0;v++);for(p<v&&(p=v),E=1,l=1;l<=Pe;l++)if(E<<=1,E-=D[l],E<0)return-1;if(E>0&&(n===wn||w!==1))return-1;for(M[1]=0,l=1;l<Pe;l++)M[l+1]=M[l]+D[l];for(d=0;d<r;d++)t[e+d]!==0&&(o[M[t[e+d]]++]=d);if(n===wn?(z=R=o,q=20):n===kt?(z=is,R=ss,q=257):(z=os,R=as,q=0),T=0,d=0,l=v,O=i,y=p,x=0,B=-1,A=1<<p,G=A-1,n===kt&&A>pn||n===gn&&A>mn)return 1;for(;;){I=l-x,o[d]+1<q?(m=0,b=o[d]):o[d]>=q?(m=R[o[d]-q],b=z[o[d]-q]):(m=96,b=0),k=1<<l-x,S=1<<y,v=S;do S-=k,s[O+(T>>x)+S]=I<<24|m<<16|b|0;while(S!==0);for(k=1<<l-1;T&k;)k>>=1;if(k!==0?(T&=k-1,T+=k):T=0,d++,--D[l]===0){if(l===w)break;l=t[e+o[d]]}if(l>p&&(T&G)!==B){for(x===0&&(x=p),O+=v,y=l-x,E=1<<y;y+x<w&&(E-=D[y+x],!(E<=0));)y++,E<<=1;if(A+=1<<y,n===kt&&A>pn||n===gn&&A>mn)return 1;B=T&G,s[B]=p<<24|y<<16|O-i|0}}return T!==0&&(s[O+T]=l-x<<24|64<<16|0),u.bits=p,0};var Fe=cs;const us=0,Sr=1,xr=2,{Z_FINISH:yn,Z_BLOCK:ls,Z_TREES:Je,Z_OK:xe,Z_STREAM_END:ds,Z_NEED_DICT:fs,Z_STREAM_ERROR:oe,Z_DATA_ERROR:Ir,Z_MEM_ERROR:Tr,Z_BUF_ERROR:hs,Z_DEFLATED:vn}=_r,gt=16180,bn=16181,En=16182,_n=16183,An=16184,kn=16185,Sn=16186,xn=16187,In=16188,Tn=16189,ct=16190,fe=16191,St=16192,Pn=16193,xt=16194,Ln=16195,Cn=16196,Bn=16197,Rn=16198,Qe=16199,et=16200,On=16201,Mn=16202,Dn=16203,Nn=16204,Un=16205,It=16206,zn=16207,qn=16208,$=16209,Pr=16210,Lr=16211,ps=852,ms=592,ws=15,gs=ws,Fn=n=>(n>>>24&255)+(n>>>8&65280)+((n&65280)<<8)+((n&255)<<24);function ys(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Te=n=>{if(!n)return 1;const t=n.state;return!t||t.strm!==n||t.mode<gt||t.mode>Lr?1:0},Cr=n=>{if(Te(n))return oe;const t=n.state;return n.total_in=n.total_out=t.total=0,n.msg="",t.wrap&&(n.adler=t.wrap&1),t.mode=gt,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(ps),t.distcode=t.distdyn=new Int32Array(ms),t.sane=1,t.back=-1,xe},Br=n=>{if(Te(n))return oe;const t=n.state;return t.wsize=0,t.whave=0,t.wnext=0,Cr(n)},Rr=(n,t)=>{let e;if(Te(n))return oe;const r=n.state;return t<0?(e=0,t=-t):(e=(t>>4)+5,t<48&&(t&=15)),t&&(t<8||t>15)?oe:(r.window!==null&&r.wbits!==t&&(r.window=null),r.wrap=e,r.wbits=t,Br(n))},Or=(n,t)=>{if(!n)return oe;const e=new ys;n.state=e,e.strm=n,e.window=null,e.mode=gt;const r=Rr(n,t);return r!==xe&&(n.state=null),r},vs=n=>Or(n,gs);let Vn=!0,Tt,Pt;const bs=n=>{if(Vn){Tt=new Int32Array(512),Pt=new Int32Array(32);let t=0;for(;t<144;)n.lens[t++]=8;for(;t<256;)n.lens[t++]=9;for(;t<280;)n.lens[t++]=7;for(;t<288;)n.lens[t++]=8;for(Fe(Sr,n.lens,0,288,Tt,0,n.work,{bits:9}),t=0;t<32;)n.lens[t++]=5;Fe(xr,n.lens,0,32,Pt,0,n.work,{bits:5}),Vn=!1}n.lencode=Tt,n.lenbits=9,n.distcode=Pt,n.distbits=5},Mr=(n,t,e,r)=>{let s;const i=n.state;return i.window===null&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new Uint8Array(i.wsize)),r>=i.wsize?(i.window.set(t.subarray(e-i.wsize,e),0),i.wnext=0,i.whave=i.wsize):(s=i.wsize-i.wnext,s>r&&(s=r),i.window.set(t.subarray(e-r,e-r+s),i.wnext),r-=s,r?(i.window.set(t.subarray(e-r,e),0),i.wnext=r,i.whave=i.wsize):(i.wnext+=s,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=s))),0},Es=(n,t)=>{let e,r,s,i,o,u,h,l,d,v,w,p,y,x,E=0,A,T,k,S,B,G,O,z;const q=new Uint8Array(4);let D,M;const R=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Te(n)||!n.output||!n.input&&n.avail_in!==0)return oe;e=n.state,e.mode===fe&&(e.mode=St),o=n.next_out,s=n.output,h=n.avail_out,i=n.next_in,r=n.input,u=n.avail_in,l=e.hold,d=e.bits,v=u,w=h,z=xe;e:for(;;)switch(e.mode){case gt:if(e.wrap===0){e.mode=St;break}for(;d<16;){if(u===0)break e;u--,l+=r[i++]<<d,d+=8}if(e.wrap&2&&l===35615){e.wbits===0&&(e.wbits=15),e.check=0,q[0]=l&255,q[1]=l>>>8&255,e.check=ue(e.check,q,2,0),l=0,d=0,e.mode=bn;break}if(e.head&&(e.head.done=!1),!(e.wrap&1)||(((l&255)<<8)+(l>>8))%31){n.msg="incorrect header check",e.mode=$;break}if((l&15)!==vn){n.msg="unknown compression method",e.mode=$;break}if(l>>>=4,d-=4,O=(l&15)+8,e.wbits===0&&(e.wbits=O),O>15||O>e.wbits){n.msg="invalid window size",e.mode=$;break}e.dmax=1<<e.wbits,e.flags=0,n.adler=e.check=1,e.mode=l&512?Tn:fe,l=0,d=0;break;case bn:for(;d<16;){if(u===0)break e;u--,l+=r[i++]<<d,d+=8}if(e.flags=l,(e.flags&255)!==vn){n.msg="unknown compression method",e.mode=$;break}if(e.flags&57344){n.msg="unknown header flags set",e.mode=$;break}e.head&&(e.head.text=l>>8&1),e.flags&512&&e.wrap&4&&(q[0]=l&255,q[1]=l>>>8&255,e.check=ue(e.check,q,2,0)),l=0,d=0,e.mode=En;case En:for(;d<32;){if(u===0)break e;u--,l+=r[i++]<<d,d+=8}e.head&&(e.head.time=l),e.flags&512&&e.wrap&4&&(q[0]=l&255,q[1]=l>>>8&255,q[2]=l>>>16&255,q[3]=l>>>24&255,e.check=ue(e.check,q,4,0)),l=0,d=0,e.mode=_n;case _n:for(;d<16;){if(u===0)break e;u--,l+=r[i++]<<d,d+=8}e.head&&(e.head.xflags=l&255,e.head.os=l>>8),e.flags&512&&e.wrap&4&&(q[0]=l&255,q[1]=l>>>8&255,e.check=ue(e.check,q,2,0)),l=0,d=0,e.mode=An;case An:if(e.flags&1024){for(;d<16;){if(u===0)break e;u--,l+=r[i++]<<d,d+=8}e.length=l,e.head&&(e.head.extra_len=l),e.flags&512&&e.wrap&4&&(q[0]=l&255,q[1]=l>>>8&255,e.check=ue(e.check,q,2,0)),l=0,d=0}else e.head&&(e.head.extra=null);e.mode=kn;case kn:if(e.flags&1024&&(p=e.length,p>u&&(p=u),p&&(e.head&&(O=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Uint8Array(e.head.extra_len)),e.head.extra.set(r.subarray(i,i+p),O)),e.flags&512&&e.wrap&4&&(e.check=ue(e.check,r,p,i)),u-=p,i+=p,e.length-=p),e.length))break e;e.length=0,e.mode=Sn;case Sn:if(e.flags&2048){if(u===0)break e;p=0;do O=r[i+p++],e.head&&O&&e.length<65536&&(e.head.name+=String.fromCharCode(O));while(O&&p<u);if(e.flags&512&&e.wrap&4&&(e.check=ue(e.check,r,p,i)),u-=p,i+=p,O)break e}else e.head&&(e.head.name=null);e.length=0,e.mode=xn;case xn:if(e.flags&4096){if(u===0)break e;p=0;do O=r[i+p++],e.head&&O&&e.length<65536&&(e.head.comment+=String.fromCharCode(O));while(O&&p<u);if(e.flags&512&&e.wrap&4&&(e.check=ue(e.check,r,p,i)),u-=p,i+=p,O)break e}else e.head&&(e.head.comment=null);e.mode=In;case In:if(e.flags&512){for(;d<16;){if(u===0)break e;u--,l+=r[i++]<<d,d+=8}if(e.wrap&4&&l!==(e.check&65535)){n.msg="header crc mismatch",e.mode=$;break}l=0,d=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),n.adler=e.check=0,e.mode=fe;break;case Tn:for(;d<32;){if(u===0)break e;u--,l+=r[i++]<<d,d+=8}n.adler=e.check=Fn(l),l=0,d=0,e.mode=ct;case ct:if(e.havedict===0)return n.next_out=o,n.avail_out=h,n.next_in=i,n.avail_in=u,e.hold=l,e.bits=d,fs;n.adler=e.check=1,e.mode=fe;case fe:if(t===ls||t===Je)break e;case St:if(e.last){l>>>=d&7,d-=d&7,e.mode=It;break}for(;d<3;){if(u===0)break e;u--,l+=r[i++]<<d,d+=8}switch(e.last=l&1,l>>>=1,d-=1,l&3){case 0:e.mode=Pn;break;case 1:if(bs(e),e.mode=Qe,t===Je){l>>>=2,d-=2;break e}break;case 2:e.mode=Cn;break;case 3:n.msg="invalid block type",e.mode=$}l>>>=2,d-=2;break;case Pn:for(l>>>=d&7,d-=d&7;d<32;){if(u===0)break e;u--,l+=r[i++]<<d,d+=8}if((l&65535)!==(l>>>16^65535)){n.msg="invalid stored block lengths",e.mode=$;break}if(e.length=l&65535,l=0,d=0,e.mode=xt,t===Je)break e;case xt:e.mode=Ln;case Ln:if(p=e.length,p){if(p>u&&(p=u),p>h&&(p=h),p===0)break e;s.set(r.subarray(i,i+p),o),u-=p,i+=p,h-=p,o+=p,e.length-=p;break}e.mode=fe;break;case Cn:for(;d<14;){if(u===0)break e;u--,l+=r[i++]<<d,d+=8}if(e.nlen=(l&31)+257,l>>>=5,d-=5,e.ndist=(l&31)+1,l>>>=5,d-=5,e.ncode=(l&15)+4,l>>>=4,d-=4,e.nlen>286||e.ndist>30){n.msg="too many length or distance symbols",e.mode=$;break}e.have=0,e.mode=Bn;case Bn:for(;e.have<e.ncode;){for(;d<3;){if(u===0)break e;u--,l+=r[i++]<<d,d+=8}e.lens[R[e.have++]]=l&7,l>>>=3,d-=3}for(;e.have<19;)e.lens[R[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,D={bits:e.lenbits},z=Fe(us,e.lens,0,19,e.lencode,0,e.work,D),e.lenbits=D.bits,z){n.msg="invalid code lengths set",e.mode=$;break}e.have=0,e.mode=Rn;case Rn:for(;e.have<e.nlen+e.ndist;){for(;E=e.lencode[l&(1<<e.lenbits)-1],A=E>>>24,T=E>>>16&255,k=E&65535,!(A<=d);){if(u===0)break e;u--,l+=r[i++]<<d,d+=8}if(k<16)l>>>=A,d-=A,e.lens[e.have++]=k;else{if(k===16){for(M=A+2;d<M;){if(u===0)break e;u--,l+=r[i++]<<d,d+=8}if(l>>>=A,d-=A,e.have===0){n.msg="invalid bit length repeat",e.mode=$;break}O=e.lens[e.have-1],p=3+(l&3),l>>>=2,d-=2}else if(k===17){for(M=A+3;d<M;){if(u===0)break e;u--,l+=r[i++]<<d,d+=8}l>>>=A,d-=A,O=0,p=3+(l&7),l>>>=3,d-=3}else{for(M=A+7;d<M;){if(u===0)break e;u--,l+=r[i++]<<d,d+=8}l>>>=A,d-=A,O=0,p=11+(l&127),l>>>=7,d-=7}if(e.have+p>e.nlen+e.ndist){n.msg="invalid bit length repeat",e.mode=$;break}for(;p--;)e.lens[e.have++]=O}}if(e.mode===$)break;if(e.lens[256]===0){n.msg="invalid code -- missing end-of-block",e.mode=$;break}if(e.lenbits=9,D={bits:e.lenbits},z=Fe(Sr,e.lens,0,e.nlen,e.lencode,0,e.work,D),e.lenbits=D.bits,z){n.msg="invalid literal/lengths set",e.mode=$;break}if(e.distbits=6,e.distcode=e.distdyn,D={bits:e.distbits},z=Fe(xr,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,D),e.distbits=D.bits,z){n.msg="invalid distances set",e.mode=$;break}if(e.mode=Qe,t===Je)break e;case Qe:e.mode=et;case et:if(u>=6&&h>=258){n.next_out=o,n.avail_out=h,n.next_in=i,n.avail_in=u,e.hold=l,e.bits=d,rs(n,w),o=n.next_out,s=n.output,h=n.avail_out,i=n.next_in,r=n.input,u=n.avail_in,l=e.hold,d=e.bits,e.mode===fe&&(e.back=-1);break}for(e.back=0;E=e.lencode[l&(1<<e.lenbits)-1],A=E>>>24,T=E>>>16&255,k=E&65535,!(A<=d);){if(u===0)break e;u--,l+=r[i++]<<d,d+=8}if(T&&(T&240)===0){for(S=A,B=T,G=k;E=e.lencode[G+((l&(1<<S+B)-1)>>S)],A=E>>>24,T=E>>>16&255,k=E&65535,!(S+A<=d);){if(u===0)break e;u--,l+=r[i++]<<d,d+=8}l>>>=S,d-=S,e.back+=S}if(l>>>=A,d-=A,e.back+=A,e.length=k,T===0){e.mode=Un;break}if(T&32){e.back=-1,e.mode=fe;break}if(T&64){n.msg="invalid literal/length code",e.mode=$;break}e.extra=T&15,e.mode=On;case On:if(e.extra){for(M=e.extra;d<M;){if(u===0)break e;u--,l+=r[i++]<<d,d+=8}e.length+=l&(1<<e.extra)-1,l>>>=e.extra,d-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=Mn;case Mn:for(;E=e.distcode[l&(1<<e.distbits)-1],A=E>>>24,T=E>>>16&255,k=E&65535,!(A<=d);){if(u===0)break e;u--,l+=r[i++]<<d,d+=8}if((T&240)===0){for(S=A,B=T,G=k;E=e.distcode[G+((l&(1<<S+B)-1)>>S)],A=E>>>24,T=E>>>16&255,k=E&65535,!(S+A<=d);){if(u===0)break e;u--,l+=r[i++]<<d,d+=8}l>>>=S,d-=S,e.back+=S}if(l>>>=A,d-=A,e.back+=A,T&64){n.msg="invalid distance code",e.mode=$;break}e.offset=k,e.extra=T&15,e.mode=Dn;case Dn:if(e.extra){for(M=e.extra;d<M;){if(u===0)break e;u--,l+=r[i++]<<d,d+=8}e.offset+=l&(1<<e.extra)-1,l>>>=e.extra,d-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){n.msg="invalid distance too far back",e.mode=$;break}e.mode=Nn;case Nn:if(h===0)break e;if(p=w-h,e.offset>p){if(p=e.offset-p,p>e.whave&&e.sane){n.msg="invalid distance too far back",e.mode=$;break}p>e.wnext?(p-=e.wnext,y=e.wsize-p):y=e.wnext-p,p>e.length&&(p=e.length),x=e.window}else x=s,y=o-e.offset,p=e.length;p>h&&(p=h),h-=p,e.length-=p;do s[o++]=x[y++];while(--p);e.length===0&&(e.mode=et);break;case Un:if(h===0)break e;s[o++]=e.length,h--,e.mode=et;break;case It:if(e.wrap){for(;d<32;){if(u===0)break e;u--,l|=r[i++]<<d,d+=8}if(w-=h,n.total_out+=w,e.total+=w,e.wrap&4&&w&&(n.adler=e.check=e.flags?ue(e.check,s,w,o-w):Ut(e.check,s,w,o-w)),w=h,e.wrap&4&&(e.flags?l:Fn(l))!==e.check){n.msg="incorrect data check",e.mode=$;break}l=0,d=0}e.mode=zn;case zn:if(e.wrap&&e.flags){for(;d<32;){if(u===0)break e;u--,l+=r[i++]<<d,d+=8}if(e.wrap&4&&l!==(e.total&4294967295)){n.msg="incorrect length check",e.mode=$;break}l=0,d=0}e.mode=qn;case qn:z=ds;break e;case $:z=Ir;break e;case Pr:return Tr;case Lr:default:return oe}return n.next_out=o,n.avail_out=h,n.next_in=i,n.avail_in=u,e.hold=l,e.bits=d,(e.wsize||w!==n.avail_out&&e.mode<$&&(e.mode<It||t!==yn))&&Mr(n,n.output,n.next_out,w-n.avail_out),v-=n.avail_in,w-=n.avail_out,n.total_in+=v,n.total_out+=w,e.total+=w,e.wrap&4&&w&&(n.adler=e.check=e.flags?ue(e.check,s,w,n.next_out-w):Ut(e.check,s,w,n.next_out-w)),n.data_type=e.bits+(e.last?64:0)+(e.mode===fe?128:0)+(e.mode===Qe||e.mode===xt?256:0),(v===0&&w===0||t===yn)&&z===xe&&(z=hs),z},_s=n=>{if(Te(n))return oe;let t=n.state;return t.window&&(t.window=null),n.state=null,xe},As=(n,t)=>{if(Te(n))return oe;const e=n.state;return(e.wrap&2)===0?oe:(e.head=t,t.done=!1,xe)},ks=(n,t)=>{const e=t.length;let r,s,i;return Te(n)||(r=n.state,r.wrap!==0&&r.mode!==ct)?oe:r.mode===ct&&(s=1,s=Ut(s,t,e,0),s!==r.check)?Ir:(i=Mr(n,t,e,e),i?(r.mode=Pr,Tr):(r.havedict=1,xe))};var Ss=Br,xs=Rr,Is=Cr,Ts=vs,Ps=Or,Ls=Es,Cs=_s,Bs=As,Rs=ks,Os="pako inflate (from Nodeca project)",he={inflateReset:Ss,inflateReset2:xs,inflateResetKeep:Is,inflateInit:Ts,inflateInit2:Ps,inflate:Ls,inflateEnd:Cs,inflateGetHeader:Bs,inflateSetDictionary:Rs,inflateInfo:Os};function Ms(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var Ds=Ms;const Dr=Object.prototype.toString,{Z_NO_FLUSH:Ns,Z_FINISH:Us,Z_OK:Ge,Z_STREAM_END:Lt,Z_NEED_DICT:Ct,Z_STREAM_ERROR:zs,Z_DATA_ERROR:jn,Z_MEM_ERROR:qs}=_r;function yt(n){this.options=Ar.assign({chunkSize:1024*64,windowBits:15,to:""},n||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&!(n&&n.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(t.windowBits&15)===0&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ts,this.strm.avail_out=0;let e=he.inflateInit2(this.strm,t.windowBits);if(e!==Ge)throw new Error(zt[e]);if(this.header=new Ds,he.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=qt.string2buf(t.dictionary):Dr.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(e=he.inflateSetDictionary(this.strm,t.dictionary),e!==Ge)))throw new Error(zt[e])}yt.prototype.push=function(n,t){const e=this.strm,r=this.options.chunkSize,s=this.options.dictionary;let i,o,u;if(this.ended)return!1;for(t===~~t?o=t:o=t===!0?Us:Ns,Dr.call(n)==="[object ArrayBuffer]"?e.input=new Uint8Array(n):e.input=n,e.next_in=0,e.avail_in=e.input.length;;){for(e.avail_out===0&&(e.output=new Uint8Array(r),e.next_out=0,e.avail_out=r),i=he.inflate(e,o),i===Ct&&s&&(i=he.inflateSetDictionary(e,s),i===Ge?i=he.inflate(e,o):i===jn&&(i=Ct));e.avail_in>0&&i===Lt&&e.state.wrap>0&&n[e.next_in]!==0;)he.inflateReset(e),i=he.inflate(e,o);switch(i){case zs:case jn:case Ct:case qs:return this.onEnd(i),this.ended=!0,!1}if(u=e.avail_out,e.next_out&&(e.avail_out===0||i===Lt))if(this.options.to==="string"){let h=qt.utf8border(e.output,e.next_out),l=e.next_out-h,d=qt.buf2string(e.output,h);e.next_out=l,e.avail_out=r-l,l&&e.output.set(e.output.subarray(h,h+l),0),this.onData(d)}else this.onData(e.output.length===e.next_out?e.output:e.output.subarray(0,e.next_out));if(!(i===Ge&&u===0)){if(i===Lt)return i=he.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,!0;if(e.avail_in===0)break}}return!0};yt.prototype.onData=function(n){this.chunks.push(n)};yt.prototype.onEnd=function(n){n===Ge&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Ar.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};function Fs(n,t){const e=new yt(t);if(e.push(n),e.err)throw e.msg||zt[e.err];return e.result}var Vs=Fs,js={inflate:Vs};const{inflate:Gs}=js;var Ks=Gs,Bt={exports:{}},Gn;function Ws(){return Gn||(Gn=1,(function(n){var t=Object.prototype.hasOwnProperty,e="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(e=!1));function s(h,l,d){this.fn=h,this.context=l,this.once=d||!1}function i(h,l,d,v,w){if(typeof d!="function")throw new TypeError("The listener must be a function");var p=new s(d,v||h,w),y=e?e+l:l;return h._events[y]?h._events[y].fn?h._events[y]=[h._events[y],p]:h._events[y].push(p):(h._events[y]=p,h._eventsCount++),h}function o(h,l){--h._eventsCount===0?h._events=new r:delete h._events[l]}function u(){this._events=new r,this._eventsCount=0}u.prototype.eventNames=function(){var l=[],d,v;if(this._eventsCount===0)return l;for(v in d=this._events)t.call(d,v)&&l.push(e?v.slice(1):v);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(d)):l},u.prototype.listeners=function(l){var d=e?e+l:l,v=this._events[d];if(!v)return[];if(v.fn)return[v.fn];for(var w=0,p=v.length,y=new Array(p);w<p;w++)y[w]=v[w].fn;return y},u.prototype.listenerCount=function(l){var d=e?e+l:l,v=this._events[d];return v?v.fn?1:v.length:0},u.prototype.emit=function(l,d,v,w,p,y){var x=e?e+l:l;if(!this._events[x])return!1;var E=this._events[x],A=arguments.length,T,k;if(E.fn){switch(E.once&&this.removeListener(l,E.fn,void 0,!0),A){case 1:return E.fn.call(E.context),!0;case 2:return E.fn.call(E.context,d),!0;case 3:return E.fn.call(E.context,d,v),!0;case 4:return E.fn.call(E.context,d,v,w),!0;case 5:return E.fn.call(E.context,d,v,w,p),!0;case 6:return E.fn.call(E.context,d,v,w,p,y),!0}for(k=1,T=new Array(A-1);k<A;k++)T[k-1]=arguments[k];E.fn.apply(E.context,T)}else{var S=E.length,B;for(k=0;k<S;k++)switch(E[k].once&&this.removeListener(l,E[k].fn,void 0,!0),A){case 1:E[k].fn.call(E[k].context);break;case 2:E[k].fn.call(E[k].context,d);break;case 3:E[k].fn.call(E[k].context,d,v);break;case 4:E[k].fn.call(E[k].context,d,v,w);break;default:if(!T)for(B=1,T=new Array(A-1);B<A;B++)T[B-1]=arguments[B];E[k].fn.apply(E[k].context,T)}}return!0},u.prototype.on=function(l,d,v){return i(this,l,d,v,!1)},u.prototype.once=function(l,d,v){return i(this,l,d,v,!0)},u.prototype.removeListener=function(l,d,v,w){var p=e?e+l:l;if(!this._events[p])return this;if(!d)return o(this,p),this;var y=this._events[p];if(y.fn)y.fn===d&&(!w||y.once)&&(!v||y.context===v)&&o(this,p);else{for(var x=0,E=[],A=y.length;x<A;x++)(y[x].fn!==d||w&&!y[x].once||v&&y[x].context!==v)&&E.push(y[x]);E.length?this._events[p]=E.length===1?E[0]:E:o(this,p)}return this},u.prototype.removeAllListeners=function(l){var d;return l?(d=e?e+l:l,this._events[d]&&o(this,d)):(this._events=new r,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=e,u.EventEmitter=u,n.exports=u})(Bt)),Bt.exports}var $s=Ws();const Hs=ur($s);function Zs(n,t){return Array.apply(0,new Array(Math.ceil(n.length/t))).map((e,r)=>n.slice(r*t,(r+1)*t))}const Ne=n=>"version"in n;function Xs(n){return new TextDecoder("utf-8").decode(n)}function Ys(n){return new TextEncoder().encode(n)}function Kn(n){return ze.encode(n)}function Wn(n){return n.toString("base64")}function Nr(n){return ce.from(n,"base64")}function Js(n){const t=new Map;return n.errors&&n.errors.forEach(e=>{var r;let s=(r=e.msg)!==null&&r!==void 0?r:e.name;t.set(e.code,s)}),t}function Qs(n,...t){if(n.args.length!=t.length)throw new Error("Invalid argument length");const e={};let r=0;return n.args.forEach(s=>{e[s.name]=t[r],r+=1}),e}function Ur(n,t={}){n.forEach(e=>{if("accounts"in e)Ur(e.accounts,t[e.name]);else if(t[e.name]===void 0)throw new Error(`Invalid arguments: ${e.name} not provided.`)})}function se(n){return n instanceof U?n:new U(n)}class eo extends TypeError{constructor(t,e){let r;const{message:s,...i}=t,{path:o}=t,u=o.length===0?s:"At path: "+o.join(".")+" -- "+s;super(u),this.value=void 0,this.key=void 0,this.type=void 0,this.refinement=void 0,this.path=void 0,this.branch=void 0,this.failures=void 0,Object.assign(this,i),this.name=this.constructor.name,this.failures=()=>{var h;return(h=r)!=null?h:r=[t,...e()]}}}function to(n){return Ce(n)&&typeof n[Symbol.iterator]=="function"}function Ce(n){return typeof n=="object"&&n!=null}function be(n){return typeof n=="string"?JSON.stringify(n):""+n}function no(n){const{done:t,value:e}=n.next();return t?void 0:e}function ro(n,t,e,r){if(n===!0)return;n===!1?n={}:typeof n=="string"&&(n={message:n});const{path:s,branch:i}=t,{type:o}=e,{refinement:u,message:h="Expected a value of type `"+o+"`"+(u?" with refinement `"+u+"`":"")+", but received: `"+be(r)+"`"}=n;return{value:r,type:o,refinement:u,key:s[s.length-1],path:s,branch:i,...n,message:h}}function*$n(n,t,e,r){to(n)||(n=[n]);for(const s of n){const i=ro(s,t,e,r);i&&(yield i)}}function*Xt(n,t,e){e===void 0&&(e={});const{path:r=[],branch:s=[n],coerce:i=!1,mask:o=!1}=e,u={path:r,branch:s};if(i&&(n=t.coercer(n,u),o&&t.type!=="type"&&Ce(t.schema)&&Ce(n)&&!Array.isArray(n)))for(const l in n)t.schema[l]===void 0&&delete n[l];let h=!0;for(const l of t.validator(n,u))h=!1,yield[l,void 0];for(let[l,d,v]of t.entries(n,u)){const w=Xt(d,v,{path:l===void 0?r:[...r,l],branch:l===void 0?s:[...s,d],coerce:i,mask:o});for(const p of w)p[0]?(h=!1,yield[p[0],void 0]):i&&(d=p[1],l===void 0?n=d:n instanceof Map?n.set(l,d):n instanceof Set?n.add(d):Ce(n)&&(n[l]=d))}if(h)for(const l of t.refiner(n,u))h=!1,yield[l,void 0];h&&(yield[void 0,n])}class Ee{constructor(t){this.TYPE=void 0,this.type=void 0,this.schema=void 0,this.coercer=void 0,this.validator=void 0,this.refiner=void 0,this.entries=void 0;const{type:e,schema:r,validator:s,refiner:i,coercer:o=h=>h,entries:u=function*(){}}=t;this.type=e,this.schema=r,this.entries=u,this.coercer=o,s?this.validator=(h,l)=>{const d=s(h,l);return $n(d,l,this,h)}:this.validator=()=>[],i?this.refiner=(h,l)=>{const d=i(h,l);return $n(d,l,this,h)}:this.refiner=()=>[]}assert(t){return io(t,this)}create(t){return Yt(t,this)}is(t){return zr(t,this)}mask(t){return so(t,this)}validate(t,e){return e===void 0&&(e={}),We(t,this,e)}}function io(n,t){const e=We(n,t);if(e[0])throw e[0]}function Yt(n,t){const e=We(n,t,{coerce:!0});if(e[0])throw e[0];return e[1]}function so(n,t){const e=We(n,t,{coerce:!0,mask:!0});if(e[0])throw e[0];return e[1]}function zr(n,t){return!We(n,t)[0]}function We(n,t,e){e===void 0&&(e={});const r=Xt(n,t,e),s=no(r);return s[0]?[new eo(s[0],function*(){for(const o of r)o[0]&&(yield o[0])}),void 0]:[void 0,s[1]]}function $e(n,t){return new Ee({type:n,schema:null,validator:t})}function oo(){return $e("any",()=>!0)}function Rt(n){return new Ee({type:"array",schema:n,*entries(t){if(n&&Array.isArray(t))for(const[e,r]of t.entries())yield[e,r,n]},coercer(t){return Array.isArray(t)?t.slice():t},validator(t){return Array.isArray(t)||"Expected an array value, but received: "+be(t)}})}function ao(){return $e("boolean",n=>typeof n=="boolean")}function Hn(n){const t=be(n);return new Ee({type:"literal",schema:n,validator(e){return e===n||"Expected the literal `"+t+"`, but received: "+be(e)}})}function tt(n){return new Ee({...n,validator:(t,e)=>t===null||n.validator(t,e),refiner:(t,e)=>t===null||n.refiner(t,e)})}function it(){return $e("number",n=>typeof n=="number"&&!isNaN(n)||"Expected a number, but received: "+be(n))}function st(n){return new Ee({...n,validator:(t,e)=>t===void 0||n.validator(t,e),refiner:(t,e)=>t===void 0||n.refiner(t,e)})}function Ae(){return $e("string",n=>typeof n=="string"||"Expected a string, but received: "+be(n))}function ye(n){const t=Object.keys(n);return new Ee({type:"type",schema:n,*entries(e){if(Ce(e))for(const r of t)yield[r,e[r],n[r]]},validator(e){return Ce(e)||"Expected an object, but received: "+be(e)}})}function qr(n){const t=n.map(e=>e.type).join(" | ");return new Ee({type:"union",schema:null,coercer(e,r){return(n.find(i=>{const[o]=i.validate(e,{coerce:!0});return!o})||Jt()).coercer(e,r)},validator(e,r){const s=[];for(const i of n){const[...o]=Xt(e,i,r),[u]=o;if(u[0])for(const[h]of o)h&&s.push(h);else return[]}return["Expected the value to satisfy a union of `"+t+"`, but received: "+be(e),...s]}})}function Jt(){return $e("unknown",()=>!0)}function co(n,t,e){return new Ee({...n,coercer:(r,s)=>zr(r,t)?n.coercer(e(r,s),s):n.coercer(r,s)})}const Zn=99;async function uo(n,t,e){if(t.length<=Zn)return await Xn(n,t,e);{const r=Zs(t,Zn);return(await Promise.all(r.map(i=>Xn(n,i,e)))).flat()}}async function Xn(n,t,e){const r=e??n.commitment,{value:s,context:i}=await n.getMultipleAccountsInfoAndContext(t,r);return s.map((u,h)=>u===null?null:{publicKey:t[h],account:u,context:i})}async function lo(n,t,e,r,s){var i;e&&e.length>0&&t.sign(...e);const o=t._compile(),u=o.serialize(),l=t._serialize(u).toString("base64"),d={encoding:"base64",commitment:r??n.commitment};if(s){const y=(Array.isArray(s)?s:o.nonProgramIds()).map(x=>x.toBase58());d.accounts={encoding:"base64",addresses:y}}e&&(d.sigVerify=!0);const v=[l,d],w=await n._rpcRequest("simulateTransaction",v),p=Yt(w,mo);if("error"in p){let y;if("data"in p.error&&(y=(i=p.error.data)===null||i===void 0?void 0:i.logs,y&&Array.isArray(y))){const x=`
    `,E=x+y.join(x);console.error(p.error.message,E)}throw new Dt("failed to simulate transaction: "+p.error.message,y)}return p.result}function fo(n){return co(Fr(n),ho,t=>"error"in t?t:{...t,result:Yt(t.result,n)})}const ho=Fr(Jt());function Fr(n){return qr([ye({jsonrpc:Hn("2.0"),id:Ae(),result:n}),ye({jsonrpc:Hn("2.0"),id:Ae(),error:ye({code:Jt(),message:Ae(),data:st(oo())})})])}function po(n){return fo(ye({context:ye({slot:it()}),value:n}))}const mo=po(ye({err:tt(qr([ye({}),Ae()])),logs:tt(Rt(Ae())),accounts:st(tt(Rt(tt(ye({executable:ao(),owner:Ae(),lamports:it(),data:Rt(Ae()),rentEpoch:st(it())}))))),unitsConsumed:st(it())}));class Qt{constructor(t,e,r){this.connection=t,this.wallet=e,this.opts=r,this.publicKey=e?.publicKey}static defaultOptions(){return{preflightCommitment:"processed",commitment:"processed"}}static local(t,e){throw new Error("Provider local is not available on browser.")}static env(){throw new Error("Provider env is not available on browser.")}async sendAndConfirm(t,e,r){var s,i,o,u;if(r===void 0&&(r=this.opts),Ne(t))e&&t.sign(e);else if(t.feePayer=(s=t.feePayer)!==null&&s!==void 0?s:this.wallet.publicKey,t.recentBlockhash=(await this.connection.getLatestBlockhash(r.preflightCommitment)).blockhash,e)for(const l of e)t.partialSign(l);t=await this.wallet.signTransaction(t);const h=t.serialize();try{return await Yn(this.connection,h,r)}catch(l){if(l instanceof Ft){const d=Kn(Ne(t)?((i=t.signatures)===null||i===void 0?void 0:i[0])||new Uint8Array:(o=t.signature)!==null&&o!==void 0?o:new Uint8Array),v=await this.connection.getTransaction(d,{commitment:"confirmed"});if(v){const w=(u=v.meta)===null||u===void 0?void 0:u.logMessages;throw w?new Dt(l.message,w):l}else throw l}else throw l}}async sendAll(t,e){var r,s,i;e===void 0&&(e=this.opts);const o=(await this.connection.getLatestBlockhash(e.preflightCommitment)).blockhash;let u=t.map(d=>{var v,w;if(Ne(d.tx)){let p=d.tx;return d.signers&&p.sign(d.signers),p}else{let p=d.tx,y=(v=d.signers)!==null&&v!==void 0?v:[];return p.feePayer=(w=p.feePayer)!==null&&w!==void 0?w:this.wallet.publicKey,p.recentBlockhash=o,y.forEach(x=>{p.partialSign(x)}),p}});const h=await this.wallet.signAllTransactions(u),l=[];for(let d=0;d<u.length;d+=1){const v=h[d],w=v.serialize();try{l.push(await Yn(this.connection,w,e))}catch(p){if(p instanceof Ft){const y=Kn(Ne(v)?((r=v.signatures)===null||r===void 0?void 0:r[0])||new Uint8Array:(s=v.signature)!==null&&s!==void 0?s:new Uint8Array),x=await this.connection.getTransaction(y,{commitment:"confirmed"});if(x){const E=(i=x.meta)===null||i===void 0?void 0:i.logMessages;throw E?new Dt(p.message,E):p}else throw p}else throw p}}return l}async simulate(t,e,r,s){let i=(await this.connection.getLatestBlockhash(r??this.connection.commitment)).blockhash,o;if(Ne(t)?(e&&(t.sign(e),t=await this.wallet.signTransaction(t)),o=await this.connection.simulateTransaction(t,{commitment:r})):(t.feePayer=t.feePayer||this.wallet.publicKey,t.recentBlockhash=i,e&&(t=await this.wallet.signTransaction(t)),o=await lo(this.connection,t,e,r,s)),o.value.err)throw new wo(o.value);return o.value}}class wo extends Error{constructor(t,e){super(e),this.simulationResponse=t}}async function Yn(n,t,e){const r=e&&{skipPreflight:e.skipPreflight,preflightCommitment:e.preflightCommitment||e.commitment},s=await n.sendRawTransaction(t,r),i=(await n.confirmTransaction(s,e&&e.commitment)).value;if(i.err)throw new Ft(`Raw transaction ${s} failed (${JSON.stringify(i)})`);return s}class Ft extends Error{constructor(t){super(t)}}function Vt(){return Qt.local()}const go=new Map;function Vr(n){return go.get(n)!==void 0}class ut extends Error{constructor(t){super(t),this.name="IdlError"}}class He{constructor(t){this.stack=t}static parse(t){var e;const r=/^Program (\w*) invoke/,s=/^Program \w* success/,i=[];for(let o=0;o<t.length;o++){if(s.exec(t[o])){i.pop();continue}const u=(e=r.exec(t[o]))===null||e===void 0?void 0:e[1];u&&i.push(new U(u))}return new He(i)}}class Ve extends Error{constructor(t,e,r,s,i,o){super(r.join(`
`).replace("Program log: ","")),this.errorLogs=r,this.logs=s,this.error={errorCode:t,errorMessage:e,comparedValues:o,origin:i},this._programErrorStack=He.parse(s)}static parse(t){if(!t)return null;const e=t.findIndex(w=>w.startsWith("Program log: AnchorError"));if(e===-1)return null;const r=t[e],s=[r];let i;if(e+1<t.length){if(t[e+1]==="Program log: Left:"){const w=/^Program log: (.*)$/,p=w.exec(t[e+2])[1],y=w.exec(t[e+4])[1];i=[new U(p),new U(y)],s.push(...t.slice(e+1,e+5))}else if(t[e+1].startsWith("Program log: Left:")){const w=/^Program log: (Left|Right): (.*)$/,p=w.exec(t[e+1])[2],y=w.exec(t[e+2])[2];s.push(...t.slice(e+1,e+3)),i=[p,y]}}const u=/^Program log: AnchorError occurred\. Error Code: (.*)\. Error Number: (\d*)\. Error Message: (.*)\./.exec(r),l=/^Program log: AnchorError thrown in (.*):(\d*)\. Error Code: (.*)\. Error Number: (\d*)\. Error Message: (.*)\./.exec(r),v=/^Program log: AnchorError caused by account: (.*)\. Error Code: (.*)\. Error Number: (\d*)\. Error Message: (.*)\./.exec(r);if(u){const[w,p,y]=u.slice(1,4),x={code:w,number:parseInt(p)};return new Ve(x,y,s,t,void 0,i)}else if(l){const[w,p,y,x,E]=l.slice(1,6),A={code:y,number:parseInt(x)},T={file:w,line:parseInt(p)};return new Ve(A,E,s,t,T,i)}else if(v){const[w,p,y,x]=v.slice(1,5),E=w,A={code:p,number:parseInt(y)};return new Ve(A,x,s,t,E,i)}else return null}get program(){return this._programErrorStack.stack[this._programErrorStack.stack.length-1]}get programErrorStack(){return this._programErrorStack.stack}toString(){return this.message}}class lt extends Error{constructor(t,e,r){super(),this.code=t,this.msg=e,this.logs=r,r&&(this._programErrorStack=He.parse(r))}static parse(t,e){const r=t.toString();let s;if(r.includes("custom program error:")){let u=r.split("custom program error: ");if(u.length!==2)return null;s=u[1]}else{const u=r.match(/"Custom":([0-9]+)}/g);if(!u||u.length>1)return null;s=u[0].match(/([0-9]+)/g)[0]}let i;try{i=parseInt(s)}catch{return null}let o=e.get(i);return o!==void 0?new lt(i,o,t.logs):(o=yo.get(i),o!==void 0?new lt(i,o,t.logs):null)}get program(){var t;return(t=this._programErrorStack)===null||t===void 0?void 0:t.stack[this._programErrorStack.stack.length-1]}get programErrorStack(){var t;return(t=this._programErrorStack)===null||t===void 0?void 0:t.stack}toString(){return this.msg}}function jr(n,t){Vr("debug-logs")&&console.log("Translating error:",n);const e=Ve.parse(n.logs);if(e)return e;const r=lt.parse(n,t);if(r)return r;if(n.logs){const s={get:function(i,o){return o==="programErrorStack"?i.programErrorStack.stack:o==="program"?i.programErrorStack.stack[n.programErrorStack.stack.length-1]:Reflect.get(...arguments)}};return n.programErrorStack=He.parse(n.logs),new Proxy(n,s)}return n}const N={InstructionMissing:100,InstructionFallbackNotFound:101,InstructionDidNotDeserialize:102,InstructionDidNotSerialize:103,IdlInstructionStub:1e3,IdlInstructionInvalidProgram:1001,ConstraintMut:2e3,ConstraintHasOne:2001,ConstraintSigner:2002,ConstraintRaw:2003,ConstraintOwner:2004,ConstraintRentExempt:2005,ConstraintSeeds:2006,ConstraintExecutable:2007,ConstraintState:2008,ConstraintAssociated:2009,ConstraintAssociatedInit:2010,ConstraintClose:2011,ConstraintAddress:2012,ConstraintZero:2013,ConstraintTokenMint:2014,ConstraintTokenOwner:2015,ConstraintMintMintAuthority:2016,ConstraintMintFreezeAuthority:2017,ConstraintMintDecimals:2018,ConstraintSpace:2019,ConstraintAccountIsNone:2020,RequireViolated:2500,RequireEqViolated:2501,RequireKeysEqViolated:2502,RequireNeqViolated:2503,RequireKeysNeqViolated:2504,RequireGtViolated:2505,RequireGteViolated:2506,AccountDiscriminatorAlreadySet:3e3,AccountDiscriminatorNotFound:3001,AccountDiscriminatorMismatch:3002,AccountDidNotDeserialize:3003,AccountDidNotSerialize:3004,AccountNotEnoughKeys:3005,AccountNotMutable:3006,AccountOwnedByWrongProgram:3007,InvalidProgramId:3008,InvalidProgramExecutable:3009,AccountNotSigner:3010,AccountNotSystemOwned:3011,AccountNotInitialized:3012,AccountNotProgramData:3013,AccountNotAssociatedTokenAccount:3014,AccountSysvarMismatch:3015,AccountReallocExceedsLimit:3016,AccountDuplicateReallocs:3017,DeclaredProgramIdMismatch:4100,Deprecated:5e3},yo=new Map([[N.InstructionMissing,"8 byte instruction identifier not provided"],[N.InstructionFallbackNotFound,"Fallback functions are not supported"],[N.InstructionDidNotDeserialize,"The program could not deserialize the given instruction"],[N.InstructionDidNotSerialize,"The program could not serialize the given instruction"],[N.IdlInstructionStub,"The program was compiled without idl instructions"],[N.IdlInstructionInvalidProgram,"The transaction was given an invalid program for the IDL instruction"],[N.ConstraintMut,"A mut constraint was violated"],[N.ConstraintHasOne,"A has one constraint was violated"],[N.ConstraintSigner,"A signer constraint was violated"],[N.ConstraintRaw,"A raw constraint was violated"],[N.ConstraintOwner,"An owner constraint was violated"],[N.ConstraintRentExempt,"A rent exemption constraint was violated"],[N.ConstraintSeeds,"A seeds constraint was violated"],[N.ConstraintExecutable,"An executable constraint was violated"],[N.ConstraintState,"Deprecated Error, feel free to replace with something else"],[N.ConstraintAssociated,"An associated constraint was violated"],[N.ConstraintAssociatedInit,"An associated init constraint was violated"],[N.ConstraintClose,"A close constraint was violated"],[N.ConstraintAddress,"An address constraint was violated"],[N.ConstraintZero,"Expected zero account discriminant"],[N.ConstraintTokenMint,"A token mint constraint was violated"],[N.ConstraintTokenOwner,"A token owner constraint was violated"],[N.ConstraintMintMintAuthority,"A mint mint authority constraint was violated"],[N.ConstraintMintFreezeAuthority,"A mint freeze authority constraint was violated"],[N.ConstraintMintDecimals,"A mint decimals constraint was violated"],[N.ConstraintSpace,"A space constraint was violated"],[N.ConstraintAccountIsNone,"A required account for the constraint is None"],[N.RequireViolated,"A require expression was violated"],[N.RequireEqViolated,"A require_eq expression was violated"],[N.RequireKeysEqViolated,"A require_keys_eq expression was violated"],[N.RequireNeqViolated,"A require_neq expression was violated"],[N.RequireKeysNeqViolated,"A require_keys_neq expression was violated"],[N.RequireGtViolated,"A require_gt expression was violated"],[N.RequireGteViolated,"A require_gte expression was violated"],[N.AccountDiscriminatorAlreadySet,"The account discriminator was already set on this account"],[N.AccountDiscriminatorNotFound,"No 8 byte discriminator was found on the account"],[N.AccountDiscriminatorMismatch,"8 byte discriminator did not match what was expected"],[N.AccountDidNotDeserialize,"Failed to deserialize the account"],[N.AccountDidNotSerialize,"Failed to serialize the account"],[N.AccountNotEnoughKeys,"Not enough account keys given to the instruction"],[N.AccountNotMutable,"The given account is not mutable"],[N.AccountOwnedByWrongProgram,"The given account is owned by a different program than expected"],[N.InvalidProgramId,"Program ID was not as expected"],[N.InvalidProgramExecutable,"Program account is not executable"],[N.AccountNotSigner,"The given account did not sign"],[N.AccountNotSystemOwned,"The given account is not owned by the system program"],[N.AccountNotInitialized,"The program expected this account to be already initialized"],[N.AccountNotProgramData,"The given account is not a program data account"],[N.AccountNotAssociatedTokenAccount,"The given account is not the associated token account"],[N.AccountSysvarMismatch,"The given public key does not match the required sysvar"],[N.AccountReallocExceedsLimit,"The account reallocation exceeds the MAX_PERMITTED_DATA_INCREASE limit"],[N.AccountDuplicateReallocs,"The account was duplicated for more than one reallocation"],[N.DeclaredProgramIdMismatch,"The declared program id does not match the actual program id"],[N.Deprecated,"The API being used is deprecated and should no longer be used"]]);var jt=function(){return jt=Object.assign||function(t){for(var e,r=1,s=arguments.length;r<s;r++){e=arguments[r];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},jt.apply(this,arguments)},Gt=function(){return Gt=Object.assign||function(t){for(var e,r=1,s=arguments.length;r<s;r++){e=arguments[r];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},Gt.apply(this,arguments)};function vo(n){return n.toLowerCase()}var bo=[/([a-z0-9])([A-Z])/g,/([A-Z])([A-Z][a-z])/g],Eo=/[^A-Z0-9]+/gi;function _o(n,t){t===void 0&&(t={});for(var e=t.splitRegexp,r=e===void 0?bo:e,s=t.stripRegexp,i=s===void 0?Eo:s,o=t.transform,u=o===void 0?vo:o,h=t.delimiter,l=h===void 0?" ":h,d=Jn(Jn(n,r,"$1\0$2"),i,"\0"),v=0,w=d.length;d.charAt(v)==="\0";)v++;for(;d.charAt(w-1)==="\0";)w--;return d.slice(v,w).split("\0").map(u).join(l)}function Jn(n,t,e){return t instanceof RegExp?n.replace(t,e):t.reduce(function(r,s){return r.replace(s,e)},n)}function Ao(n,t){return t===void 0&&(t={}),_o(n,Gt({delimiter:"."},t))}function ko(n,t){return t===void 0&&(t={}),Ao(n,jt({delimiter:"_"},t))}class te{static fieldLayout(t,e){const r=t.name!==void 0?H(t.name):void 0;switch(t.type){case"bool":return F.bool(r);case"u8":return F.u8(r);case"i8":return F.i8(r);case"u16":return F.u16(r);case"i16":return F.i16(r);case"u32":return F.u32(r);case"i32":return F.i32(r);case"f32":return F.f32(r);case"u64":return F.u64(r);case"i64":return F.i64(r);case"f64":return F.f64(r);case"u128":return F.u128(r);case"i128":return F.i128(r);case"u256":return F.u256(r);case"i256":return F.i256(r);case"bytes":return F.vecU8(r);case"string":return F.str(r);case"publicKey":return F.publicKey(r);default:{if("vec"in t.type)return F.vec(te.fieldLayout({name:void 0,type:t.type.vec},e),r);if("option"in t.type)return F.option(te.fieldLayout({name:void 0,type:t.type.option},e),r);if("defined"in t.type){if(!e)throw new ut("User defined types not provided");const s=t.type.defined,i=e.filter(o=>o.name===s);if(i.length!==1)throw new ut(`Type not found: ${JSON.stringify(t)}`);return te.typeDefLayout(i[0],e,r)}else if("array"in t.type){let s=t.type.array[0],i=t.type.array[1],o=te.fieldLayout({name:void 0,type:s},e);return F.array(o,i,r)}else throw new Error(`Not yet implemented: ${t}`)}}}static typeDefLayout(t,e=[],r){switch(t.type.kind){case"struct":{const s=t.type.fields.map(i=>te.fieldLayout(i,e));return F.struct(s,r)}case"enum":{let s=t.type.variants.map(i=>{const o=H(i.name);if(!i.fields)return F.struct([],o);const u=i.fields.map((h,l)=>h?.name?te.fieldLayout(h,e):te.fieldLayout({type:h,name:l.toString()},e));return F.struct(u,o)});return r!==void 0?F.rustEnum(s).replicate(r):F.rustEnum(s,r)}case"alias":return te.fieldLayout({type:t.type.value,name:t.name},e)}}}const Qn="global";class en{constructor(t){this.idl=t,this.ixLayout=en.parseIxLayout(t);const e=new Map;t.instructions.forEach(r=>{const s=er(Qn,r.name);e.set(ze.encode(s),{layout:this.ixLayout.get(r.name),name:r.name})}),this.sighashLayouts=e}encode(t,e){return this._encode(Qn,t,e)}_encode(t,e,r){const s=ce.alloc(1e3),i=H(e),o=this.ixLayout.get(i);if(!o)throw new Error(`Unknown method: ${i}`);const u=o.encode(r,s),h=s.slice(0,u);return ce.concat([er(t,e),h])}static parseIxLayout(t){const e=t.instructions.map(r=>{let s=r.args.map(o=>{var u,h;return te.fieldLayout(o,Array.from([...(u=t.accounts)!==null&&u!==void 0?u:[],...(h=t.types)!==null&&h!==void 0?h:[]]))});const i=H(r.name);return[i,F.struct(s,i)]});return new Map(e)}decode(t,e="hex"){typeof t=="string"&&(t=e==="hex"?ce.from(t,"hex"):ze.decode(t));let r=ze.encode(t.slice(0,8)),s=t.slice(8);const i=this.sighashLayouts.get(r);return i?{data:i.layout.decode(s),name:i.name}:null}format(t,e){return le.format(t,e,this.idl)}}class le{static format(t,e,r){const s=r.instructions.filter(h=>t.name===h.name)[0];if(s===void 0)return console.error("Invalid instruction given"),null;const i=s.args.map(h=>({name:h.name,type:le.formatIdlType(h.type),data:le.formatIdlData(h,t.data[h.name],r.types)})),o=le.flattenIdlAccounts(s.accounts),u=e.map((h,l)=>l<o.length?{name:o[l].name,...h}:{name:void 0,...h});return{args:i,accounts:u}}static formatIdlType(t){if(typeof t=="string")return t;if("vec"in t)return`Vec<${this.formatIdlType(t.vec)}>`;if("option"in t)return`Option<${this.formatIdlType(t.option)}>`;if("defined"in t)return t.defined;if("array"in t)return`Array<${t.array[0]}; ${t.array[1]}>`;throw new Error(`Unknown IDL type: ${t}`)}static formatIdlData(t,e,r){if(typeof t.type=="string")return e.toString();if(t.type.hasOwnProperty("vec"))return"["+e.map(s=>this.formatIdlData({name:"",type:t.type.vec},s)).join(", ")+"]";if(t.type.hasOwnProperty("option"))return e===null?"null":this.formatIdlData({name:"",type:t.type.option},e,r);if(t.type.hasOwnProperty("defined")){if(r===void 0)throw new Error("User defined types not provided");const s=r.filter(i=>i.name===t.type.defined);if(s.length!==1)throw new Error(`Type not found: ${t.type.defined}`);return le.formatIdlDataDefined(s[0],e,r)}return"unknown"}static formatIdlDataDefined(t,e,r){switch(t.type.kind){case"struct":{const s=t.type;return"{ "+Object.keys(e).map(o=>{const u=s.fields.find(h=>h.name===o);if(!u)throw new Error("Unable to find type");return o+": "+le.formatIdlData(u,e[o],r)}).join(", ")+" }"}case"enum":{if(t.type.variants.length===0)return"{}";if(t.type.variants[0].name){const s=t.type.variants,i=Object.keys(e)[0],o=e[i],u=Object.keys(o).map(l=>{var d;const v=o[l],w=(d=s[i])===null||d===void 0?void 0:d.find(p=>p.name===l);if(!w)throw new Error("Unable to find variant");return l+": "+le.formatIdlData(w,v,r)}).join(", "),h=H(i,{pascalCase:!0});return u.length===0?h:`${h} { ${u} }`}else return"Tuple formatting not yet implemented"}case"alias":return le.formatIdlType(t.type.value)}}static flattenIdlAccounts(t,e){return t.map(r=>{const s=So(r.name);if(r.hasOwnProperty("accounts")){const i=e?`${e} > ${s}`:s;return le.flattenIdlAccounts(r.accounts,i)}else return{...r,name:e?`${e} > ${s}`:s}}).flat()}}function So(n){const t=n.replace(/([A-Z])/g," $1");return t.charAt(0).toUpperCase()+t.slice(1)}function er(n,t){let e=ko(t),r=`${n}:${e}`;return ce.from(lr(r).slice(0,8))}function Gr(n,t){switch(t.type.kind){case"struct":return t.type.fields.map(e=>ke(n,e.type)).reduce((e,r)=>e+r,0);case"enum":{const e=t.type.variants.map(r=>r.fields?r.fields.map(s=>typeof s=="object"&&"name"in s?ke(n,s.type):ke(n,s)).reduce((s,i)=>s+i,0):0);return Math.max(...e)+1}case"alias":return ke(n,t.type.value)}}function ke(n,t){var e,r;switch(t){case"bool":return 1;case"u8":return 1;case"i8":return 1;case"i16":return 2;case"u16":return 2;case"u32":return 4;case"i32":return 4;case"f32":return 4;case"u64":return 8;case"i64":return 8;case"f64":return 8;case"u128":return 16;case"i128":return 16;case"u256":return 32;case"i256":return 32;case"bytes":return 1;case"string":return 1;case"publicKey":return 32;default:if("vec"in t)return 1;if("option"in t)return 1+ke(n,t.option);if("coption"in t)return 4+ke(n,t.coption);if("defined"in t){const s=(r=(e=n.types)===null||e===void 0?void 0:e.filter(o=>o.name===t.defined))!==null&&r!==void 0?r:[];if(s.length!==1)throw new ut(`Type not found: ${JSON.stringify(t)}`);let i=s[0];return Gr(n,i)}if("array"in t){let s=t.array[0],i=t.array[1];return ke(n,s)*i}throw new Error(`Invalid type ${JSON.stringify(t)}`)}}const Kt=8;function Kr(n){return Buffer.from(lr(n).slice(0,Kt))}class Le{constructor(t){if(t.accounts===void 0){this.accountLayouts=new Map;return}const e=t.accounts.map(r=>[r.name,te.typeDefLayout(r,t.types)]);this.accountLayouts=new Map(e),this.idl=t}async encode(t,e){const r=ce.alloc(1e3),s=this.accountLayouts.get(t);if(!s)throw new Error(`Unknown account: ${t}`);const i=s.encode(e,r);let o=r.slice(0,i),u=Le.accountDiscriminator(t);return ce.concat([u,o])}decode(t,e){if(Le.accountDiscriminator(t).compare(e.slice(0,8)))throw new Error("Invalid account discriminator");return this.decodeUnchecked(t,e)}decodeAny(t){const e=t.slice(0,8),r=Array.from(this.accountLayouts.keys()).find(s=>Le.accountDiscriminator(s).equals(e));if(!r)throw new Error("Account descriminator not found");return this.decodeUnchecked(r,t)}decodeUnchecked(t,e){const r=e.subarray(Kt),s=this.accountLayouts.get(t);if(!s)throw new Error(`Unknown account: ${t}`);return s.decode(r)}memcmp(t,e){const r=Le.accountDiscriminator(t);return{offset:0,bytes:ze.encode(e?ce.concat([r,e]):r)}}size(t){var e;return Kt+((e=Gr(this.idl,t))!==null&&e!==void 0?e:0)}static accountDiscriminator(t){const e=`account:${H(t,{pascalCase:!0,preserveConsecutiveUppercase:!0})}`;return Kr(e)}}class xo{constructor(t){if(t.events===void 0){this.layouts=new Map;return}const e=t.events.map(r=>{let s={name:r.name,type:{kind:"struct",fields:r.fields.map(i=>({name:i.name,type:i.type}))}};return[r.name,te.typeDefLayout(s,t.types)]});this.layouts=new Map(e),this.discriminators=new Map(t.events===void 0?[]:t.events.map(r=>[Wn(Io(r.name)),r.name]))}decode(t){let e;try{e=Nr(t)}catch{return null}const r=Wn(e.slice(0,8)),s=this.discriminators.get(r);if(s===void 0)return null;const i=this.layouts.get(s);if(!i)throw new Error(`Unknown event: ${s}`);return{data:i.decode(e.slice(8)),name:s}}}function Io(n){return Kr(`event:${n}`)}class To{constructor(t){if(t.types===void 0){this.typeLayouts=new Map;return}const e=t.types.map(r=>[r.name,te.typeDefLayout(r,t.types)]);this.typeLayouts=new Map(e),this.idl=t}encode(t,e){const r=ce.alloc(1e3),s=this.typeLayouts.get(t);if(!s)throw new Error(`Unknown type: ${t}`);const i=s.encode(e,r);return r.slice(0,i)}decode(t,e){const r=this.typeLayouts.get(t);if(!r)throw new Error(`Unknown type: ${t}`);return r.decode(e)}}class Wr{constructor(t){this.instruction=new en(t),this.accounts=new Le(t),this.events=new xo(t),this.types=new To(t)}}var Po=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};class ne{constructor(t,e){if(!Number.isInteger(t))throw new TypeError("span must be an integer");this.span=t,this.property=e}makeDestinationObject(){return{}}decode(t,e){throw new Error("Layout is abstract")}encode(t,e,r){throw new Error("Layout is abstract")}getSpan(t,e){if(0>this.span)throw new RangeError("indeterminate span");return this.span}replicate(t){const e=Object.create(this.constructor.prototype);return Object.assign(e,this),e.property=t,e}fromArray(t){}}var vt=ne;function Lo(n,t){return t.property?n+"["+t.property+"]":n}class Se extends ne{isCount(){throw new Error("ExternalLayout is abstract")}}class $r extends Se{constructor(t,e,r){if(!(t instanceof ne))throw new TypeError("layout must be a Layout");if(e===void 0)e=0;else if(!Number.isInteger(e))throw new TypeError("offset must be integer or undefined");super(t.span,r||t.property),this.layout=t,this.offset=e}isCount(){return this.layout instanceof bt||this.layout instanceof Hr}decode(t,e){return e===void 0&&(e=0),this.layout.decode(t,e+this.offset)}encode(t,e,r){return r===void 0&&(r=0),this.layout.encode(t,e,r+this.offset)}}class bt extends ne{constructor(t,e){if(super(t,e),6<this.span)throw new RangeError("span must not exceed 6 bytes")}decode(t,e){return e===void 0&&(e=0),t.readUIntLE(e,this.span)}encode(t,e,r){return r===void 0&&(r=0),e.writeUIntLE(t,r,this.span),this.span}}class Hr extends ne{constructor(t,e){if(super(t,e),6<this.span)throw new RangeError("span must not exceed 6 bytes")}decode(t,e){return e===void 0&&(e=0),t.readUIntBE(e,this.span)}encode(t,e,r){return r===void 0&&(r=0),e.writeUIntBE(t,r,this.span),this.span}}const Wt=Math.pow(2,32);function Zr(n){const t=Math.floor(n/Wt),e=n-t*Wt;return{hi32:t,lo32:e}}function Xr(n,t){return n*Wt+t}class Co extends ne{constructor(t){super(8,t)}decode(t,e){e===void 0&&(e=0);const r=t.readUInt32LE(e),s=t.readUInt32LE(e+4);return Xr(s,r)}encode(t,e,r){r===void 0&&(r=0);const s=Zr(t);return e.writeUInt32LE(s.lo32,r),e.writeUInt32LE(s.hi32,r+4),8}}class Bo extends ne{constructor(t){super(8,t)}decode(t,e){e===void 0&&(e=0);const r=t.readUInt32LE(e),s=t.readInt32LE(e+4);return Xr(s,r)}encode(t,e,r){r===void 0&&(r=0);const s=Zr(t);return e.writeUInt32LE(s.lo32,r),e.writeInt32LE(s.hi32,r+4),8}}class Ro extends ne{constructor(t,e,r){if(!(Array.isArray(t)&&t.reduce((i,o)=>i&&o instanceof ne,!0)))throw new TypeError("fields must be array of Layout instances");typeof e=="boolean"&&r===void 0&&(r=e,e=void 0);for(const i of t)if(0>i.span&&i.property===void 0)throw new Error("fields cannot contain unnamed variable-length layout");let s=-1;try{s=t.reduce((i,o)=>i+o.getSpan(),0)}catch{}super(s,e),this.fields=t,this.decodePrefixes=!!r}getSpan(t,e){if(0<=this.span)return this.span;e===void 0&&(e=0);let r=0;try{r=this.fields.reduce((s,i)=>{const o=i.getSpan(t,e);return e+=o,s+o},0)}catch{throw new RangeError("indeterminate span")}return r}decode(t,e){e===void 0&&(e=0);const r=this.makeDestinationObject();for(const s of this.fields)if(s.property!==void 0&&(r[s.property]=s.decode(t,e)),e+=s.getSpan(t,e),this.decodePrefixes&&t.length===e)break;return r}encode(t,e,r){r===void 0&&(r=0);const s=r;let i=0,o=0;for(const u of this.fields){let h=u.span;if(o=0<h?h:0,u.property!==void 0){const l=t[u.property];l!==void 0&&(o=u.encode(l,e,r),0>h&&(h=u.getSpan(e,r)))}i=r,r+=h}return i+o-s}fromArray(t){const e=this.makeDestinationObject();for(const r of this.fields)r.property!==void 0&&0<t.length&&(e[r.property]=t.shift());return e}layoutFor(t){if(typeof t!="string")throw new TypeError("property must be string");for(const e of this.fields)if(e.property===t)return e}offsetOf(t){if(typeof t!="string")throw new TypeError("property must be string");let e=0;for(const r of this.fields){if(r.property===t)return e;0>r.span?e=-1:0<=e&&(e+=r.span)}}}class Yr{constructor(t){this.property=t}decode(){throw new Error("UnionDiscriminator is abstract")}encode(){throw new Error("UnionDiscriminator is abstract")}}class tr extends Yr{constructor(t,e){if(!(t instanceof Se&&t.isCount()))throw new TypeError("layout must be an unsigned integer ExternalLayout");super(e||t.property||"variant"),this.layout=t}decode(t,e){return this.layout.decode(t,e)}encode(t,e,r){return this.layout.encode(t,e,r)}}class Jr extends ne{constructor(t,e,r){const s=t instanceof bt||t instanceof Hr;if(s)t=new tr(new $r(t));else if(t instanceof Se&&t.isCount())t=new tr(t);else if(!(t instanceof Yr))throw new TypeError("discr must be a UnionDiscriminator or an unsigned integer layout");if(e===void 0&&(e=null),!(e===null||e instanceof ne))throw new TypeError("defaultLayout must be null or a Layout");if(e!==null){if(0>e.span)throw new Error("defaultLayout must have constant span");e.property===void 0&&(e=e.replicate("content"))}let i=-1;e&&(i=e.span,0<=i&&s&&(i+=t.layout.span)),super(i,r),this.discriminator=t,this.usesPrefixDiscriminator=s,this.defaultLayout=e,this.registry={};let o=this.defaultGetSourceVariant.bind(this);this.getSourceVariant=function(u){return o(u)},this.configGetSourceVariant=function(u){o=u.bind(this)}}getSpan(t,e){if(0<=this.span)return this.span;e===void 0&&(e=0);const r=this.getVariant(t,e);if(!r)throw new Error("unable to determine span for unrecognized variant");return r.getSpan(t,e)}defaultGetSourceVariant(t){if(t.hasOwnProperty(this.discriminator.property)){if(this.defaultLayout&&t.hasOwnProperty(this.defaultLayout.property))return;const e=this.registry[t[this.discriminator.property]];if(e&&(!e.layout||t.hasOwnProperty(e.property)))return e}else for(const e in this.registry){const r=this.registry[e];if(t.hasOwnProperty(r.property))return r}throw new Error("unable to infer src variant")}decode(t,e){e===void 0&&(e=0);let r;const s=this.discriminator,i=s.decode(t,e);let o=this.registry[i];if(o===void 0){let u=0;o=this.defaultLayout,this.usesPrefixDiscriminator&&(u=s.layout.span),r=this.makeDestinationObject(),r[s.property]=i,r[o.property]=this.defaultLayout.decode(t,e+u)}else r=o.decode(t,e);return r}encode(t,e,r){r===void 0&&(r=0);const s=this.getSourceVariant(t);if(s===void 0){const i=this.discriminator,o=this.defaultLayout;let u=0;return this.usesPrefixDiscriminator&&(u=i.layout.span),i.encode(t[i.property],e,r),u+o.encode(t[o.property],e,r+u)}return s.encode(t,e,r)}addVariant(t,e,r){const s=new Oo(this,t,e,r);return this.registry[t]=s,s}getVariant(t,e){let r=t;return Buffer.isBuffer(t)&&(e===void 0&&(e=0),r=this.discriminator.decode(t,e)),this.registry[r]}}class Oo extends ne{constructor(t,e,r,s){if(!(t instanceof Jr))throw new TypeError("union must be a Union");if(!Number.isInteger(e)||0>e)throw new TypeError("variant must be a (non-negative) integer");if(typeof r=="string"&&s===void 0&&(s=r,r=null),r){if(!(r instanceof ne))throw new TypeError("layout must be a Layout");if(t.defaultLayout!==null&&0<=r.span&&r.span>t.defaultLayout.span)throw new Error("variant span exceeds span of containing union");if(typeof s!="string")throw new TypeError("variant must have a String property")}let i=t.span;0>t.span&&(i=r?r.span:0,0<=i&&t.usesPrefixDiscriminator&&(i+=t.discriminator.layout.span)),super(i,s),this.union=t,this.variant=e,this.layout=r||null}getSpan(t,e){if(0<=this.span)return this.span;e===void 0&&(e=0);let r=0;return this.union.usesPrefixDiscriminator&&(r=this.union.discriminator.layout.span),r+this.layout.getSpan(t,e+r)}decode(t,e){const r=this.makeDestinationObject();if(e===void 0&&(e=0),this!==this.union.getVariant(t,e))throw new Error("variant mismatch");let s=0;return this.union.usesPrefixDiscriminator&&(s=this.union.discriminator.layout.span),this.layout?r[this.property]=this.layout.decode(t,e+s):this.property?r[this.property]=!0:this.union.usesPrefixDiscriminator&&(r[this.union.discriminator.property]=this.variant),r}encode(t,e,r){r===void 0&&(r=0);let s=0;if(this.union.usesPrefixDiscriminator&&(s=this.union.discriminator.layout.span),this.layout&&!t.hasOwnProperty(this.property))throw new TypeError("variant lacks property "+this.property);this.union.discriminator.encode(this.variant,e,r);let i=s;if(this.layout&&(this.layout.encode(t[this.property],e,r+s),i+=this.layout.getSpan(e,r+s),0<=this.union.span&&i>this.union.span))throw new Error("encoded variant overruns containing union");return i}fromArray(t){if(this.layout)return this.layout.fromArray(t)}}class Mo extends ne{constructor(t,e){if(!(t instanceof Se&&t.isCount()||Number.isInteger(t)&&0<=t))throw new TypeError("length must be positive integer or an unsigned integer ExternalLayout");let r=-1;t instanceof Se||(r=t),super(r,e),this.length=t}getSpan(t,e){let r=this.span;return 0>r&&(r=this.length.decode(t,e)),r}decode(t,e){e===void 0&&(e=0);let r=this.span;return 0>r&&(r=this.length.decode(t,e)),t.slice(e,e+r)}encode(t,e,r){let s=this.length;if(this.length instanceof Se&&(s=t.length),!(Buffer.isBuffer(t)&&s===t.length))throw new TypeError(Lo("Blob.encode",this)+" requires (length "+s+") Buffer as src");if(r+s>e.length)throw new RangeError("encoding overruns Buffer");return e.write(t.toString("hex"),r,s,"hex"),this.length instanceof Se&&this.length.encode(s,e,r),s}}var Do=((n,t,e)=>new $r(n,t,e)),No=(n=>new bt(1,n)),pe=(n=>new bt(4,n)),Uo=(n=>new Co(n)),we=(n=>new Bo(n)),Y=((n,t,e)=>new Ro(n,t,e)),Qr=((n,t,e)=>new Jr(n,t,e)),Ze=((n,t)=>new Mo(n,t));class zo extends vt{constructor(t){super(-1,t),this.property=t,this.layout=Y([pe("length"),pe("lengthPadding"),Ze(Do(pe(),-8),"chars")],this.property)}encode(t,e,r=0){if(t==null)return this.layout.span;const s={chars:Buffer.from(t,"utf8")};return this.layout.encode(s,e,r)}decode(t,e=0){return this.layout.decode(t,e).chars.toString()}getSpan(t,e=0){return pe().span+pe().span+new re(new Uint8Array(t).slice(e,e+4),10,"le").toNumber()}}function Et(n){return new zo(n)}function ae(n){return Ze(32,n)}const ie=Qr(pe("instruction"));ie.addVariant(0,Y([we("lamports"),we("space"),ae("owner")]),"createAccount");ie.addVariant(1,Y([ae("owner")]),"assign");ie.addVariant(2,Y([we("lamports")]),"transfer");ie.addVariant(3,Y([ae("base"),Et("seed"),we("lamports"),we("space"),ae("owner")]),"createAccountWithSeed");ie.addVariant(4,Y([ae("authorized")]),"advanceNonceAccount");ie.addVariant(5,Y([we("lamports")]),"withdrawNonceAccount");ie.addVariant(6,Y([ae("authorized")]),"initializeNonceAccount");ie.addVariant(7,Y([ae("authorized")]),"authorizeNonceAccount");ie.addVariant(8,Y([we("space")]),"allocate");ie.addVariant(9,Y([ae("base"),Et("seed"),we("space"),ae("owner")]),"allocateWithSeed");ie.addVariant(10,Y([ae("base"),Et("seed"),ae("owner")]),"assignWithSeed");ie.addVariant(11,Y([we("lamports"),Et("seed"),ae("owner")]),"transferWithSeed");Math.max(...Object.values(ie.registry).map(n=>n.span));class qo extends vt{constructor(t,e,r,s){super(t.span,s),this.layout=t,this.decoder=e,this.encoder=r}decode(t,e){return this.decoder(this.layout.decode(t,e))}encode(t,e,r){return this.layout.encode(this.encoder(t),e,r)}getSpan(t,e){return this.layout.getSpan(t,e)}}function nr(n){return new qo(Ze(32),t=>new U(t),t=>t.toBuffer(),n)}Y([pe("version"),pe("state"),nr("authorizedPubkey"),nr("nonce"),Y([Uo("lamportsPerSignature")],"feeCalculator")]);function Fo(n,...t){let e=[ce.from([97,110,99,104,111,114])];t.forEach(s=>{e.push(s instanceof ce?s:se(s).toBuffer())});const[r]=U.findProgramAddressSync(e,se(n));return r}const Vo=new U("TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA"),jo=new U("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL");var rr={exports:{}};(function(n,t){var e=typeof self<"u"?self:Po,r=(function(){function i(){this.fetch=!1,this.DOMException=e.DOMException}return i.prototype=e,new i})();(function(i){(function(o){var u={searchParams:"URLSearchParams"in i,iterable:"Symbol"in i&&"iterator"in Symbol,blob:"FileReader"in i&&"Blob"in i&&(function(){try{return new Blob,!0}catch{return!1}})(),formData:"FormData"in i,arrayBuffer:"ArrayBuffer"in i};function h(m){return m&&DataView.prototype.isPrototypeOf(m)}if(u.arrayBuffer)var l=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],d=ArrayBuffer.isView||function(m){return m&&l.indexOf(Object.prototype.toString.call(m))>-1};function v(m){if(typeof m!="string"&&(m=String(m)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(m))throw new TypeError("Invalid character in header field name");return m.toLowerCase()}function w(m){return typeof m!="string"&&(m=String(m)),m}function p(m){var b={next:function(){var C=m.shift();return{done:C===void 0,value:C}}};return u.iterable&&(b[Symbol.iterator]=function(){return b}),b}function y(m){this.map={},m instanceof y?m.forEach(function(b,C){this.append(C,b)},this):Array.isArray(m)?m.forEach(function(b){this.append(b[0],b[1])},this):m&&Object.getOwnPropertyNames(m).forEach(function(b){this.append(b,m[b])},this)}y.prototype.append=function(m,b){m=v(m),b=w(b);var C=this.map[m];this.map[m]=C?C+", "+b:b},y.prototype.delete=function(m){delete this.map[v(m)]},y.prototype.get=function(m){return m=v(m),this.has(m)?this.map[m]:null},y.prototype.has=function(m){return this.map.hasOwnProperty(v(m))},y.prototype.set=function(m,b){this.map[v(m)]=w(b)},y.prototype.forEach=function(m,b){for(var C in this.map)this.map.hasOwnProperty(C)&&m.call(b,this.map[C],C,this)},y.prototype.keys=function(){var m=[];return this.forEach(function(b,C){m.push(C)}),p(m)},y.prototype.values=function(){var m=[];return this.forEach(function(b){m.push(b)}),p(m)},y.prototype.entries=function(){var m=[];return this.forEach(function(b,C){m.push([C,b])}),p(m)},u.iterable&&(y.prototype[Symbol.iterator]=y.prototype.entries);function x(m){if(m.bodyUsed)return Promise.reject(new TypeError("Already read"));m.bodyUsed=!0}function E(m){return new Promise(function(b,C){m.onload=function(){b(m.result)},m.onerror=function(){C(m.error)}})}function A(m){var b=new FileReader,C=E(b);return b.readAsArrayBuffer(m),C}function T(m){var b=new FileReader,C=E(b);return b.readAsText(m),C}function k(m){for(var b=new Uint8Array(m),C=new Array(b.length),V=0;V<b.length;V++)C[V]=String.fromCharCode(b[V]);return C.join("")}function S(m){if(m.slice)return m.slice(0);var b=new Uint8Array(m.byteLength);return b.set(new Uint8Array(m)),b.buffer}function B(){return this.bodyUsed=!1,this._initBody=function(m){this._bodyInit=m,m?typeof m=="string"?this._bodyText=m:u.blob&&Blob.prototype.isPrototypeOf(m)?this._bodyBlob=m:u.formData&&FormData.prototype.isPrototypeOf(m)?this._bodyFormData=m:u.searchParams&&URLSearchParams.prototype.isPrototypeOf(m)?this._bodyText=m.toString():u.arrayBuffer&&u.blob&&h(m)?(this._bodyArrayBuffer=S(m.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):u.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(m)||d(m))?this._bodyArrayBuffer=S(m):this._bodyText=m=Object.prototype.toString.call(m):this._bodyText="",this.headers.get("content-type")||(typeof m=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):u.searchParams&&URLSearchParams.prototype.isPrototypeOf(m)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},u.blob&&(this.blob=function(){var m=x(this);if(m)return m;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?x(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(A)}),this.text=function(){var m=x(this);if(m)return m;if(this._bodyBlob)return T(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(k(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},u.formData&&(this.formData=function(){return this.text().then(q)}),this.json=function(){return this.text().then(JSON.parse)},this}var G=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function O(m){var b=m.toUpperCase();return G.indexOf(b)>-1?b:m}function z(m,b){b=b||{};var C=b.body;if(m instanceof z){if(m.bodyUsed)throw new TypeError("Already read");this.url=m.url,this.credentials=m.credentials,b.headers||(this.headers=new y(m.headers)),this.method=m.method,this.mode=m.mode,this.signal=m.signal,!C&&m._bodyInit!=null&&(C=m._bodyInit,m.bodyUsed=!0)}else this.url=String(m);if(this.credentials=b.credentials||this.credentials||"same-origin",(b.headers||!this.headers)&&(this.headers=new y(b.headers)),this.method=O(b.method||this.method||"GET"),this.mode=b.mode||this.mode||null,this.signal=b.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&C)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(C)}z.prototype.clone=function(){return new z(this,{body:this._bodyInit})};function q(m){var b=new FormData;return m.trim().split("&").forEach(function(C){if(C){var V=C.split("="),W=V.shift().replace(/\+/g," "),g=V.join("=").replace(/\+/g," ");b.append(decodeURIComponent(W),decodeURIComponent(g))}}),b}function D(m){var b=new y,C=m.replace(/\r?\n[\t ]+/g," ");return C.split(/\r?\n/).forEach(function(V){var W=V.split(":"),g=W.shift().trim();if(g){var a=W.join(":").trim();b.append(g,a)}}),b}B.call(z.prototype);function M(m,b){b||(b={}),this.type="default",this.status=b.status===void 0?200:b.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in b?b.statusText:"OK",this.headers=new y(b.headers),this.url=b.url||"",this._initBody(m)}B.call(M.prototype),M.prototype.clone=function(){return new M(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new y(this.headers),url:this.url})},M.error=function(){var m=new M(null,{status:0,statusText:""});return m.type="error",m};var R=[301,302,303,307,308];M.redirect=function(m,b){if(R.indexOf(b)===-1)throw new RangeError("Invalid status code");return new M(null,{status:b,headers:{location:m}})},o.DOMException=i.DOMException;try{new o.DOMException}catch{o.DOMException=function(b,C){this.message=b,this.name=C;var V=Error(b);this.stack=V.stack},o.DOMException.prototype=Object.create(Error.prototype),o.DOMException.prototype.constructor=o.DOMException}function I(m,b){return new Promise(function(C,V){var W=new z(m,b);if(W.signal&&W.signal.aborted)return V(new o.DOMException("Aborted","AbortError"));var g=new XMLHttpRequest;function a(){g.abort()}g.onload=function(){var c={status:g.status,statusText:g.statusText,headers:D(g.getAllResponseHeaders()||"")};c.url="responseURL"in g?g.responseURL:c.headers.get("X-Request-URL");var f="response"in g?g.response:g.responseText;C(new M(f,c))},g.onerror=function(){V(new TypeError("Network request failed"))},g.ontimeout=function(){V(new TypeError("Network request failed"))},g.onabort=function(){V(new o.DOMException("Aborted","AbortError"))},g.open(W.method,W.url,!0),W.credentials==="include"?g.withCredentials=!0:W.credentials==="omit"&&(g.withCredentials=!1),"responseType"in g&&u.blob&&(g.responseType="blob"),W.headers.forEach(function(c,f){g.setRequestHeader(f,c)}),W.signal&&(W.signal.addEventListener("abort",a),g.onreadystatechange=function(){g.readyState===4&&W.signal.removeEventListener("abort",a)}),g.send(typeof W._bodyInit>"u"?null:W._bodyInit)})}return I.polyfill=!0,i.fetch||(i.fetch=I,i.Headers=y,i.Request=z,i.Response=M),o.Headers=y,o.Request=z,o.Response=M,o.fetch=I,Object.defineProperty(o,"__esModule",{value:!0}),o})({})})(r),r.fetch.ponyfill=!0,delete r.fetch.polyfill;var s=r;t=s.fetch,t.default=s.fetch,t.fetch=s.fetch,t.Headers=s.Headers,t.Request=s.Request,t.Response=s.Response,n.exports=t})(rr,rr.exports);F.rustEnum([F.struct([],"uninitialized"),F.struct([F.option(F.publicKey(),"authorityAddress")],"buffer"),F.struct([F.publicKey("programdataAddress")],"program"),F.struct([F.u64("slot"),F.option(F.publicKey(),"upgradeAuthorityAddress")],"programData")],void 0,F.u32());function Go(n){return"accounts"in n}async function Ko(n){const t=(await U.findProgramAddress([],n))[0];return await U.createWithSeed(t,Wo(),n)}function Wo(){return"anchor:idl"}const $o=F.struct([F.publicKey("authority"),F.vecU8("data")]);function Ho(n){return $o.decode(n)}function _t(n,t){var e,r;let s={};const i=n.args?n.args.length:0;if(t.length>i){if(t.length!==i+1)throw new Error(`provided too many arguments ${t} to instruction ${n?.name} expecting: ${(r=(e=n.args)===null||e===void 0?void 0:e.map(o=>o.name))!==null&&r!==void 0?r:[]}`);s=t.pop()}return[t,s]}class dt{static build(t,e,r){if(t.name==="_inner")throw new ut("the _inner name is reserved");const s=(...i)=>{const[o,u]=_t(t,[...i]);Ur(t.accounts,u.accounts),Zo(t,...i);const h=s.accounts(u.accounts);return u.remainingAccounts!==void 0&&h.push(...u.remainingAccounts),Vr("debug-logs")&&console.log("Outgoing account metas:",h),new mt({keys:h,programId:r,data:e(t.name,Qs(t,...o))})};return s.accounts=i=>dt.accountsArray(i,t.accounts,r,t.name),s}static accountsArray(t,e,r,s){return t?e.map(i=>{if(("accounts"in i?i.accounts:void 0)!==void 0){const u=t[i.name];return dt.accountsArray(u,i.accounts,r,s).flat()}else{const u=i;let h;try{h=se(t[i.name])}catch{throw new Error(`Wrong input type for account "${i.name}" in the instruction accounts object${s!==void 0?' for instruction "'+s+'"':""}. Expected PublicKey or string.`)}const l=u.isOptional&&h.equals(r),d=u.isMut&&!l,v=u.isSigner&&!l;return{pubkey:h,isWritable:d,isSigner:v}}}).flat():[]}}function Zo(n,...t){}class Xo{static build(t,e){return(...s)=>{var i,o,u;const[,h]=_t(t,[...s]),l=new wt;if(h.preInstructions&&h.instructions)throw new Error("instructions is deprecated, use preInstructions");return(i=h.preInstructions)===null||i===void 0||i.forEach(d=>l.add(d)),(o=h.instructions)===null||o===void 0||o.forEach(d=>l.add(d)),l.add(e(...s)),(u=h.postInstructions)===null||u===void 0||u.forEach(d=>l.add(d)),l}}}class Yo{static build(t,e,r,s){return async(...o)=>{var u;const h=e(...o),[,l]=_t(t,[...o]);if(s.sendAndConfirm===void 0)throw new Error("This function requires 'Provider.sendAndConfirm' to be implemented.");try{return await s.sendAndConfirm(h,(u=l.signers)!==null&&u!==void 0?u:[],l.options)}catch(d){throw jr(d,r)}}}}class Jo{static build(t,e,r,s){var i;const o={};return(i=t.accounts)===null||i===void 0||i.forEach(u=>{const h=H(u.name);o[h]=new Qo(t,u,r,s,e)}),o}}class Qo{get size(){return this._size}get programId(){return this._programId}get provider(){return this._provider}get coder(){return this._coder}get idlAccount(){return this._idlAccount}constructor(t,e,r,s,i){this._idlAccount=e,this._programId=r,this._provider=s??Vt(),this._coder=i??new Wr(t),this._size=this._coder.accounts.size(e)}async fetchNullable(t,e){const{data:r}=await this.fetchNullableAndContext(t,e);return r}async fetchNullableAndContext(t,e){const r=await this.getAccountInfoAndContext(t,e),{value:s,context:i}=r;return{data:s&&s.data.length!==0?this._coder.accounts.decode(this._idlAccount.name,s.data):null,context:i}}async fetch(t,e){const{data:r}=await this.fetchNullableAndContext(t,e);if(r===null)throw new Error(`Account does not exist or has no data ${t.toString()}`);return r}async fetchAndContext(t,e){const{data:r,context:s}=await this.fetchNullableAndContext(t,e);if(r===null)throw new Error(`Account does not exist ${t.toString()}`);return{data:r,context:s}}async fetchMultiple(t,e){return(await this.fetchMultipleAndContext(t,e)).map(s=>s?s.data:null)}async fetchMultipleAndContext(t,e){return(await uo(this._provider.connection,t.map(s=>se(s)),e)).map(s=>{if(s==null)return null;const{account:i,context:o}=s;return{data:this._coder.accounts.decode(this._idlAccount.name,i.data),context:o}})}async all(t){const e=this.coder.accounts.memcmp(this._idlAccount.name,t instanceof Buffer?t:void 0),r=[];return e?.offset!=null&&e?.bytes!=null&&r.push({memcmp:{offset:e.offset,bytes:e.bytes}}),e?.dataSize!=null&&r.push({dataSize:e.dataSize}),(await this._provider.connection.getProgramAccounts(this._programId,{commitment:this._provider.connection.commitment,filters:[...r,...Array.isArray(t)?t:[]]})).map(({pubkey:i,account:o})=>({publicKey:i,account:this._coder.accounts.decode(this._idlAccount.name,o.data)}))}subscribe(t,e){const r=Ue.get(t.toString());if(r)return r.ee;const s=new Hs;t=se(t);const i=this._provider.connection.onAccountChange(t,o=>{const u=this._coder.accounts.decode(this._idlAccount.name,o.data);s.emit("change",u)},e);return Ue.set(t.toString(),{ee:s,listener:i}),s}async unsubscribe(t){let e=Ue.get(t.toString());if(!e){console.warn("Address is not subscribed");return}Ue&&await this._provider.connection.removeAccountChangeListener(e.listener).then(()=>{Ue.delete(t.toString())}).catch(console.error)}async createInstruction(t,e){const r=this.size;if(this._provider.publicKey===void 0)throw new Error("This function requires the Provider interface implementor to have a 'publicKey' field.");return ve.createAccount({fromPubkey:this._provider.publicKey,newAccountPubkey:t.publicKey,space:e??r,lamports:await this._provider.connection.getMinimumBalanceForRentExemption(e??r),programId:this._programId})}async associated(...t){const e=await this.associatedAddress(...t);return await this.fetch(e)}async associatedAddress(...t){return await Fo(this._programId,...t)}async getAccountInfo(t,e){return await this._provider.connection.getAccountInfo(se(t),e)}async getAccountInfoAndContext(t,e){return await this._provider.connection.getAccountInfoAndContext(se(t),e)}}const Ue=new Map,$t="Program log: ",ei="Program data: ",ea=$t.length,ta=ei.length;class na{constructor(t,e,r){this._programId=t,this._provider=e,this._eventParser=new ti(t,r),this._eventCallbacks=new Map,this._eventListeners=new Map,this._listenerIdCount=0}addEventListener(t,e){var r;let s=this._listenerIdCount;return this._listenerIdCount+=1,this._eventListeners.has(t)||this._eventListeners.set(t,[]),this._eventListeners.set(t,((r=this._eventListeners.get(t))!==null&&r!==void 0?r:[]).concat(s)),this._eventCallbacks.set(s,[t,e]),this._onLogsSubscriptionId!==void 0||(this._onLogsSubscriptionId=this._provider.connection.onLogs(this._programId,(i,o)=>{if(!i.err)for(const u of this._eventParser.parseLogs(i.logs)){const h=this._eventListeners.get(u.name);h&&h.forEach(l=>{const d=this._eventCallbacks.get(l);if(d){const[,v]=d;v(u.data,o.slot,i.signature)}})}})),s}async removeEventListener(t){const e=this._eventCallbacks.get(t);if(!e)throw new Error(`Event listener ${t} doesn't exist!`);const[r]=e;let s=this._eventListeners.get(r);if(!s)throw new Error(`Event listeners don't exist for ${r}!`);if(this._eventCallbacks.delete(t),s=s.filter(i=>i!==t),this._eventListeners.set(r,s),s.length===0&&this._eventListeners.delete(r),this._eventCallbacks.size===0){if(this._eventListeners.size!==0)throw new Error(`Expected event listeners size to be 0 but got ${this._eventListeners.size}`);this._onLogsSubscriptionId!==void 0&&(await this._provider.connection.removeOnLogsListener(this._onLogsSubscriptionId),this._onLogsSubscriptionId=void 0)}}}class ti{constructor(t,e){this.coder=e,this.programId=t}*parseLogs(t,e=!1){const r=new ia(t),s=new ra;let i=r.next();for(;i!==null;){let[o,u,h]=this.handleLog(s,i,e);o&&(yield o),u&&s.push(u),h&&s.pop(),i=r.next()}}handleLog(t,e,r){return t.stack.length>0&&t.program()===this.programId.toString()?this.handleProgramLog(e,r):[null,...this.handleSystemLog(e)]}handleProgramLog(t,e){if(t.startsWith($t)||t.startsWith(ei)){const r=t.startsWith($t)?t.slice(ea):t.slice(ta),s=this.coder.events.decode(r);if(e&&s===null)throw new Error(`Unable to decode event ${r}`);return[s,null,!1]}else return[null,...this.handleSystemLog(t)]}handleSystemLog(t){const e=t.split(":")[0];return e.match(/^Program (.*) success/g)!==null?[null,!0]:e.startsWith(`Program ${this.programId.toString()} invoke`)?[this.programId.toString(),!1]:e.includes("invoke")?["cpi",!1]:[null,!1]}}class ra{constructor(){this.stack=[]}program(){if(!this.stack.length)throw new Error("Expected the stack to have elements");return this.stack[this.stack.length-1]}push(t){this.stack.push(t)}pop(){if(!this.stack.length)throw new Error("Expected the stack to have elements");this.stack.pop()}}class ia{constructor(t){this.logs=t}next(){if(this.logs.length===0)return null;let t=this.logs[0];return this.logs=this.logs.slice(1),t}}class sa{static build(t,e,r,s,i,o,u){return async(...l)=>{var d;const v=e(...l),[,w]=_t(t,[...l]);let p;if(s.simulate===void 0)throw new Error("This function requires 'Provider.simulate' to be implemented.");try{p=await s.simulate(v,w.signers,(d=w.options)===null||d===void 0?void 0:d.commitment)}catch(E){throw jr(E,r)}if(p===void 0)throw new Error("Unable to simulate transaction");const y=p.logs;if(!y)throw new Error("Simulated logs not found");const x=[];if(u.events){let E=new ti(o,i);for(const A of E.parseLogs(y))x.push(A)}return{events:x,raw:y}}}}function Ot(n){return new ni(Ze(8),t=>tn.fromBuffer(t),t=>t.toBuffer(),n)}function nt(n){return new ni(Ze(32),t=>new U(t),t=>t.toBuffer(),n)}function Mt(n,t){return new oa(n,t)}class ni extends vt{constructor(t,e,r,s){super(t.span,s),this.layout=t,this.decoder=e,this.encoder=r}decode(t,e){return this.decoder(this.layout.decode(t,e))}encode(t,e,r){return this.layout.encode(this.encoder(t),e,r)}getSpan(t,e){return this.layout.getSpan(t,e)}}class oa extends vt{constructor(t,e){super(-1,e),this.layout=t,this.discriminator=pe()}encode(t,e,r=0){return t==null?this.layout.span+this.discriminator.encode(0,e,r):(this.discriminator.encode(1,e,r),this.layout.encode(t,e,r+4)+4)}decode(t,e=0){const r=this.discriminator.decode(t,e);if(r===0)return null;if(r===1)return this.layout.decode(t,e+4);throw new Error("Invalid coption "+this.layout.property)}getSpan(t,e=0){return this.layout.getSpan(t,e+4)+4}}class tn extends re{toBuffer(){const t=super.toArray().reverse(),e=Buffer.from(t);if(e.length===8)return e;if(e.length>=8)throw new Error("u64 too large");const r=Buffer.alloc(8);return e.copy(r),r}static fromBuffer(t){if(t.length!==8)throw new Error(`Invalid buffer length: ${t.length}`);return new tn([...t].reverse().map(e=>`00${e.toString(16)}`.slice(-2)).join(""),16)}}const aa=Y([nt("mint"),nt("owner"),Ot("amount"),Mt(nt(),"delegate"),(n=>{const t=Qr(No("discriminator"),null,n);return t.addVariant(0,Y([]),"uninitialized"),t.addVariant(1,Y([]),"initialized"),t.addVariant(2,Y([]),"frozen"),t})("state"),Mt(Ot(),"isNative"),Ot("delegatedAmount"),Mt(nt(),"closeAuthority")]);function ca(n){return aa.decode(n)}class Ke{constructor(t,e,r,s,i,o,u,h){this._accounts=e,this._provider=r,this._programId=s,this._idlIx=i,this._idlTypes=u,this._customResolver=h,this._args=t,this._accountStore=new ua(r,o,this._programId)}args(t){this._args=t}async resolve(){for(await this.resolveConst(this._idlIx.accounts),this._resolveEventCpi(this._idlIx.accounts);await this.resolvePdas(this._idlIx.accounts)+await this.resolveRelations(this._idlIx.accounts)+await this.resolveCustom()>0;);}async resolveCustom(){if(this._customResolver){const{accounts:t,resolved:e}=await this._customResolver({args:this._args,accounts:this._accounts,provider:this._provider,programId:this._programId,idlIx:this._idlIx});return this._accounts=t,e}return 0}resolveOptionalsHelper(t,e){const r={};for(const s of e){const i=s.name,o=t[i];o!==void 0&&(ri(o)?Go(s)?r[i]=this.resolveOptionalsHelper(o,s.accounts):r[i]=ii(o):o!==null?r[i]=se(o):s.isOptional&&(r[i]=this._programId))}return r}resolveOptionals(t){Object.assign(this._accounts,this.resolveOptionalsHelper(t,this._idlIx.accounts))}get(t){const e=t.reduce((r,s)=>r&&r[s],this._accounts);if(e&&e.toBase58)return e}set(t,e){let r=this._accounts;t.forEach((s,i)=>{i==t.length-1&&(r[s]=e),r[s]=r[s]||{},r=r[s]})}async resolveConst(t,e=[]){for(let r=0;r<t.length;r+=1){const s=t[r],i=s.accounts;i&&await this.resolveConst(i,[...e,H(s.name)]);const o=s,u=H(s.name);if(o.isSigner&&!this.get([...e,u])){if(this._provider.wallet===void 0)throw new Error("This function requires the Provider interface implementor to have a 'wallet' field.");this.set([...e,u],this._provider.wallet.publicKey)}Reflect.has(Ke.CONST_ACCOUNTS,u)&&!this.get([...e,u])&&this.set([...e,u],Ke.CONST_ACCOUNTS[u])}}_resolveEventCpi(t,e=[]){for(const r in t){const s=t[r],i=s.accounts;i&&this._resolveEventCpi(i,[...e,H(s.name)]);const o=+r+1;if(o===t.length)return;const u=H(t[r].name),h=H(t[o].name);if(u==="eventAuthority"&&h==="program"){const l=[...e,u],d=[...e,h];this.get(l)||this.set(l,U.findProgramAddressSync([Buffer.from("__event_authority")],this._programId)[0]),this.get(d)||this.set(d,this._programId);return}}}async resolvePdas(t,e=[]){let r=0;for(let s=0;s<t.length;s+=1){const i=t[s],o=i.accounts;o&&(r+=await this.resolvePdas(o,[...e,H(i.name)]));const u=i,h=H(i.name);u.pda&&u.pda.seeds.length>0&&!this.get([...e,h])&&await this.autoPopulatePda(u,e)&&(r+=1)}return r}async resolveRelations(t,e=[]){let r=0;for(let s=0;s<t.length;s+=1){const i=t[s],o=i.accounts;o&&(r+=await this.resolveRelations(o,[...e,H(i.name)]));const u=i.relations||[],h=H(i.name),l=[...e,h],d=this.get(l);if(d){const v=u.filter(w=>!this.get([...e,H(w)]));if(r+=v.length,v.length>0){const w=await this._accountStore.fetchAccount({publicKey:d});await Promise.all(v.map(async p=>{const y=H(p);return this.set([...e,y],w[y]),w[y]}))}}}return r}async autoPopulatePda(t,e=[]){if(!t.pda||!t.pda.seeds)throw new Error("Must have seeds");const r=await Promise.all(t.pda.seeds.map(o=>this.toBuffer(o,e)));if(r.some(o=>typeof o>"u"))return;const s=await this.parseProgramId(t,e);if(!s)return;const[i]=await U.findProgramAddress(r,s);this.set([...e,H(t.name)],i)}async parseProgramId(t,e=[]){var r;if(!(!((r=t.pda)===null||r===void 0)&&r.programId))return this._programId;switch(t.pda.programId.kind){case"const":return new U(this.toBufferConst(t.pda.programId.value));case"arg":return this.argValue(t.pda.programId);case"account":return await this.accountValue(t.pda.programId,e);default:throw new Error(`Unexpected program seed kind: ${t.pda.programId.kind}`)}}async toBuffer(t,e=[]){switch(t.kind){case"const":return this.toBufferConst(t);case"arg":return await this.toBufferArg(t);case"account":return await this.toBufferAccount(t,e);default:throw new Error(`Unexpected seed kind: ${t.kind}`)}}getType(t,e=[]){if(e.length>0&&t.defined){const r=this._idlTypes.find(o=>o.name===t.defined);if(!r)throw new Error(`Cannot find type ${t.defined}`);const i=r.type.fields.find(o=>o.name===e[0]);return this.getType(i.type,e.slice(1))}return t}toBufferConst(t){return this.toBufferValue(this.getType(t.type,(t.path||"").split(".").slice(1)),t.value)}async toBufferArg(t){const e=this.argValue(t);if(!(typeof e>"u"))return this.toBufferValue(this.getType(t.type,(t.path||"").split(".").slice(1)),e)}argValue(t){const e=t.path.split("."),r=H(e[0]),s=this._idlIx.args.findIndex(i=>i.name===r);if(s===-1)throw new Error(`Unable to find argument for seed: ${r}`);return e.slice(1).reduce((i,o)=>(i||{})[o],this._args[s])}async toBufferAccount(t,e=[]){const r=await this.accountValue(t,e);if(r)return this.toBufferValue(t.type,r)}async accountValue(t,e=[]){const r=t.path.split("."),s=r[0],i=this.get([...e,H(s)]);if(i===null)throw new Error("fieldPubkey is null");if(r.length===1)return i;const o=await this._accountStore.fetchAccount({publicKey:i,name:t.account});return this.parseAccountValue(o,r.slice(1))}parseAccountValue(t,e){let r;for(;e.length>0;)r=t[H(e[0])],e=e.slice(1);return r}toBufferValue(t,e){switch(t){case"u8":return Buffer.from([e]);case"u16":let r=Buffer.alloc(2);return r.writeUInt16LE(e),r;case"u32":let s=Buffer.alloc(4);return s.writeUInt32LE(e),s;case"u64":let i=Buffer.alloc(8);return i.writeBigUInt64LE(BigInt(e)),i;case"string":return Buffer.from(Ys(e));case"publicKey":return e.toBuffer();default:if(t.array)return Buffer.from(e);throw new Error(`Unexpected seed type: ${t}`)}}}Ke.CONST_ACCOUNTS={associatedTokenProgram:jo,rent:fi,systemProgram:ve.programId,tokenProgram:Vo,clock:di};class ua{constructor(t,e,r){this._provider=t,this._programId=r,this._cache=new Map,this._idls={},this._idls[r.toBase58()]=e}async ensureIdl(t){if(!this._idls[t.toBase58()]){const e=await Ie.fetchIdl(t,this._provider);if(e){const r=new Ie(e,t,this._provider);this._idls[t.toBase58()]=r.account}}return this._idls[t.toBase58()]}async fetchAccount({publicKey:t,name:e,programId:r=this._programId}){const s=t.toString();if(!this._cache.has(s))if(e==="TokenAccount"){const i=await this._provider.connection.getAccountInfo(t);if(i===null)throw new Error(`invalid account info for ${s}`);const o=ca(i.data);this._cache.set(s,o)}else if(e){const i=await this.ensureIdl(r);if(i){const o=i[H(e)];if(o){const u=await o.fetch(t);this._cache.set(s,u)}}}else{const i=await this._provider.connection.getAccountInfo(t);if(i===null)throw new Error(`invalid account info for ${s}`);const o=i.data,u=await this.ensureIdl(i.owner);if(u){const h=Object.values(u)[0];if(!h)throw new Error("No accounts for this program");const l=h.coder.accounts.decodeAny(o);this._cache.set(s,l)}}return this._cache.get(s)}}class la{static build(t,e,r,s,i,o,u,h,l,d,v){return(...w)=>new da(w,s,i,o,u,h,t,e,r,l,d,v)}}function ri(n){return typeof n=="object"&&n!==null&&!("_bn"in n)}function ii(n,t){const e={};for(const r in n){const s=n[r];if(s===null)throw new Error("Failed to resolve optionals due to IDL type mismatch with input accounts!");e[r]=ri(s)?ii(s):se(s)}return e}class da{constructor(t,e,r,s,i,o,u,h,l,d,v,w){this._ixFn=e,this._txFn=r,this._rpcFn=s,this._simulateFn=i,this._viewFn=o,this._programId=h,this._accounts={},this._remainingAccounts=[],this._signers=[],this._preInstructions=[],this._postInstructions=[],this._autoResolveAccounts=!0,this._args=t,this._accountsResolver=new Ke(t,this._accounts,u,h,l,d,v,w)}args(t){this._args=t,this._accountsResolver.args(t)}async pubkeys(){return this._autoResolveAccounts&&await this._accountsResolver.resolve(),this._accounts}accounts(t){return this._autoResolveAccounts=!0,this._accountsResolver.resolveOptionals(t),this}accountsStrict(t){return this._autoResolveAccounts=!1,this._accountsResolver.resolveOptionals(t),this}signers(t){return this._signers=this._signers.concat(t),this}remainingAccounts(t){return this._remainingAccounts=this._remainingAccounts.concat(t),this}preInstructions(t){return this._preInstructions=this._preInstructions.concat(t),this}postInstructions(t){return this._postInstructions=this._postInstructions.concat(t),this}async rpc(t){return this._autoResolveAccounts&&await this._accountsResolver.resolve(),this._rpcFn(...this._args,{accounts:this._accounts,signers:this._signers,remainingAccounts:this._remainingAccounts,preInstructions:this._preInstructions,postInstructions:this._postInstructions,options:t})}async rpcAndKeys(t){return{pubkeys:await this.pubkeys(),signature:await this.rpc(t)}}async view(t){if(this._autoResolveAccounts&&await this._accountsResolver.resolve(),!this._viewFn)throw new Error("Method does not support views");return this._viewFn(...this._args,{accounts:this._accounts,signers:this._signers,remainingAccounts:this._remainingAccounts,preInstructions:this._preInstructions,postInstructions:this._postInstructions,options:t})}async simulate(t){return this._autoResolveAccounts&&await this._accountsResolver.resolve(),this._simulateFn(...this._args,{accounts:this._accounts,signers:this._signers,remainingAccounts:this._remainingAccounts,preInstructions:this._preInstructions,postInstructions:this._postInstructions,options:t})}async instruction(){return this._autoResolveAccounts&&await this._accountsResolver.resolve(),this._ixFn(...this._args,{accounts:this._accounts,signers:this._signers,remainingAccounts:this._remainingAccounts,preInstructions:this._preInstructions,postInstructions:this._postInstructions})}async prepare(){return{instruction:await this.instruction(),pubkeys:await this.pubkeys(),signers:await this._signers}}async transaction(){return this._autoResolveAccounts&&await this._accountsResolver.resolve(),this._txFn(...this._args,{accounts:this._accounts,signers:this._signers,remainingAccounts:this._remainingAccounts,preInstructions:this._preInstructions,postInstructions:this._postInstructions})}}class fa{static build(t,e,r,s){const i=e.accounts.find(h=>h.isMut),o=!!e.returns;return i||!o?void 0:async(...h)=>{var l,d;let v=await r(...h);const w=`Program return: ${t} `;let p=v.raw.find(A=>A.startsWith(w));if(!p)throw new Error("View expected return log");let y=Nr(p.slice(w.length)),x=e.returns;if(!x)throw new Error("View expected return type");return te.fieldLayout({type:x},Array.from([...(l=s.accounts)!==null&&l!==void 0?l:[],...(d=s.types)!==null&&d!==void 0?d:[]])).decode(y)}}}class ha{static build(t,e,r,s,i){const o={},u={},h={},l={},d={},v={},w=Js(t),p=t.accounts?Jo.build(t,e,r,s):{};return t.instructions.forEach(y=>{const x=dt.build(y,(G,O)=>e.instruction.encode(G,O),r),E=Xo.build(y,x),A=Yo.build(y,E,w,s),T=sa.build(y,E,w,s,e,r,t),k=fa.build(r,y,T,t),S=la.build(s,r,y,x,E,A,T,k,p,t.types||[],i&&i(y)),B=H(y.name);u[B]=x,h[B]=E,o[B]=A,l[B]=T,d[B]=S,k&&(v[B]=k)}),[o,u,h,p,l,d,v]}}class Ie{get programId(){return this._programId}get idl(){return this._idl}get coder(){return this._coder}get provider(){return this._provider}constructor(t,e,r,s,i){e=se(e),r||(r=Vt()),this._idl=t,this._provider=r,this._programId=e,this._coder=s??new Wr(t),this._events=new na(this._programId,r,this._coder);const[o,u,h,l,d,v,w]=ha.build(t,this._coder,e,r,i??(()=>{}));this.rpc=o,this.instruction=u,this.transaction=h,this.account=l,this.simulate=d,this.methods=v,this.views=w}static async at(t,e){const r=se(t),s=await Ie.fetchIdl(r,e);if(!s)throw new Error(`IDL not found for program: ${t.toString()}`);return new Ie(s,r,e)}static async fetchIdl(t,e){e=e??Vt();const r=se(t),s=await Ko(r),i=await e.connection.getAccountInfo(s);if(!i)return null;let o=Ho(i.data.slice(8));const u=Ks(o.data);return JSON.parse(Xs(u))}addEventListener(t,e){return this._events.addEventListener(t,e)}async removeEventListener(t){return await this._events.removeEventListener(t)}}new U("11111111111111111111111111111111");function si(){const n=JSON.parse(JSON.stringify(Ii));return n.address=Re,n.types&&Array.isArray(n.types)&&n.types.length===0&&delete n.types,n}function ft(n,t){const e=new Qt(n,t,{commitment:"confirmed",preflightCommitment:"confirmed"}),r=new U(Re);return new Ie(si(),r,e)}function oi(n){const t={publicKey:U.default,signTransaction:async s=>s,signAllTransactions:async s=>s},e=new Qt(n,t,{commitment:"confirmed",preflightCommitment:"confirmed"}),r=new U(Re);return new Ie(si(),r,e)}function j(n,t="Invalid PublicKey"){if(n instanceof U)return n;if(!n||typeof n!="string")throw new Error(t);try{return new U(n)}catch(e){throw new Error(`${t}: ${e.message}`,{cause:e})}}function de(n,t="Invalid BN value"){if(n instanceof re)return n;if(n==null)throw new Error(t);try{return n instanceof Uint8Array||Array.isArray(n)?new re(n):typeof n=="bigint"?new re(n.toString()):new re(String(n))}catch(e){throw new Error(`${t}: ${e.message}`,{cause:e})}}function ai(n,t,e=Zt){const r=typeof e=="string"?new U(e):e,[s]=U.findProgramAddressSync([n.toBuffer(),t.toBuffer()],r);return s}function nn(n,t,e){const r=de(t),[s]=U.findProgramAddressSync([Buffer.from("escrow"),n.toBuffer(),r.toArrayLike(Buffer,"le",8)],e),[i]=U.findProgramAddressSync([Buffer.from("auth"),s.toBuffer()],e),[o]=U.findProgramAddressSync([Buffer.from("vault"),s.toBuffer()],e);return{auth:i,vault:o,escrow:s}}async function ht(n,t,e,r=Z){try{const s=j(n),i=j(t),o=me(s,i,!1,r,ee);return await vi(e,o,"confirmed",r),!0}catch{return!1}}function pt(n,t,e,r=Z){const s=j(n),i=j(t),o=e?j(e):i,u=me(s,i,!1,r,ee);return Ai(o,u,i,s,r,ee)}var pa=new U("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr");function rn(n){if(!n||typeof n!="string")throw new Error("Memo text must be a non-empty string");const t=Buffer.from(n,"utf8");return new mt({keys:[],programId:pa,data:t})}var ma=new U("TokenzQdBNbLqP5VEhdkAS6EPFLC1PHnBqCXEpPxuEb"),wa=new U("CoREENxT6tW1HoK8ypY1SxRMZTcVPm7R94rH4PZNhX7d");async function ir(n,t,e="deposit"){const r=t instanceof U?t:new U(t),s=await n.getAccountInfo(r);if(!s)throw new Error(`Mint account not found: ${r.toBase58()}`);const i=s.owner;if(i.equals(Z))return Z;throw i.equals(ma)?new Error(`This ${e} token uses Token-2022. Our escrow supports only legacy SPL Token.`):i.equals(wa)?new Error(`This ${e} NFT uses MPL Core. Our escrow supports only legacy SPL Token.`):new Error(`This ${e} token is not legacy SPL (owner: ${i.toBase58()}).`)}var sr={ATA_CREATION:.0022},ga=3e4;function ya(n){const t=j(n.maker),e=j(n.taker),r=j(n.depositTokenMint),s=j(n.requestTokenMint);return{makerReceiveAta:me(s,t,!1,Z,ee),takerAta:me(s,e,!1,Z,ee),takerReceiveAta:me(r,e,!1,Z,ee)}}async function va(n){const{transaction:t,requestTokenMint:e,depositTokenMint:r,taker:s,connection:i}=n,o=j(e),u=j(r),h=j(s),l=await ht(o,h,i),d=await ht(u,h,i);let v=0;return l||(t.add(pt(o,h,h)),v+=sr.ATA_CREATION),d||(t.add(pt(u,h,h)),v+=sr.ATA_CREATION),{takerAtaExists:l,takerReceiveAtaExists:d,totalCost:v}}function ba(n){return(n instanceof U?n:new U(n)).equals(dr)}function Ea(n){const t=n instanceof U?n:new U(n);return me(dr,t,!1,Z,ee)}async function _a(n){if(n.requestAmount)return de(n.requestAmount);if(n.fetchEscrowAccount){const t=await n.fetchEscrowAccount(),e=new re(Math.floor(t.price*1e9));return n.amountBN.mul(e).div(new re(1e9))}throw new Error("Cannot calculate request amount: need requestAmount or fetchEscrowAccount")}var or=new re(2039280);async function Aa(n){const{requestAmountLamports:t,accountExists:e,connection:r,wrappedSolAccount:s}=n;if(!e)return t.add(or);try{const o=(await r.getParsedAccountInfo(s)).value?.data,u=(o&&typeof o=="object"&&"parsed"in o?o.parsed?.info?.tokenAmount?.uiAmount:void 0)??0,h=new re(Math.floor(u*1e9));return h.gte(t)?new re(0):t.sub(h)}catch{return t.add(or)}}function ka(n){const{transaction:t,takerPubkey:e,wrappedSolAccount:r,solToTransfer:s,accountExists:i}=n;s.gt(new re(0))&&t.add(ve.transfer({fromPubkey:e,toPubkey:r,lamports:s.toNumber()})),(!i||s.gt(new re(0)))&&t.add(Si(r,Z))}async function Ta(n){const{maker:t,depositTokenMint:e,requestTokenMint:r,depositAmount:s,requestAmount:i,seed:o,expireTimestamp:u=0,allowPartialFill:h,onlyWhitelist:l,slippage:d,recipient:v,whitelistProgram:w,whitelist:p,entry:y,contractFeeAccount:x,memo:E,connection:A,wallet:T}=n,k=new wt;E?.trim()&&k.add(rn(E.trim()));const S=j(Re),B=j(t),G=de(o),{auth:O,vault:z,escrow:q}=nn(B,G,S),D=j(e),M=j(r);await ir(A,D,"deposit"),await ir(A,M,"request");const R=me(D,B,!1,Z,ee),I=j(x??vr),m=ft(A,T),b=!!p?.trim(),C=b?j(w??Zt):m.programId,V=b?j(p):m.programId,W=b?ai(B,V,C):m.programId,g=v?(()=>{const K=j(v);if(K.equals(ve.programId))throw new Error("Cannot use SystemProgram as recipient.");return K})():m.programId;await ht(D,B,A)||k.add(pt(D,B,B)),await ht(M,B,A)||k.add(pt(M,B,B));const a=de(s),c=de(i),f=de(u??0),_={maker:B,makerAta:R,recipient:g,depositToken:D,requestToken:M,auth:O,vault:z,escrow:q,tokenProgram:Z,associatedTokenProgram:ee,systemProgram:ve.programId,fee:I,whitelistProgram:C,whitelist:V,entry:y?j(y):W},P=await m.methods.initialize(G,a,c,f,h,l,d).accounts(_).instruction();return k.add(P),await sn(A,k,B),k}async function sn(n,t,e){const{blockhash:r,lastValidBlockHeight:s}=await n.getLatestBlockhash();t.recentBlockhash=r,t.feePayer=e,s!=null&&(t.lastValidBlockHeight=s)}async function Pa(n){const{maker:t,depositTokenMint:e,requestTokenMint:r,seed:s,memo:i,connection:o,wallet:u}=n,h=new wt;i?.trim()&&h.add(rn(i.trim()));const l=j(Re),d=de(s),v=j(t),{auth:w,vault:p,escrow:y}=nn(v,d,l),x=j(e),E=j(r),A=me(x,v,!1,Z,ee),T=me(E,v,!1,Z,ee),S=await ft(o,u).methods.cancel().accounts({maker:v,makerAta:A,depositToken:x,makerAtaRequest:T,makerTokenRequest:E,auth:w,vault:p,escrow:y,tokenProgram:Z,associatedTokenProgram:ee,systemProgram:ve.programId}).instruction();return h.add(S),await sn(o,h,v),h}async function La(n){const{maker:t,taker:e,depositTokenMint:r,requestTokenMint:s,amount:i,seed:o,requestAmount:u,contractFeeAccount:h,whitelistProgram:l,whitelist:d,entry:v,memo:w,connection:p,wallet:y}=n,x=new wt;w?.trim()&&x.add(rn(w.trim()));const E=j(Re),A=j(e),T=de(o),k=j(t),{auth:S,vault:B,escrow:G}=nn(k,T,E),{makerReceiveAta:O,takerAta:z,takerReceiveAta:q}=ya({maker:k,taker:e,depositTokenMint:r,requestTokenMint:s}),D=j(r),M=j(s),R=j(h??vr),{takerAtaExists:I,totalCost:m}=await va({transaction:x,requestTokenMint:M,depositTokenMint:D,taker:A,connection:p});if(ba(s)){const _=Ea(A),P=await _a({requestAmount:u??void 0,fetchEscrowAccount:async()=>ft(p,y).account.escrow.fetch(G),amountBN:de(i)}),K=await Aa({wrappedSolAccount:_,requestAmountLamports:P,accountExists:I,connection:p});ka({transaction:x,takerPubkey:A,wrappedSolAccount:_,solToTransfer:K,accountExists:I})}const b=ft(p,y),C=de(i),V=!!d?.trim(),W=V?j(l??Zt):b.programId,g=V?j(d):b.programId,a=V?ai(A,j(d),W):b.programId,c={maker:k,makerReceiveAta:O,depositToken:D,taker:A,takerAta:z,takerReceiveAta:q,requestToken:M,auth:S,vault:B,escrow:G,tokenProgram:Z,associatedTokenProgram:ee,systemProgram:ve.programId,fee:R,whitelistProgram:W,whitelist:g,entry:v?j(v):a},f=await b.methods.exchange(C).accounts(c).instruction();return x.add(f),await sn(p,x,A),x}async function Ca(n,t,e,r,s={}){const{simulate:i=!0}=s,{blockhash:o,lastValidBlockHeight:u}=await n.getLatestBlockhash();t.recentBlockhash=o,t.feePayer=r,u!=null&&(t.lastValidBlockHeight=u);const h=await e.signTransaction(t);if(i){const l=await n.simulateTransaction(h);if(l.value.err){const d=l.value.logs?.join(`
`)??"",v=d?`Simulation failed:
${d}`:`Simulation failed: ${JSON.stringify(l.value.err)}`;throw new Error(v)}}try{const l=await n.sendRawTransaction(h.serialize(),{skipPreflight:!1});return await n.confirmTransaction(l),l}catch(l){const d=l instanceof Error?l.message:String(l),v=l,w=v.logs??v.data?.logs,p=Array.isArray(w)&&w.length?`${d}
${w.join(`
`)}`:d;throw new Error(p)}}async function Ba(n,t){try{const e=oi(n),r=j(t),s=await e.account.escrow.fetch(r);return{publicKey:r,account:s}}catch(e){if(e.message.includes("Account does not exist"))return null;throw e}}async function Ra(n,t){const e=ga,r=(async()=>await oi(n).account.escrow.all())(),s=new Promise((i,o)=>{setTimeout(()=>o(new Error(`Request timed out after ${e/1e3} seconds.`)),e)});return Promise.race([r,s])}var ar="metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s";function Sa(n){const[t]=U.findProgramAddressSync([Buffer.from("metadata"),new U(ar).toBuffer(),new U(n).toBuffer()],new U(ar));return t}function cr(n){if(n==null)return null;const t=n.trim();return t.length>0?t:null}async function Oa(n,t){const e={mint:t,name:null,symbol:null,image:null,decimals:null,sellerFeeBasisPoints:null};try{const r=new U(t),s=await Ei(n,r);e.decimals=s.decimals}catch{}try{const r=Sa(t),s=await n.getAccountInfo(r);if(!s?.data)return e;const i=s.data;let o=65;if(o+4>i.length)return e;const u=i.readUInt32LE(o);if(o+=4,o+u>i.length||(e.name=cr(i.subarray(o,o+u).toString("utf8")),o+=u,o+4>i.length))return e;const h=i.readUInt32LE(o);if(o+=4,o+h>i.length||(e.symbol=cr(i.subarray(o,o+h).toString("utf8")),o+=h,o+4>i.length))return e;const l=i.readUInt32LE(o);if(o+=4,o+l<=i.length&&l>0){const d=i.subarray(o,o+l).toString("utf8").trim();if(d&&!d.startsWith("http://localhost"))try{let v=d;d.startsWith("ipfs://")?v=`https://ipfs.io/ipfs/${d.replace("ipfs://","").replace(/^\/+/,"")}`:d.startsWith("ar://")&&(v=`https://arweave.net/${d.replace("ar://","").replace(/^\/+/,"")}`);const w=new AbortController,p=setTimeout(()=>w.abort(),2500),y=await fetch(v,{signal:w.signal,headers:{Accept:"application/json"}});if(clearTimeout(p),y.ok&&y.headers.get("content-type")?.includes("application/json")){const E=await y.json();let A=E.image??E.image_uri??null;A?.startsWith("ipfs://")?A=`https://ipfs.io/ipfs/${A.replace("ipfs://","").replace(/^\/+/,"")}`:A?.startsWith("ar://")&&(A=`https://arweave.net/${A.replace("ar://","").replace(/^\/+/,"")}`),e.image=A;const T=E.seller_fee_basis_points;e.sellerFeeBasisPoints=typeof T=="number"&&T>=0&&T<=1e4?T:null}}catch{}}}catch{}return e}export{Re as E,Z as T,La as a,Pa as b,Ba as c,Ta as d,nn as e,Ra as f,Ia as g,Oa as h,Ca as s};
