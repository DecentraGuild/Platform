import{e as w,o as s,c as u,t as b,h as C,a as k,i as B,_ as x,j as I,k as M,l as U,f as $,w as f,g as e,b as r,F as N,d as V,m as T,r as v,n as F,p as P}from"./rrIc-dOd.js";import{B as h}from"./D1hgOXyh.js";import{C as j}from"./yJHBq8LQ.js";import{P as A}from"./DSgs_9r6.js";import{C as E}from"./BoUnL5Tq.js";const G={class:"text-input"},O=["for"],R=["id","type","value","placeholder","disabled"],D={key:1,class:"text-input__error"},L=w({__name:"TextInput",props:{modelValue:{},label:{},type:{default:"text"},placeholder:{},disabled:{type:Boolean,default:!1},error:{}},emits:["update:modelValue"],setup(n){const a=B(()=>`input-${Math.random().toString(36).slice(2)}`);return(g,c)=>(s(),u("div",G,[n.label?(s(),u("label",{key:0,for:a.value,class:"text-input__label"},b(n.label),9,O)):C("",!0),k("input",{id:a.value,type:n.type,value:n.modelValue,placeholder:n.placeholder,disabled:n.disabled,class:"text-input__field",onInput:c[0]||(c[0]=i=>g.$emit("update:modelValue",i.target.value))},null,40,R),n.error?(s(),u("p",D,b(n.error),1)):C("",!0)]))}}),p=x(L,[["__scopeId","data-v-128e176b"]]),q={key:0,class:"onboard-form__error"},J=w({__name:"onboard",setup(n){const a=I(),g=P(),c=M(),i=v(!1);U(()=>{a.fetchMe(),a.refreshConnectorState()});const l=F({slug:"",name:"",description:"",logo:"",primaryColor:"#00951a"}),y=v(!1),m=v(null);async function S(d){await a.connectAndSignIn(d)&&(i.value=!1)}async function _(){if(a.wallet.value){if(!l.slug||!l.name){m.value="Slug and name are required";return}y.value=!0,m.value=null;try{const d=await fetch(`${g.public.apiUrl}/api/v1/tenants`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({slug:l.slug,name:l.name,description:l.description||void 0,branding:{logo:l.logo||void 0,theme:l.primaryColor?{colors:{primary:{main:l.primaryColor}}}:void 0},modules:[{id:"admin",enabled:!0}]})});if(!d.ok){const o=await d.json().catch(()=>({}));throw new Error(o.error??"Failed to create")}await c.push("/directory")}catch(d){m.value=d instanceof Error?d.message:"Failed to create org"}finally{y.value=!1}}}return(d,o)=>(s(),$(e(A),{title:"Create org"},{default:f(()=>[r(e(j),null,{default:f(()=>[e(a).wallet.value?(s(),u("form",{key:1,class:"onboard-form",onSubmit:T(_,["prevent"])},[r(e(p),{modelValue:e(l).slug,"onUpdate:modelValue":o[2]||(o[2]=t=>e(l).slug=t),label:"Slug",placeholder:"my-dguild"},null,8,["modelValue"]),r(e(p),{modelValue:e(l).name,"onUpdate:modelValue":o[3]||(o[3]=t=>e(l).name=t),label:"Name",placeholder:"My dGuild"},null,8,["modelValue"]),r(e(p),{modelValue:e(l).description,"onUpdate:modelValue":o[4]||(o[4]=t=>e(l).description=t),label:"Description",placeholder:"Our community hub"},null,8,["modelValue"]),r(e(p),{modelValue:e(l).logo,"onUpdate:modelValue":o[5]||(o[5]=t=>e(l).logo=t),label:"Logo URL",placeholder:"https://..."},null,8,["modelValue"]),r(e(p),{modelValue:e(l).primaryColor,"onUpdate:modelValue":o[6]||(o[6]=t=>e(l).primaryColor=t),label:"Primary color (hex)",placeholder:"#00951a"},null,8,["modelValue"]),e(m)?(s(),u("div",q,b(e(m)),1)):C("",!0),r(e(h),{type:"submit",variant:"primary",disabled:e(y)},{default:f(()=>[...o[9]||(o[9]=[V("Create",-1)])]),_:1},8,["disabled"])],32)):(s(),u(N,{key:0},[o[8]||(o[8]=k("p",{class:"onboard-form__prompt"}," Connect your wallet and sign in to create a dGuild. ",-1)),r(e(h),{variant:"primary",onClick:o[0]||(o[0]=t=>i.value=!0)},{default:f(()=>[...o[7]||(o[7]=[V(" Connect wallet ",-1)])]),_:1}),r(e(E),{open:e(i),title:"Connect wallet",description:"Choose a wallet to sign in and create your dGuild.",connectors:e(a).connectorState.value.connectors,loading:e(a).loading.value,error:e(a).error.value,onClose:o[1]||(o[1]=t=>i.value=!1),onSelect:S},null,8,["open","connectors","loading","error"])],64))]),_:1})]),_:1}))}}),X=x(J,[["__scopeId","data-v-340e08d1"]]);export{X as default};
