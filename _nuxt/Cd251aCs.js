const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Div2OS4D.js","./DhkfeLsH.js","./entry.BDyQSZFH.css","./AfR23o-p.js","./ColorInput.B8Aebckf.css","./MarketTree.sN-BRsHt.css","./DWaWCSrZ.js","./DnknCDuH.js","./GhnkrbTW.js","./py99y60w.js","./DAaVrNXw.js","./AuthWidget.CeRIouQ5.css","./Bg9r2jCQ.js","./Dr-6QOM-.js","./T1n2mv5F.js","./Bbny_65O.js","./yq63690G.js","./MarketBrowseView.D77HRz8h.css","./4EAuVi6g.js","./DZ77Mkvz.js","./DN_3Odmu.js","./MarketOpenTradesView.CO8CQURm.css","./CsxInRIs.js","./hS_LWQ0W.js","./EscrowDetailModal.BDdfPW8_.css","./Bos_eGuE.js","./B_Z0SKkq.js","./CreateTradeForm.BXPBydZr.css"])))=>i.map(i=>d[i]);
import{f as ee,h as C,i as y,e as ce,A as ue,J as de,B as fe,K as me,j as K,w as j,l as d,o as I,b as g,L as pe,c as q,a as p,M as ve,g as U,s as W,N as X,T as _e,k as x,O as $,P as B,_ as he}from"./DhkfeLsH.js";import{I as Q}from"./AfR23o-p.js";import{P as ye}from"./yq63690G.js";import{u as Me}from"./Bg9r2jCQ.js";const ke=6e4,z=new Map;function Ce(l){const o=z.get(l);return o?Date.now()-o.fetchedAt>ke?(z.delete(l),null):{mints:o.mints,entries:o.entries}:null}function be(l,o,t){z.set(l,{mints:o,entries:t,fetchedAt:Date.now()})}function Te(l){const o=Me(),t=C([]),c=C([]),f=C(!1),r=C(null);async function b(){const m=l.value;if(!m){t.value=[],c.value=[];return}const v=Ce(m);if(v){t.value=v.mints,c.value=v.entries;return}f.value=!0,r.value=null;try{const _=await fetch(`${o.value}/api/v1/tenant/${encodeURIComponent(m)}/marketplace/scope`);if(!_.ok)throw new Error(`HTTP ${_.status}`);const n=await _.json(),e=Array.isArray(n.mints)?n.mints:[],a=Array.isArray(n.entries)?n.entries:[];t.value=e,c.value=a,be(m,e,a)}catch(_){r.value=_ instanceof Error?_.message:"Failed to load marketplace scope",t.value=[],c.value=[]}finally{f.value=!1}}const N=y(()=>new Set(t.value)),A=y(()=>{const m=new Map;for(const v of c.value)if(v.collectionMint){const _=m.get(v.collectionMint)??[];_.push(v.mint),m.set(v.collectionMint,_)}return m});return ee(l,m=>{m?b():(t.value=[],c.value=[],r.value=null)},{immediate:!0}),{mints:t,entries:c,mintsSet:N,mintsByCollection:A,loading:f,error:r,retry:b}}const we=3,Se={collection:"NFT",spl_asset:"SPL",currency:"Currency"};function G(l,o){if(!o)return l.slice(0,8)+"...";const t=o.collectionMints?.find(r=>r.mint===l);if(t?.name)return t.name;const c=o.currencyMints?.find(r=>r.mint===l);if(c?.name)return c.name;const f=o.splAssetMints?.find(r=>r.mint===l);return f?.name?f.name:l.slice(0,8)+"..."}function H(l){return(l.groupPath??[]).slice(0,we)}function Ae(l){const{entries:o,settings:t}=l,c=new Set(o.map(e=>e.mint)),f=[],r=new Map;for(const[e,a]of Object.entries(Se)){const i=`type:${e}`,h={id:i,label:a,kind:"type",path:[a],children:[]};f.push(h),r.set(i,h)}const b=t?.collectionMints??[],N=t?.currencyMints??[],A=t?.splAssetMints??[],m=b.filter(e=>c.has(e.mint)),v=N,_=A;function n(e,a,i,h,k){const O=r.get(e);if(!O||!O.children)return;const P={id:`asset:${a}`,label:i,kind:"asset",mint:a,collectionMint:h,path:[],children:void 0};if(k.length===0){P.path=[...O.path,i],O.children.push(P);return}let M=O,R=[...O.path];for(let E=0;E<k.length;E++){const T=k[E];R.push(T);const w=`group:${e}:${k.slice(0,E+1).join(":")}`;let S=M.children?.find(L=>L.id===w);S||(S={id:w,label:T,kind:"group",path:[...R],children:[]},M.children||(M.children=[]),M.children.push(S)),M=S}P.path=[...R,i],M.children||(M.children=[]),M.children.push(P)}for(const e of m){const a=H(e),i=e.name??G(e.mint,t);n("type:collection",e.mint,i,e.mint,a)}for(const e of v){const a=H(e),i=e.name??e.symbol??G(e.mint,t);n("type:currency",e.mint,i,null,a)}for(const e of _){const a=H(e),i=e.name??e.symbol??G(e.mint,t);n("type:spl_asset",e.mint,i,null,a)}return f}function Z(l){return l.children??[]}function te(l){const o=[];for(const t of l)t.kind==="asset"&&t.mint&&o.push(t),t.children?.length&&o.push(...te(t.children));return o}function Oe(l,o){const t=y(()=>Ae({entries:l.value,settings:o.value})),c=C(null),f=C(null),r=y(()=>{const n=c.value;if(!n)return null;function e(a){for(const i of a){if(i.id===n)return i;const h=i.children?e(i.children):null;if(h)return h}return null}return e(t.value)}),b=y(()=>r.value?.mint??null),N=y(()=>r.value?.collectionMint??null),A=y(()=>{const n=r.value;return n?Z(n):t.value}),m=y(()=>{const n=r.value,e=n?Z(n):t.value;return te(e)});function v(n){if(c.value=n,n&&n.startsWith("asset:")){let e=function(i){for(const h of i){if(h.id===n)return h;const k=h.children?e(h.children):null;if(k)return k}return null};const a=e(t.value);if(a?.kind==="asset"&&a.mint&&a.mint!==a.collectionMint){f.value=a.mint;return}}f.value=null}function _(n){f.value=n}return{tree:t,selectedNodeId:c,selectedNode:r,selectedMint:b,selectedCollectionMint:N,selectedDetailMint:f,childNodesForSelection:A,descendantAssetNodes:m,selectNode:v,setSelectedDetailMint:_}}const ge={key:0,class:"market-shell-inactive"},Ne={key:0,class:"market-shell__tree"},Ee={class:"market-shell__main"},Ie={class:"market-shell__content"},Pe={class:"create-trade-modal__header"},Re={class:"create-trade-modal__header"},Le=ce({__name:"index",setup(l){const o=$(()=>B(()=>import("./Div2OS4D.js"),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url)),t=$(()=>B(()=>import("./DWaWCSrZ.js"),__vite__mapDeps([6,1,2,3,4,7,8,9,10,11,12,13,14,15,16,17]),import.meta.url)),c=$(()=>B(()=>import("./4EAuVi6g.js"),__vite__mapDeps([18,14,1,2,10,11,3,4,8,7,9,12,19,20,21]),import.meta.url)),f=$(()=>B(()=>import("./CsxInRIs.js"),__vite__mapDeps([22,1,2,3,4,19,8,7,9,10,11,12,20,23,24]),import.meta.url)),r=$(()=>B(()=>import("./Bos_eGuE.js"),__vite__mapDeps([25,1,2,3,4,19,26,7,13,12,15,10,11,23,9,16,27]),import.meta.url)),b=ue(),N=de(),A=fe(),{slug:m,marketplaceSettings:v}=me(A),_=y(()=>A.tenant),n=y(()=>_.value?.modules?.marketplace?.active??!1),e=y(()=>b.query.tab==="open-trades"?"open-trades":"browse"),{entries:a}=Te(m),{tree:i,selectedNodeId:h,selectedNode:k,childNodesForSelection:O,descendantAssetNodes:P,selectedDetailMint:M,selectNode:R,setSelectedDetailMint:E}=Oe(a,v);ee(k,u=>{u?.kind==="asset"&&u.mint&&u.mint!==u.collectionMint&&E(u.mint)},{immediate:!0});const T=C(!1),w=C(!1),S=C(null),L=C(null),V=C(null),ne=y(()=>{const u=k.value;if(!u?.mint)return null;if(u.collectionMint&&u.mint===u.collectionMint)return"NFT_COLLECTION";const s=v.value;return s?s.currencyMints?.some(D=>D.mint===u.mint)?"CURRENCY":s.splAssetMints?.some(D=>D.mint===u.mint)?"SPL_ASSET":null:null});function Y(u=!1){!u&&M.value?w.value=!0:(S.value=null,L.value=null,V.value=null,T.value=!0)}function se(){Y(!0)}function le(){S.value=M.value,L.value=null,V.value=ne.value,w.value=!1,T.value=!0}function oe(){S.value=null,L.value=M.value,V.value=null,w.value=!1,T.value=!0}function ae(){T.value=!1}const J=y(()=>b.query.escrow??null),re=y(()=>!!J.value);function ie(){const u={...b.query};delete u.escrow,N.replace({path:"/market",query:u})}return(u,s)=>{const D=pe;return I(),K(d(ye),null,{default:j(()=>[g(D,null,{fallback:j(()=>[...s[10]||(s[10]=[p("div",{class:"marketplace__loading"},"Loading...",-1)])]),default:j(()=>[n.value?(I(),q("div",{key:1,class:ve(["market-shell",{"market-shell--no-tree":e.value==="open-trades"}])},[e.value!=="open-trades"?(I(),q("aside",Ne,[g(d(o),{tree:d(i),"selected-node-id":d(h),onSelect:d(R)},null,8,["tree","selected-node-id","onSelect"])])):U("",!0),p("main",Ee,[p("div",Ie,[W(g(d(t),{"child-nodes":d(O),"descendant-asset-nodes":d(P),"selected-node":d(k),"selected-detail-mint":d(M),"breadcrumb-path":d(k)?.path??[],"select-node":d(R),"set-selected-detail-mint":d(E),onOpenCreateTrade:Y},null,8,["child-nodes","descendant-asset-nodes","selected-node","selected-detail-mint","breadcrumb-path","select-node","set-selected-detail-mint"]),[[X,e.value==="browse"]]),W(g(d(c),{"tab-active":e.value==="open-trades",onOpenCreateTrade:se},null,8,["tab-active"]),[[X,e.value==="open-trades"]])])])],2)):(I(),q("div",ge,[...s[6]||(s[6]=[p("p",null,"Marketplace is not enabled for this dGuild.",-1)])])),g(d(f),{"model-value":re.value,"escrow-id":J.value,"onUpdate:modelValue":ie},null,8,["model-value","escrow-id"]),(I(),K(_e,{to:"body"},[w.value?(I(),q("div",{key:0,class:"create-trade-modal-overlay",onClick:s[2]||(s[2]=x(F=>w.value=!1,["self"]))},[p("div",{class:"create-trade-modal create-trade-modal--choice",onClick:s[1]||(s[1]=x(()=>{},["stop"]))},[p("div",Pe,[s[7]||(s[7]=p("h3",null,"Create trade with this asset",-1)),p("button",{type:"button",class:"create-trade-modal__close","aria-label":"Close",onClick:s[0]||(s[0]=F=>w.value=!1)},[g(d(Q),{icon:"mdi:close"})])]),s[8]||(s[8]=p("p",{class:"create-trade-modal__choice-hint"},"Start as offer (you give this) or request (you want this)?",-1)),p("div",{class:"create-trade-modal__choice-actions"},[p("button",{type:"button",class:"create-trade-modal__choice-btn",onClick:le}," Offer (from wallet) "),p("button",{type:"button",class:"create-trade-modal__choice-btn",onClick:oe}," Request (what you want) ")])])])):U("",!0),T.value?(I(),q("div",{key:1,class:"create-trade-modal-overlay",onClick:s[5]||(s[5]=x(F=>T.value=!1,["self"]))},[p("div",{class:"create-trade-modal",onClick:s[4]||(s[4]=x(()=>{},["stop"]))},[p("div",Re,[s[9]||(s[9]=p("h3",null,"Create trade",-1)),p("button",{type:"button",class:"create-trade-modal__close","aria-label":"Close",onClick:s[3]||(s[3]=F=>T.value=!1)},[g(d(Q),{icon:"mdi:close"})])]),g(d(r),{"initial-offer-mint":S.value,"initial-offer-type":V.value,"initial-request-mint":L.value,onSuccess:ae},null,8,["initial-offer-mint","initial-offer-type","initial-request-mint"])])])):U("",!0)]))]),_:1})]),_:1})}}}),De=he(Le,[["__scopeId","data-v-ba4f0857"]]),xe=Object.freeze(Object.defineProperty({__proto__:null,default:De},Symbol.toStringTag,{value:"Module"}));export{xe as i,Te as u};
