import{e as w,o as d,c as u,t as b,h as C,a as S,i as _,_ as k,j as $,k as I,l as M,f as U,w as f,g as e,b as r,F as N,d as V,m as T,r as v,n as F,p as P}from"./QrRSspQ2.js";import{B as h}from"./BKGEyXAW.js";import{C as j}from"./aR-VXlP9.js";import{P as A}from"./rOAvZnyW.js";import{C as E}from"./BSZzZnB-.js";const G={class:"text-input"},O=["for"],R=["id","type","value","placeholder","disabled"],D={key:1,class:"text-input__error"},L=w({__name:"TextInput",props:{modelValue:{},label:{},type:{default:"text"},placeholder:{},disabled:{type:Boolean,default:!1},error:{}},emits:["update:modelValue"],setup(n){const t=_(()=>`input-${Math.random().toString(36).slice(2)}`);return(g,p)=>(d(),u("div",G,[n.label?(d(),u("label",{key:0,for:t.value,class:"text-input__label"},b(n.label),9,O)):C("",!0),S("input",{id:t.value,type:n.type,value:n.modelValue,placeholder:n.placeholder,disabled:n.disabled,class:"text-input__field",onInput:p[0]||(p[0]=i=>g.$emit("update:modelValue",i.target.value))},null,40,R),n.error?(d(),u("p",D,b(n.error),1)):C("",!0)]))}}),c=k(L,[["__scopeId","data-v-128e176b"]]),q={key:0,class:"onboard-form__error"},J=w({__name:"onboard",setup(n){const t=$(),g=P(),p=I(),i=v(!1);M(()=>{t.fetchMe(),t.refreshConnectorState()});const a=F({slug:"",name:"",description:"",logo:"",primaryColor:"#00951a"}),y=v(!1),m=v(null);async function x(s){await t.connectAndSignIn(s)&&(i.value=!1)}async function B(){if(t.wallet.value){if(!a.slug||!a.name){m.value="Slug and name are required";return}y.value=!0,m.value=null;try{const s=(g.public.apiUrl??"").toString().replace(/\/$/,""),o=await fetch(`${s}/api/v1/tenants`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({slug:a.slug,name:a.name,description:a.description||void 0,branding:{logo:a.logo||void 0,theme:a.primaryColor?{colors:{primary:{main:a.primaryColor}}}:void 0},modules:[{id:"admin",enabled:!0}]})});if(!o.ok){const l=await o.json().catch(()=>({}));throw new Error(l.error??"Failed to create")}await p.push("/directory")}catch(s){m.value=s instanceof Error?s.message:"Failed to create org"}finally{y.value=!1}}}return(s,o)=>(d(),U(e(A),{title:"Create org"},{default:f(()=>[r(e(j),null,{default:f(()=>[e(t).wallet.value?(d(),u("form",{key:1,class:"onboard-form",onSubmit:T(B,["prevent"])},[r(e(c),{modelValue:e(a).slug,"onUpdate:modelValue":o[2]||(o[2]=l=>e(a).slug=l),label:"Slug",placeholder:"my-dguild"},null,8,["modelValue"]),r(e(c),{modelValue:e(a).name,"onUpdate:modelValue":o[3]||(o[3]=l=>e(a).name=l),label:"Name",placeholder:"My dGuild"},null,8,["modelValue"]),r(e(c),{modelValue:e(a).description,"onUpdate:modelValue":o[4]||(o[4]=l=>e(a).description=l),label:"Description",placeholder:"Our community hub"},null,8,["modelValue"]),r(e(c),{modelValue:e(a).logo,"onUpdate:modelValue":o[5]||(o[5]=l=>e(a).logo=l),label:"Logo URL",placeholder:"https://..."},null,8,["modelValue"]),r(e(c),{modelValue:e(a).primaryColor,"onUpdate:modelValue":o[6]||(o[6]=l=>e(a).primaryColor=l),label:"Primary color (hex)",placeholder:"#00951a"},null,8,["modelValue"]),e(m)?(d(),u("div",q,b(e(m)),1)):C("",!0),r(e(h),{type:"submit",variant:"primary",disabled:e(y)},{default:f(()=>[...o[9]||(o[9]=[V("Create",-1)])]),_:1},8,["disabled"])],32)):(d(),u(N,{key:0},[o[8]||(o[8]=S("p",{class:"onboard-form__prompt"}," Connect your wallet and sign in to create a dGuild. ",-1)),r(e(h),{variant:"primary",onClick:o[0]||(o[0]=l=>i.value=!0)},{default:f(()=>[...o[7]||(o[7]=[V(" Connect wallet ",-1)])]),_:1}),r(e(E),{open:e(i),title:"Connect wallet",description:"Choose a wallet to sign in and create your dGuild.",connectors:e(t).connectorState.value.connectors,loading:e(t).loading.value,error:e(t).error.value,onClose:o[1]||(o[1]=l=>i.value=!1),onSelect:x},null,8,["open","connectors","loading","error"])],64))]),_:1})]),_:1}))}}),X=k(J,[["__scopeId","data-v-81ec2131"]]);export{X as default};
