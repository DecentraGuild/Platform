import{P as S,a0 as A,a1 as L,a2 as j}from"./DhkfeLsH.js";var C=j("WalletConnectProvider"),N=["solana_getAccounts","solana_requestAccounts","solana_signMessage","solana_signTransaction","solana_signAllTransactions","solana_signAndSendTransaction"],D={"solana:mainnet":"solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp","solana:devnet":"solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1","solana:testnet":"solana:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z"},x=Object.values(D);async function P(n){let e={provider:null,initialized:!1,connecting:!1,connectPromise:null,cancelConnect:null,sessionChangeListeners:new Set};function a(){if(!e.provider?.session)return;let s=c(e.provider.session);e.sessionChangeListeners.forEach(r=>{try{r(s)}catch(t){C.warn("Error in session change listener",{error:t})}})}function c(s){let r=[],t=s?.namespaces;if(t?.solana?.accounts)for(let i of t.solana.accounts){let u=i.split(":");if(u.length>=3){let o=u.slice(2).join(":");o&&!r.includes(o)&&r.push(o)}}return r}function l(s){let r=s?.namespaces;return r?"solana"in r:!1}async function y(s,r=!1){let t=s.cleanupPendingPairings;if(t)try{await t.call(s,{deletePairings:r})}catch{}}function d(s){let r=s.abortPairingAttempt;if(r)try{r.call(s)}catch{}}async function m(s){try{await s.disconnect()}catch{}}async function f(){if(e.provider)return e.provider;let s;try{s=(await S(async()=>{const{default:t}=await import("./D4JnTP1K.js");return{default:t}},[],import.meta.url)).default}catch{throw new Error("WalletConnect is enabled but @walletconnect/universal-provider is not installed. Please install it in your app (e.g. pnpm add @walletconnect/universal-provider).")}let r=await s.init({projectId:n.projectId,metadata:n.metadata,relayUrl:n.relayUrl});return r.on("display_uri",t=>{n.onDisplayUri&&n.onDisplayUri(t)}),r.on("session_delete",()=>{n.onSessionDisconnected&&n.onSessionDisconnected()}),r.on("session_update",()=>{C.debug("WalletConnect session_update received"),a()}),r.on("session_event",t=>{C.debug("WalletConnect session_event received",{event:t}),a()}),e.provider=r,e.initialized=!0,r}return{async connect(){if(e.connectPromise){await e.connectPromise;return}e.connectPromise=(async()=>{e.connecting=!0;try{let s=Symbol("WALLETCONNECT_CANCELLED"),r=null,t=new Promise(M=>{r=()=>M(s)}),i=!1;e.cancelConnect=()=>{i||(i=!0,r?.())};async function u(M){let h=await Promise.race([M,t]);if(h===s)throw new Error("Connection cancelled");return h}let o=null,g=null;if(o=await u(f()),o.session){if(l(o.session)){n.onSessionEstablished&&n.onSessionEstablished();return}await u(m(o)),await u(y(o,!1))}g=o.connect({namespaces:{solana:{chains:[...x],methods:[...N],events:[]}}});try{await u(g)}catch(M){throw g?.catch(()=>{}),M}if(!o.session)throw new Error("WalletConnect: connect completed but no session was established");if(!l(o.session))throw await u(m(o)),new Error("WalletConnect: connected session does not include Solana namespace");n.onSessionEstablished&&n.onSessionEstablished()}finally{e.connecting=!1,e.cancelConnect=null,e.connectPromise=null}})(),await e.connectPromise},async disconnect(){if(e.cancelConnect)try{e.cancelConnect()}catch{}if(!e.provider){n.onSessionDisconnected&&n.onSessionDisconnected();return}e.provider.session?await m(e.provider):(d(e.provider),await y(e.provider,!1)),n.onSessionDisconnected&&n.onSessionDisconnected()},async request(s){let r=await f();if(!r.session)throw new Error("WalletConnect: no active session. Call connect() first.");try{return await r.request({method:s.method,params:s.params},s.chainId)}catch(t){throw t}},isConnected(){return e.provider?.session!=null},getSessionAccounts(){return e.provider?.session?c(e.provider.session):[]},onSessionChanged(s){return e.sessionChangeListeners.add(s),()=>{e.sessionChangeListeners.delete(s)}}}}function Y(n={}){let e=!1,a=new Set;return{async connect(){e=!0},async disconnect(){e=!1},async request(){throw new Error("Mock transport: request not implemented")},isConnected(){return e},getSessionAccounts(){return[]},onSessionChanged(c){return a.add(c),()=>a.delete(c)},...n}}var U="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiByeD0iOCIgZmlsbD0iIzMzOTZGRiIvPgo8cGF0aCBkPSJNOS42IDEyLjRDMTMuMSA5IDE4LjkgOSAyMi40IDEyLjRMMjIuOSAxMi45QzIzLjEgMTMuMSAyMy4xIDEzLjQgMjIuOSAxMy42TDIxLjQgMTUuMUMyMS4zIDE1LjIgMjEuMSAxNS4yIDIxIDE1LjFMMjAuMyAxNC40QzE4IDEyLjIgMTQgMTIuMiAxMS43IDE0LjRMMTEgMTUuMUMxMC45IDE1LjIgMTAuNyAxNS4yIDEwLjYgMTUuMUw5LjEgMTMuNkM4LjkgMTMuNCA4LjkgMTMuMSA5LjEgMTIuOUw5LjYgMTIuNFpNMjUuMyAxNS4yTDI2LjYgMTYuNUMyNi44IDE2LjcgMjYuOCAxNyAyNi42IDE3LjJMMjAuNyAyMy4xQzIwLjUgMjMuMyAyMC4yIDIzLjMgMjAgMjMuMUwxNS45IDE5QzE1LjggMTguOSAxNS43IDE4LjkgMTUuNiAxOUwxMS41IDIzLjFDMTEuMyAyMy4zIDExIDIzLjMgMTAuOCAyMy4xTDQuOSAxNy4yQzQuNyAxNyA0LjcgMTYuNyA0LjkgMTYuNUw2LjIgMTUuMkM2LjQgMTUgNi43IDE1IDYuOSAxNS4yTDExIDE5LjNDMTEuMSAxOS40IDExLjIgMTkuNCAxMS4zIDE5LjNMMTUuNCAxNS4yQzE1LjYgMTUgMTUuOSAxNSAxNi4xIDE1LjJMMjAuMiAxOS4zQzIwLjMgMTkuNCAyMC40IDE5LjQgMjAuNSAxOS4zTDI0LjYgMTUuMkMyNC44IDE1IDI1LjEgMTUgMjUuMyAxNS4yWiIgZmlsbD0id2hpdGUiLz4KPC9zdmc+Cg==",z=["solana:mainnet","solana:devnet","solana:testnet"];function O(n){return D[n]||n}function I(n){let e="";for(let a=0;a<n.length;a++)e+=String.fromCharCode(n[a]);return btoa(e)}function W(n){let e=atob(n),a=new Uint8Array(e.length);for(let c=0;c<e.length;c++)a[c]=e.charCodeAt(c);return a}function k(n){return!/[0OIl+/=]/.test(n)}function T(n){if(k(n)){let e=A().encode(n);return new Uint8Array(e)}else return W(n)}function w(n){let e=0,a=0;for(;;){if(a>=n.length)throw new Error("Invalid shortvec encoding: unexpected end of data");let c=n[a];if(e|=(c&127)<<a*7,a+=1,(c&128)===0)break;if(a>10)throw new Error("Invalid shortvec encoding: length prefix too long")}return{length:e,bytesConsumed:a}}function q(n,e){let{length:a,bytesConsumed:c}=w(n),l=c+a*64,y=n.subarray(l),d=0;y[0]===128&&(d=1);let m=y[d];d+=3;let{length:f,bytesConsumed:s}=w(y.subarray(d));d+=s;let r=L();for(let t=0;t<Math.min(f,m);t++){let i=y.subarray(d+t*32,d+(t+1)*32);if(r.decode(i)===e)return t}return-1}function B(n,e,a){let{bytesConsumed:c}=w(n),l=A().encode(a);if(l.length!==64)throw new Error(`Invalid signature length: expected 64 bytes, got ${l.length}`);let y=new Uint8Array(n),d=c+e*64;return y.set(l,d),y}function p(n,e){let a=A();return{address:n.pubkey,publicKey:a.encode(n.pubkey),chains:e,features:[]}}function Q(n,e){let a=n.defaultChain?[n.defaultChain]:z;function c(){let t=n.getCurrentChain?.()||n.defaultChain||"solana:mainnet";return O(t)}let l=[],y=new Set;function d(){y.forEach(t=>t({accounts:l}))}function m(t){if(t.length===0){l=[],d();return}l=t.map(i=>p({pubkey:i},a)),d()}let f;if(e.onSessionChanged){let t=e.onSessionChanged(m);typeof t=="function"&&(f=t)}function s(){f&&(f(),f=void 0)}let r={version:"1.0.0",name:"WalletConnect",icon:U,chains:a,get accounts(){return l},cleanup:s,features:{"standard:connect":{version:"1.0.0",connect:async t=>{await e.connect();let i=e.getSessionAccounts();if(i.length>0)return l=i.map(M=>p({pubkey:M},a)),d(),{accounts:l};let u=t?.silent?"solana_getAccounts":"solana_requestAccounts",o,g;try{o=await e.request({method:u,params:{},chainId:c()})}catch(M){g=M;try{let h=u==="solana_getAccounts"?"solana_requestAccounts":"solana_getAccounts";o=await e.request({method:h,params:{},chainId:c()})}catch(h){let b=g instanceof Error?g.message:String(g),_=h instanceof Error?h.message:String(h),E=[b,_].filter(Boolean).join(" | ");throw new Error(`Failed to get accounts from WalletConnect. The wallet may not support Solana accounts.${E?` (Details: ${E})`:""}`)}}return l=Array.isArray(o)?o.map(M=>p(M,a)):[],d(),{accounts:l}}},"standard:disconnect":{version:"1.0.0",disconnect:async()=>{s(),await e.disconnect(),l=[],d()}},"standard:events":{version:"1.0.0",on:(t,i)=>t!=="change"?()=>{}:(y.add(i),()=>y.delete(i))},"solana:signMessage":{version:"1.0.0",signMessage:async({account:t,message:i})=>{let u=L().decode(i),o=await e.request({method:"solana_signMessage",params:{message:u,pubkey:t.address},chainId:c()});return[{signature:A().encode(o.signature),signedMessage:i}]}},"solana:signTransaction":{version:"1.0.0",signTransaction:async({account:t,transaction:i})=>{let u=I(i),o=c(),g=await e.request({method:"solana_signTransaction",params:{transaction:u},chainId:o}),M;if(g.transaction)M=T(g.transaction);else if(g.signature){let h=q(i,t.address);if(h<0)throw new Error("Signer pubkey not found in transaction");M=B(i,h,g.signature)}else throw new Error("Invalid solana_signTransaction response: no signature or transaction");return[{signedTransaction:M}]}},"solana:signAllTransactions":{version:"1.0.0",signAllTransactions:async({account:t,transactions:i})=>{let u=i.map(I);try{return(await e.request({method:"solana_signAllTransactions",params:{transactions:u},chainId:c()})).transactions.map(o=>({signedTransaction:T(o)}))}catch{let o=r.features["solana:signTransaction"];return(await Promise.all(i.map(g=>o.signTransaction({account:t,transaction:g})))).map(g=>({signedTransaction:g[0].signedTransaction}))}}},"solana:signAndSendTransaction":{version:"1.0.0",signAndSendTransaction:async({transaction:t,options:i})=>{let u=I(t),o=await e.request({method:"solana_signAndSendTransaction",params:{transaction:u,sendOptions:i?{skipPreflight:i.skipPreflight,preflightCommitment:i.preflightCommitment,maxRetries:i.maxRetries,minContextSlot:i.minContextSlot}:void 0},chainId:c()});return[{signature:A().encode(o.signature)}]}}}};return r}var v=j("WalletConnectRegistration");async function Z(n){if(typeof window>"u")throw new Error("WalletConnect registration can only be done in a browser environment");v.debug("Registering WalletConnect wallet",{projectId:n.projectId.substring(0,8)+"...",defaultChain:n.defaultChain});let e=await P(n),a=Q(n,e),{getWallets:c}=await S(async()=>{const{getWallets:y}=await import("./BGFLXSC9.js");return{getWallets:y}},[],import.meta.url),l=c().register(a);return v.info("WalletConnect wallet registered successfully"),{wallet:a,unregister:l}}async function F(){if(typeof window>"u")return!1;try{return await S(()=>import("./D4JnTP1K.js"),[],import.meta.url),!0}catch{return!1}}export{Y as createMockWalletConnectTransport,P as createWalletConnectTransport,Q as createWalletConnectWallet,F as isWalletConnectAvailable,Z as registerWalletConnectWallet};
